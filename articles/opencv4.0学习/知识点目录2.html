
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>知识点(90-150) · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="案例实战30讲.html" />
    
    
    <link rel="prev" href="知识点目录1.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">后端开发</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    leveldb源码学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    libevent源码学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    teamtalk源码学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    flamingo源码学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    redis源码学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    brpc源码学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    workflow源码学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    skynet源码学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    网络编程
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    多线程编程
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    协议设计
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    CGI使用
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" >
            
                <span>
            
                    
                    什么是CGI
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" >
            
                <span>
            
                    
                    CGI实战
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    后端开发知识点记录
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" >
            
                <span>
            
                    
                    线程池
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" >
            
                <span>
            
                    
                    内存池
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" >
            
                <span>
            
                    
                    协程学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" >
            
                <span>
            
                    
                    Reactor模式
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" >
            
                <span>
            
                    
                    心跳包设计
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.6" >
            
                <span>
            
                    
                    日志系统设计
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.7" >
            
                <span>
            
                    
                    时间轮实现
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.8" >
            
                <span>
            
                    
                    连接池
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.9" >
            
                <span>
            
                    
                    用户态TCP协议栈
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" >
            
                <span>
            
                    
                    极客时间专栏学习笔记
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">深度学习</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../动手学AIOT/index.md">
            
                <span>
            
                    
                    动手学AIOT
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" >
            
                <span>
            
                    
                    深度学习简介
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" >
            
                <span>
            
                    
                    预备知识
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" >
            
                <span>
            
                    
                    深度学习基础
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" >
            
                <span>
            
                    
                    环境搭建
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" >
            
                <span>
            
                    
                    推理框架
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" >
            
                <span>
            
                    
                    分类模型
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7" >
            
                <span>
            
                    
                    目标检测
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.8" >
            
                <span>
            
                    
                    人脸识别
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.9" >
            
                <span>
            
                    
                    目标跟踪
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.10" >
            
                <span>
            
                    
                    实例分割
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.11" >
            
                <span>
            
                    
                    姿态估计
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.12" >
            
                <span>
            
                    
                    网络压缩
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13" >
            
                <span>
            
                    
                    项目实战
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.13.1" >
            
                <span>
            
                    
                    人脸识别
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13.2" >
            
                <span>
            
                    
                    属性分类
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13.3" >
            
                <span>
            
                    
                    姿态估计
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13.4" >
            
                <span>
            
                    
                    热力图显示
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13.5" >
            
                <span>
            
                    
                    人脸检测器
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13.6" >
            
                <span>
            
                    
                    行人检测
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13.7" >
            
                <span>
            
                    
                    多目标跟踪
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../ncnn源码分析/">
            
                <a href="../ncnn源码分析/">
            
                    
                    ncnn源码分析
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../ncnn源码分析/01_源码架构.md">
            
                <span>
            
                    
                    01_ncnn介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../ncnn源码分析/02_代码架构.md">
            
                <span>
            
                    
                    02_ncnn交叉编译
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" >
            
                <span>
            
                    
                    03_ncnn源码文件介绍
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" >
            
                <span>
            
                    
                    04_ncnn核心类分析
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" >
            
                <span>
            
                    
                    05_ncnn的neon指令记录
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.6" >
            
                <span>
            
                    
                    06_ncnn卷积神经网络层分析
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7" >
            
                <span>
            
                    
                    07_ncnn优化卷积计算方法和量化推断
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.8" >
            
                <span>
            
                    
                    08_ncnn int8量化
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../darknet源码分析/">
            
                <a href="../darknet源码分析/">
            
                    
                    darknet源码分析
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <span>
            
                    
                    caffe
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" >
            
                <span>
            
                    
                    添加Add层
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" >
            
                <span>
            
                    
                    添加3D Conv层
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" >
            
                <span>
            
                    
                    添加Detection层
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="./">
            
                <a href="./">
            
                    
                    opencv4.0学习笔记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="知识点目录1.html">
            
                <a href="知识点目录1.html">
            
                    
                    知识点(1-89)
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="5.1.2" data-path="知识点目录2.html">
            
                <a href="知识点目录2.html">
            
                    
                    知识点(90-150)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="案例实战30讲.html">
            
                <a href="案例实战30讲.html">
            
                    
                    案例实战30例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="案例实战20讲.html">
            
                <a href="案例实战20讲.html">
            
                    
                    案例实战20例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <span>
            
                    
                    目标检测源码分析
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" >
            
                <span>
            
                    
                    yolov3源码分析
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" >
            
                <span>
            
                    
                    ssd源码分析
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" >
            
                <span>
            
                    
                    fast_rcnn源码分析
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4" >
            
                <span>
            
                    
                    sort源码分析
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.5" >
            
                <span>
            
                    
                    deepsort源码分析
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.2" >
            
                <span>
            
                    
                    计算机视觉题目
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">机器学习</li>
        
        
    
        <li class="chapter " data-level="7.1" >
            
                <span>
            
                    
                    监督学习
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" >
            
                <span>
            
                    
                    无监督学习
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">视觉SLAM</li>
        
        
    
        <li class="chapter " data-level="8.1" >
            
                <span>
            
                    
                    视觉十四讲笔记
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" >
            
                <span>
            
                    
                    从零开始学ORB-SLAM2
            
                </span>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >知识点(90-150)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h3 id="90&#x3001;&#x89C6;&#x9891;&#x5206;&#x6790;-&#x5BF9;&#x8C61;&#x79FB;&#x52A8;&#x8F68;&#x8FF9;&#x7ED8;&#x5236;">90&#x3001;&#x89C6;&#x9891;&#x5206;&#x6790;-&#x5BF9;&#x8C61;&#x79FB;&#x52A8;&#x8F68;&#x8FF9;&#x7ED8;&#x5236;</h3>
<p>C++</p>
<pre><code class="lang-cpp">#include &lt;opencv2/opencv.hpp&gt;&quot;
#include &lt;iostream&gt;

using namespace cv;
using namespace std;

Mat image;
bool selectObject = false;
int trackObject = 0;
bool showHist = true;
Point origin;
Rect selection;
int vmin = 10, vmax = 256, smin = 30;

int main(int argc, const char** argv)
{
    // VideoCapture cap(0);
    VideoCapture cap(&quot;D:/images/video/balltest.mp4&quot;);
    Rect trackWindow;
    int hsize = 16;
    float hranges[] = { 0,180 };
    const float* phranges = hranges;

    if (!cap.isOpened())
    {
        printf(&quot;could not open camera...\n&quot;);
        return -1;
    }

    namedWindow(&quot;Histogram&quot;, WINDOW_AUTOSIZE);
    namedWindow(&quot;CamShift Demo&quot;, WINDOW_AUTOSIZE);

    Mat frame, hsv, hue, mask, hist, histimg = Mat::zeros(200, 320, CV_8UC3), backproj;
    bool paused = false;
    cap.read(frame);
    Rect selection = selectROI(&quot;CamShift Demo&quot;, frame, true, false);
    vector&lt;Point&gt; tracking_path;
    while (true)
    {
        bool ret = cap.read(frame);
        if (!ret) break;
        frame.copyTo(image);

        cvtColor(image, hsv, COLOR_BGR2HSV);

        int _vmin = vmin, _vmax = vmax;
        inRange(hsv, Scalar(26, 43, 46), Scalar(34, 255, 255), mask);
        int ch[] = { 0, 0 };
        hue.create(hsv.size(), hsv.depth());
        mixChannels(&amp;hsv, 1, &amp;hue, 1, ch, 1);

        if (trackObject &lt;= 0)
        {
            // Object has been selected by user, set up CAMShift search properties once
            Mat roi(hue, selection), maskroi(mask, selection);
            calcHist(&amp;roi, 1, 0, maskroi, hist, 1, &amp;hsize, &amp;phranges);
            normalize(hist, hist, 0, 255, NORM_MINMAX);

            trackWindow = selection;
            trackObject = 1; // Don&apos;t set up again, unless user selects new ROI

            histimg = Scalar::all(0);
            int binW = histimg.cols / hsize;
            Mat buf(1, hsize, CV_8UC3);
            for (int i = 0; i &lt; hsize; i++)
                buf.at&lt;Vec3b&gt;(i) = Vec3b(saturate_cast&lt;uchar&gt;(i*180. / hsize), 255, 255);
            cvtColor(buf, buf, COLOR_HSV2BGR);

            for (int i = 0; i &lt; hsize; i++)
            {
                int val = saturate_cast&lt;int&gt;(hist.at&lt;float&gt;(i)*histimg.rows / 255);
                rectangle(histimg, Point(i*binW, histimg.rows),
                    Point((i + 1)*binW, histimg.rows - val),
                    Scalar(buf.at&lt;Vec3b&gt;(i)), -1, 8);
            }
        }

        // Perform CA-MeanShift
        calcBackProject(&amp;hue, 1, 0, hist, backproj, &amp;phranges);
        backproj &amp;= mask;
        RotatedRect trackBox = CamShift(backproj, trackWindow,
            TermCriteria(TermCriteria::EPS | TermCriteria::COUNT, 10, 1));
        if (trackBox.center.x&gt;0 &amp;&amp; trackBox.center.y&gt;0)
            tracking_path.push_back(trackBox.center);
        ellipse(image, trackBox, Scalar(0, 0, 255), 3, LINE_AA);
        for (int i = 1; i &lt; tracking_path.size(); i++) {
            line(image, tracking_path[i - 1], tracking_path[i], Scalar(255, 0, 0), 2, 8, 0);
        }

        imshow(&quot;CamShift Demo&quot;, image);
        imshow(&quot;Histogram&quot;, histimg);
        char c = (char)waitKey(50);
        if (c == 27)
            break;
    }

    return 0;
}
</code></pre>
<p>python</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> cv2 <span class="hljs-keyword">as</span> cv
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np


cap = cv.VideoCapture(<span class="hljs-string">&apos;D:/images/video/balltest.mp4&apos;</span>)

<span class="hljs-comment"># &#x8BFB;&#x53D6;&#x7B2C;&#x4E00;&#x5E27;</span>
ret,frame = cap.read()
cv.namedWindow(<span class="hljs-string">&quot;CAM Demo&quot;</span>, cv.WINDOW_AUTOSIZE)

<span class="hljs-comment"># &#x9009;&#x62E9;ROI&#x533A;&#x57DF;</span>
x, y, w, h = cv.selectROI(<span class="hljs-string">&quot;CAM Demo&quot;</span>, frame, <span class="hljs-keyword">True</span>, <span class="hljs-keyword">False</span>)
track_window = (x, y, w, h)

<span class="hljs-comment"># &#x83B7;&#x53D6;ROI&#x76F4;&#x65B9;&#x56FE;</span>
roi = frame[y:y+h, x:x+w]
hsv_roi = cv.cvtColor(roi, cv.COLOR_BGR2HSV)
mask = cv.inRange(hsv_roi, (<span class="hljs-number">26</span>, <span class="hljs-number">43</span>, <span class="hljs-number">46</span>), (<span class="hljs-number">34</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))
roi_hist = cv.calcHist([hsv_roi],[<span class="hljs-number">0</span>],mask,[<span class="hljs-number">180</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">180</span>])
cv.normalize(roi_hist,roi_hist,<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,cv.NORM_MINMAX)

<span class="hljs-comment"># &#x8BBE;&#x7F6E;&#x641C;&#x7D22;&#x8DDF;&#x8E2A;&#x5206;&#x6790;</span>
term_crit = ( cv.TERM_CRITERIA_EPS | cv.TERM_CRITERIA_COUNT, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>)
tracking_path = []
<span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
    ret, frame = cap.read()
    <span class="hljs-keyword">if</span> ret <span class="hljs-keyword">is</span> <span class="hljs-keyword">False</span>:
        <span class="hljs-keyword">break</span>;
    hsv = cv.cvtColor(frame, cv.COLOR_BGR2HSV)
    dst = cv.calcBackProject([hsv],[<span class="hljs-number">0</span>],roi_hist,[<span class="hljs-number">0</span>,<span class="hljs-number">180</span>],<span class="hljs-number">1</span>)

    <span class="hljs-comment"># &#xFF0C;&#x641C;&#x7D22;&#x66F4;&#x65B0;roi&#x533A;&#x57DF;&#xFF0C; &#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x8F68;&#x8FF9;</span>
    track_box = cv.CamShift(dst, track_window, term_crit)
    track_window = track_box[<span class="hljs-number">1</span>]
    pt = np.int32(track_box[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])
    <span class="hljs-keyword">if</span> pt[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> pt[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0</span>:
        tracking_path.append(pt)

    <span class="hljs-comment"># &#x7ED8;&#x5236;&#x8DDF;&#x8E2A;&#x5BF9;&#x8C61;&#x4F4D;&#x7F6E;&#x7A97;&#x53E3;&#x4E0E;&#x5BF9;&#x8C61;&#x8FD0;&#x884C;&#x8F68;&#x8FF9;</span>
    cv.ellipse(frame, track_box[<span class="hljs-number">0</span>], (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">3</span>, <span class="hljs-number">8</span>)
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, len(tracking_path), <span class="hljs-number">1</span>):
        cv.line(frame, (tracking_path[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>], tracking_path[i - <span class="hljs-number">1</span>][<span class="hljs-number">1</span>]),
                (tracking_path[i][<span class="hljs-number">0</span>], tracking_path[i][<span class="hljs-number">1</span>]), (<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>)

    cv.imshow(<span class="hljs-string">&apos;CAM Demo&apos;</span>,frame)
    k = cv.waitKey(<span class="hljs-number">50</span>) &amp; <span class="hljs-number">0xff</span>
    <span class="hljs-keyword">if</span> k == <span class="hljs-number">27</span>:
        <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">else</span>:
        cv.imwrite(chr(k)+<span class="hljs-string">&quot;.jpg&quot;</span>,frame)

cv.destroyAllWindows()
cap.release()
</code></pre>
<h3 id="91&#x3001;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;-&#x2013;-haar&#x7EA7;&#x8054;&#x68C0;&#x6D4B;&#x5668;&#x4F7F;&#x7528;">91&#x3001;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B; &#x2013; HAAR&#x7EA7;&#x8054;&#x68C0;&#x6D4B;&#x5668;&#x4F7F;&#x7528;</h3>
<p>HAAR&#x7EA7;&#x8054;&#x68C0;&#x6D4B;&#x5668;&#xFF0C;OpenCV&#x4E2D;&#x7684;HAAR&#x7EA7;&#x8054;&#x68C0;&#x6D4B;&#x5668;&#x652F;&#x6301;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x3001;&#x5FAE;&#x7B11;&#x3001;&#x773C;&#x775B;&#x4E0E;&#x5634;&#x5DF4;&#x68C0;&#x6D4B;&#x7B49;&#xFF0C;&#x901A;&#x8FC7;&#x52A0;&#x8F7D;&#x8FD9;&#x4E9B;&#x9884;&#x5148;&#x8BAD;&#x7EC3;&#x7684;HAAR&#x6A21;&#x578B;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x76F8;&#x5173;&#x7684;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#xFF0C; </p>
<pre><code class="lang-c++"><span class="hljs-keyword">void</span> cv::CascadeClassifier::detectMultiScale(
    InputArray     image,
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&amp;lt; Rect &amp;gt; &amp; objects,
    <span class="hljs-keyword">double</span> scaleFactor = <span class="hljs-number">1.1</span>,
    <span class="hljs-keyword">int</span> minNeighbors = <span class="hljs-number">3</span>,
    <span class="hljs-keyword">int</span> flags = <span class="hljs-number">0</span>,
    Size minSize = Size(),
    Size maxSize = Size() 
)
</code></pre>
<p>&#x5404;&#x4E2A;&#x53C2;&#x6570;&#x89E3;&#x91CA;&#x5982;&#x4E0B;: </p>
<ul>
<li>Image:&#x8F93;&#x5165;&#x56FE;&#x50CF; </li>
<li>Objects &#x4EBA;&#x8138;&#x6846; </li>
<li>ScaleFactor &#x653E;&#x7F29;&#x6BD4;&#x7387; </li>
<li>minNeighbors &#x8868;&#x793A;&#x6700;&#x4F4E;&#x76F8;&#x90BB;&#x77E9;&#x5F62;&#x6846; </li>
<li>flags &#x6807;&#x5FD7;&#x9879;</li>
<li>OpenCV3.x&#x4EE5;&#x540E;&#x4E0D;&#x7528;&#x5566;&#xFF0C; </li>
<li>minSize &#x53EF;&#x4EE5;&#x68C0;&#x6D4B;&#x7684;&#x6700;&#x5C0F;&#x4EBA;&#x8138; </li>
<li>maxSize &#x53EF;&#x4EE5;&#x68C0;&#x6D4B;&#x7684;&#x6700;&#x5927;&#x4EBA;&#x8138;</li>
</ul>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
CascadeClassifier faceDetector;
String haar_data_file = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/opencv-4.1.0/data/haarcascades/haarcascade_frontalface_alt_tree.xml&quot;</span>;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> artc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat frame, gray;
    <span class="hljs-built_in">vector</span>&lt;Rect&gt; faces;
    <span class="hljs-function">VideoCapture <span class="hljs-title">capture</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;
    faceDetector.load(haar_data_file);
    namedWindow(<span class="hljs-string">&quot;frame&quot;</span>, WINDOW_AUTOSIZE);
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        capture.read(frame);
        cvtColor(frame, gray, COLOR_BGR2GRAY);
        equalizeHist(gray, gray);
        faceDetector.detectMultiScale(gray, faces, <span class="hljs-number">1.2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, Size(<span class="hljs-number">30</span>, <span class="hljs-number">30</span>), Size(<span class="hljs-number">400</span>, <span class="hljs-number">400</span>));
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> t = <span class="hljs-number">0</span>; t &lt; faces.size(); t++) {
            rectangle(frame, faces[t], Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>);
        }
        <span class="hljs-keyword">char</span> c = waitKey(<span class="hljs-number">10</span>);
        <span class="hljs-keyword">if</span> (c == <span class="hljs-number">27</span>) {
            <span class="hljs-keyword">break</span>;
        }
        imshow(<span class="hljs-string">&quot;frame&quot;</span>, frame);
    }

    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="92&#x3001;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;-haar&#x7279;&#x5F81;&#x4ECB;&#x7ECD;">92&#x3001;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;-HAAR&#x7279;&#x5F81;&#x4ECB;&#x7ECD;</h3>
<p>&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;-HAAR&#x7279;&#x5F81;&#x4ECB;&#x7ECD; HAAR&#x5C0F;&#x6CE2;&#x57FA;&#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x6EE1;&#x8DB3;&#x5BF9;&#x79F0;&#x6027;&#xFF0C;&#x5BF9;&#x4EBA;&#x8138;&#x8FD9;&#x79CD;&#x751F;&#x7269;&#x5BF9;&#x79F0;&#x6027;&#x826F;&#x597D;&#x7684;&#x5BF9;&#x8C61;&#x7279;&#x522B;&#x9002;&#x5408;&#x7528;&#x6765;&#x505A;&#x68C0;&#x6D4B;&#x5668;&#xFF0C;&#x5E38;&#x89C1;&#x7684;Haar&#x7279;&#x5F81;&#x5206;&#x4E3A;&#x4E09;&#x7C7B;&#xFF1A; &#x8FB9;&#x7F18;&#x7279;&#x5F81;&#x3001; &#x7EBF;&#x6027;&#x7279;&#x5F81;&#x3001; &#x4E2D;&#x5FC3;&#x7279;&#x5F81;&#x548C;&#x5BF9;&#x89D2;&#x7EBF;&#x7279;&#x5F81;&#xFF0C; &#x4E0D;&#x540C;&#x7279;&#x5F81;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x591A;&#x79CD;&#x7EC4;&#x5408;&#xFF0C;&#x751F;&#x6210;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x7EA7;&#x8054;&#x7279;&#x5F81;&#xFF0C;&#x7279;&#x5F81;&#x6A21;&#x677F;&#x5185;&#x6709;&#x767D;&#x8272;&#x548C;&#x9ED1;&#x8272;&#x4E24;&#x79CD;&#x77E9;&#x5F62;&#xFF0C;&#x5E76;&#x5B9A;&#x4E49;&#x8BE5;&#x6A21;&#x677F;&#x7684;&#x7279;&#x5F81;&#x503C;&#x4E3A;&#x767D;&#x8272;&#x77E9;&#x5F62;&#x50CF;&#x7D20;&#x548C;&#x51CF;&#x53BB;&#x9ED1;&#x8272;&#x77E9;&#x5F62;&#x50CF;&#x7D20;&#x548C;&#xFF0C;Haar&#x7279;&#x5F81;&#x503C;&#x53CD;&#x6620;&#x4E86;&#x56FE;&#x50CF;&#x7684;&#x5BF9;&#x6BD4;&#x5EA6;&#x4E0E;&#x68AF;&#x5EA6;&#x53D8;&#x5316;&#x3002; OpenCV&#x4E2D;HAAR&#x7279;&#x5F81;&#x8BA1;&#x7B97;&#x662F;&#x79EF;&#x5206;&#x56FE;&#x6280;&#x672F;&#xFF0C;&#x8FD9;&#x4E2A;&#x6211;&#x4EEC;&#x5728;&#x524D;&#x9762;&#x4E5F;&#x5206;&#x4EAB;&#x8FC7;&#x5566;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x5FEB;&#x901F;&#x9AD8;&#x6548;&#x7684;&#x5F00;&#x7A97;&#x68C0;&#x6D4B;&#xFF0C; HAAR&#x7EA7;&#x8054;&#x68C0;&#x6D4B;&#x5668;&#x5177;&#x5907;&#x6709;&#x5982;&#x4E0B;&#x7279;&#x6027;&#xFF1A; </p>
<ul>
<li>&#x9AD8;&#x7C7B;&#x95F4;&#x53D8;&#x5F02;&#x6027; 
   &#x4F4E;&#x7C7B;&#x5185;&#x53D8;&#x5F02;&#x6027;
   &#x5C40;&#x90E8;&#x5F3A;&#x5EA6;&#x5DEE; 
   &#x4E0D;&#x540C;&#x5C3A;&#x5EA6; 
   &#x8BA1;&#x7B97;&#x6548;&#x7387;&#x9AD8;</li>
</ul>
<p><img src="pic/091_01.jpeg" alt=""></p>
<p><img src="pic/091_02.jpeg" alt=""></p>
<p><img src="pic/092_03.jpeg" alt=""></p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> cv2 <span class="hljs-keyword">as</span> cv

capture = cv.VideoCapture(<span class="hljs-number">0</span>)
face_detector = cv.CascadeClassifier(cv.data.haarcascades + <span class="hljs-string">&quot;haarcascade_frontalface_alt.xml&quot;</span>)
smile_detector = cv.CascadeClassifier(cv.data.haarcascades + <span class="hljs-string">&quot;haarcascade_smile.xml&quot;</span>)
<span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
    ret, image = capture.read()
    <span class="hljs-keyword">if</span> ret <span class="hljs-keyword">is</span> <span class="hljs-keyword">True</span>:
        cv.imshow(<span class="hljs-string">&quot;frame&quot;</span>, image)
        faces = face_detector.detectMultiScale(image, scaleFactor=<span class="hljs-number">1.05</span>, minNeighbors=<span class="hljs-number">3</span>,
                                          minSize=(<span class="hljs-number">30</span>, <span class="hljs-number">30</span>), maxSize=(<span class="hljs-number">300</span>, <span class="hljs-number">300</span>))
        <span class="hljs-keyword">for</span> x, y, width, height <span class="hljs-keyword">in</span> faces:
            cv.rectangle(image, (x, y), (x+width, y+height), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>, cv.LINE_8, <span class="hljs-number">0</span>)
        roi = image[y:y+height,x:x+width]
        smiles = smile_detector.detectMultiScale(roi, scaleFactor=<span class="hljs-number">1.7</span>, minNeighbors=<span class="hljs-number">3</span>,
                                               minSize=(<span class="hljs-number">15</span>, <span class="hljs-number">15</span>), maxSize=(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>))
        <span class="hljs-keyword">for</span> sx, sy, sw, sh <span class="hljs-keyword">in</span> smiles:
            cv.rectangle(roi, (sx, sy), (sx + sw, sy + sh), (<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1</span>)

        cv.imshow(<span class="hljs-string">&quot;faces&quot;</span>, image)
        c = cv.waitKey(<span class="hljs-number">50</span>)
        <span class="hljs-keyword">if</span> c == <span class="hljs-number">27</span>:
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">break</span>

cv.destroyAllWindows()
</code></pre>
<h3 id="93&#x3001;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;-lbp&#x7279;&#x5F81;&#x4ECB;&#x7ECD;">93&#x3001;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;-LBP&#x7279;&#x5F81;&#x4ECB;&#x7ECD;</h3>
<p>&#x5C40;&#x90E8;&#x4E8C;&#x503C;&#x6A21;&#x5F0F;(Local Binary Pattern)&#x4E3B;&#x8981;&#x7528;&#x6765;&#x5B9E;&#x73B0;2D&#x56FE;&#x50CF;&#x7EB9;&#x7406;&#x5206;&#x6790;&#x3002;&#x5176;&#x57FA;&#x672C;&#x601D;&#x60F3;&#x662F;&#x7528;&#x6BCF;&#x4E2A;&#x50CF;&#x7D20;&#x8DDF;&#x5B83;&#x5468;&#x56F4;&#x7684;&#x50CF;&#x7D20;&#x76F8;&#x6BD4;&#x8F83;&#x5F97;&#x5230;&#x5C40;&#x90E8;&#x56FE;&#x50CF;&#x7ED3;&#x6784;&#xFF0C;&#x5047;&#x8BBE;&#x4E2D;&#x5FC3;&#x50CF;&#x7D20;&#x503C;&#x5927;&#x4E8E;&#x76F8;&#x90BB;&#x50CF;&#x7D20;&#x503C;&#x5219;&#x5219;&#x76F8;&#x90BB;&#x50CF;&#x7D20;&#x70B9;&#x8D4B;&#x503C;&#x4E3A;1&#xFF0C;&#x5426;&#x5219;&#x8D4B;&#x503C;&#x4E3A;0&#xFF0C;&#x6700;&#x7EC8;&#x5BF9;&#x6BCF;&#x4E2A;&#x50CF;&#x7D20;&#x70B9;&#x90FD;&#x4F1A;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x516B;&#x4F4D;&#x7684;&#x8868;&#x793A;&#xFF0C;&#x6BD4;&#x5982;11100111&#x3002;&#x5047;&#x8BBE;3x3&#x7684;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#xFF0C;&#x8FD9;&#x6837;&#x5BF9;&#x6BCF;&#x4E2A;&#x50CF;&#x7D20;&#x70B9;&#x6765;&#x8BF4;&#x7EC4;&#x5408;&#x5F97;&#x5230;&#x7684;&#x50CF;&#x7D20;&#x503C;&#x7684;&#x7A7A;&#x95F4;&#x4E3A;[0~2^8]&#x3002;&#x8FD9;&#x79CD;&#x7ED3;&#x679C;&#x79F0;&#x4E3A;&#x56FE;&#x50CF;&#x7684;&#x5C40;&#x90E8;&#x4E8C;&#x503C;&#x6A21;&#x5F0F;&#x6216;&#x8005;&#x7B80;&#x5199;&#x4E3A;&#x4E86;LBP&#x3002;</p>
<p><img src="pic/108.png" alt=""></p>
<p><img src="pic/109.png" alt=""></p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
CascadeClassifier faceDetector;
String haar_data_file = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/opencv-4.1.0/data/lbpcascades/lbpcascade_frontalface_improved.xml&quot;</span>;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> artc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat frame, gray;
    <span class="hljs-built_in">vector</span>&lt;Rect&gt; faces;
    <span class="hljs-function">VideoCapture <span class="hljs-title">capture</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;
    faceDetector.load(haar_data_file);
    namedWindow(<span class="hljs-string">&quot;frame&quot;</span>, WINDOW_AUTOSIZE);
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        capture.read(frame);
        cvtColor(frame, gray, COLOR_BGR2GRAY);
        equalizeHist(gray, gray);
        faceDetector.detectMultiScale(gray, faces, <span class="hljs-number">1.2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, Size(<span class="hljs-number">30</span>, <span class="hljs-number">30</span>), Size(<span class="hljs-number">400</span>, <span class="hljs-number">400</span>));
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> t = <span class="hljs-number">0</span>; t &lt; faces.size(); t++) {
            rectangle(frame, faces[t], Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>);
        }
        <span class="hljs-keyword">char</span> c = waitKey(<span class="hljs-number">10</span>);
        <span class="hljs-keyword">if</span> (c == <span class="hljs-number">27</span>) {
            <span class="hljs-keyword">break</span>;
        }
        imshow(<span class="hljs-string">&quot;frame&quot;</span>, frame);
    }

    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="94&#x3001;orb-fast&#x7279;&#x5F81;&#x5173;&#x952E;&#x70B9;&#x68C0;&#x6D4B;">94&#x3001;ORB FAST&#x7279;&#x5F81;&#x5173;&#x952E;&#x70B9;&#x68C0;&#x6D4B;</h3>
<p>ORB - (Oriented Fast and Rotated BRIEF)&#x7B97;&#x6CD5;&#x662F;&#x57FA;&#x4E8E;FAST&#x7279;&#x5F81;&#x68C0;&#x6D4B;&#x4E0E;BRIEF&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D;&#x5B9E;&#x73B0;&#xFF0C;&#x76F8;&#x6BD4;BRIEF&#x7B97;&#x6CD5;&#x4E2D;&#x4F9D;&#x9760;&#x968F;&#x673A;&#x65B9;&#x5F0F;&#x83B7;&#x53D6;&#x800C;&#x503C;&#x70B9;&#x5BF9;&#xFF0C;ORB&#x901A;&#x8FC7;FAST&#x65B9;&#x6CD5;&#xFF0C;FAST&#x65B9;&#x5F0F;&#x5BFB;&#x627E;&#x5019;&#x9009;&#x7279;&#x5F81;&#x70B9;&#x65B9;&#x5F0F;&#x662F;&#x5047;&#x8BBE;&#x7070;&#x5EA6;&#x56FE;&#x50CF;&#x50CF;&#x7D20;&#x70B9;A&#x5468;&#x56F4;&#x7684;&#x50CF;&#x7D20;&#x5B58;&#x5728;&#x8FDE;&#x7EED;&#x5927;&#x4E8E;&#x6216;&#x8005;&#x5C0F;&#x4E8E;A&#x7684;&#x7070;&#x5EA6;&#x503C;&#xFF0C;&#x9009;&#x62E9;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x50CF;&#x7D20;&#x70B9;P&#xFF0C;&#x5047;&#x8BBE;&#x534A;&#x5F84;&#x4E3A;3&#xFF0C;&#x5468;&#x56F4;16&#x4E2A;&#x50CF;&#x7D20;&#x8868;&#x793A; &#x89C1;&#x56FE;&#x4E00;&#xFF01; &#x5219;&#x50CF;&#x7D20;&#x70B9;P&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x5019;&#x9009;&#x7279;&#x5F81;&#x70B9;&#x3001;&#x901A;&#x5E38;N&#x53D6;&#x503C;&#x4E3A;9&#x3001;12&#xFF0C;&#x4E0A;&#x56FE;N=9&#x3002; &#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x8BA1;&#x7B97;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53EA;&#x8BA1;&#x7B97;1&#x3001;9&#x3001;5&#x3001;13&#x56DB;&#x4E2A;&#x70B9;&#xFF0C;&#x81F3;&#x5C11;&#x5176;&#x4E2D;&#x4E09;&#x4E2A;&#x70B9;&#x6EE1;&#x8DB3;&#x4E0A;&#x8FF0;&#x4E0D;&#x7B49;&#x5F0F;&#x6761;&#x4EF6;&#xFF0C;&#x5373;&#x53EF;&#x5C06;P&#x89C6;&#x4E3A;&#x5019;&#x9009;&#x70B9;&#x3002;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x9608;&#x503C;&#x8FDB;&#x884C;&#x6700;&#x7EC8;&#x7684;&#x7B5B;&#x9009;&#x5373;&#x53EF;&#x5F97;&#x5230;ORB&#x7279;&#x5F81;&#x70B9;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">static</span> Ptr&amp;lt;ORB&amp;gt; cv::ORB::create    (
    <span class="hljs-keyword">int</span> nfeatures = <span class="hljs-number">500</span>,
    <span class="hljs-keyword">float</span> scaleFactor = <span class="hljs-number">1.2f</span>,
    <span class="hljs-keyword">int</span> nlevels = <span class="hljs-number">8</span>,
    <span class="hljs-keyword">int</span> edgeThreshold = <span class="hljs-number">31</span>,
    <span class="hljs-keyword">int</span> firstLevel = <span class="hljs-number">0</span>,
    <span class="hljs-keyword">int</span> WTA_K = <span class="hljs-number">2</span>,
    ORB::ScoreType     scoreType = ORB::HARRIS_SCORE,
    <span class="hljs-keyword">int</span> patchSize = <span class="hljs-number">31</span>,
    <span class="hljs-keyword">int</span> fastThreshold = <span class="hljs-number">20</span> 
)
nfeatures &#x6700;&#x7EC8;&#x8F93;&#x51FA;&#x6700;&#x5927;&#x7279;&#x5F81;&#x70B9;&#x6570;&#x76EE;
scaleFactor &#x91D1;&#x5B57;&#x5854;&#x4E0A;&#x91C7;&#x6837;&#x6BD4;&#x7387;
nlevels &#x91D1;&#x5B57;&#x5854;&#x5C42;&#x6570;
edgeThreshold &#x8FB9;&#x7F18;&#x9608;&#x503C;
firstLevel= <span class="hljs-number">0</span>
WTA_K&#x8FD9;&#x4E2A;&#x662F;&#x8DDF;BRIEF&#x63CF;&#x8FF0;&#x5B50;&#x7528;&#x7684;
scoreType &#x5BF9;&#x6240;&#x6709;&#x7684;&#x7279;&#x5F81;&#x70B9;&#x8FDB;&#x884C;&#x6392;&#x540D;&#x7528;&#x7684;&#x65B9;&#x6CD5;
</code></pre>
<p><img src="pic/110.png" alt=""></p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial/data/images/test1.png&quot;</span>);
    <span class="hljs-keyword">auto</span> orb_detector = ORB::create(<span class="hljs-number">1000</span>);
    <span class="hljs-built_in">vector</span>&lt;KeyPoint&gt; kpts;
    orb_detector-&gt;detect(src, kpts);
    Mat result = src.clone();
    drawKeypoints(src, kpts, result, Scalar::all(<span class="hljs-number">-1</span>), DrawMatchesFlags::DEFAULT);
    imshow(<span class="hljs-string">&quot;ORB-detector&quot;</span>, result);
    imwrite(<span class="hljs-string">&quot;./result.png&quot;</span>, result);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="95&#x3001;brief&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;">95&#x3001;BRIEF&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;</h3>
<p>BRIEF&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50; &#x5339;&#x914D; &#x5F97;&#x5230;&#x7279;&#x5F81;&#x70B9;&#x6570;&#x636E;&#x4E4B;&#x540E;&#xFF0C;&#x6839;&#x636E;BRIEF&#x7B97;&#x6CD5;&#x5C31;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x63CF;&#x8FF0;&#x5B50;&#x3002;&#x9009;&#x62E9;&#x5019;&#x9009;&#x7279;&#x5F81;&#x70B9;&#x5468;&#x56F4;SxS&#x5927;&#x5C0F;&#x7684;&#x50CF;&#x7D20;&#x5757;&#x3001;&#x968F;&#x673A;&#x9009;&#x62E9;n&#x5BF9;&#x50CF;&#x7D20;&#x70B9;&#x3002;&#x5176;&#x4E2D;P(x)&#x662F;&#x56FE;&#x50CF;&#x6A21;&#x7CCA;&#x5904;&#x7406;&#x4E4B;&#x540E;&#x7684;&#x50CF;&#x7D20;&#x503C;&#xFF0C;&#x539F;&#x56E0;&#x5728;&#x4E8E;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;&#x53EF;&#x4EE5;&#x6291;&#x5236;&#x566A;&#x58F0;&#x5F71;&#x54CD;&#x3001;&#x63D0;&#x4F9B;&#x7279;&#x5F81;&#x70B9;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x4E2D;&#x901A;&#x5E38;&#x7528;&#x5747;&#x503C;&#x6EE4;&#x6CE2;&#x66FF;&#x4EE3;&#x9AD8;&#x65AF;&#x6EE4;&#x6CE2;&#x4EE5;&#x4FBF;&#x5229;&#x7528;&#x79EF;&#x5206;&#x56FE;&#x65B9;&#x5F0F;&#x52A0;&#x901F;&#x8BA1;&#x7B97;&#x83B7;&#x5F97;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#x8868;&#x73B0;&#x3002;&#x5E38;&#x89C1;&#x6EE4;&#x6CE2;&#x65F6;&#x5019;&#x4F7F;&#x7528;3x3~9x9&#x4E4B;&#x95F4;&#x7684;&#x5377;&#x79EF;&#x6838;&#x3002;&#x6EE4;&#x6CE2;&#x4E4B;&#x540E;&#xFF0C;&#x6839;&#x636E;&#x4E0A;&#x8FF0;&#x63CF;&#x8FF0;&#x5B50;&#x7684;&#x751F;&#x6210;&#x6761;&#x4EF6;&#xFF0C;&#x5F97;&#x5230;&#x63CF;&#x8FF0;&#x5B50;&#x3002; &#x4F5C;&#x8005;&#x8BBA;&#x6587;&#x63D0;&#x5230;n&#x7684;&#x53D6;&#x503C;&#x901A;&#x5E38;&#x4E3A;128&#x3001;256&#x6216;&#x8005;512&#x3002;&#x5F97;&#x5230;&#x4E8C;&#x8FDB;&#x5236;&#x65B9;&#x5F0F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x63CF;&#x8FF0;&#x5B50;&#x4E4B;&#x540E;&#xFF0C;&#x5339;&#x914D;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;XOR&#x65B9;&#x5F0F;&#x77E9;&#x5F62;&#xFF0C;&#x8BA1;&#x7B97;&#x6C49;&#x660E;&#x8DDD;&#x79BB;&#x3002;ORB&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x8DDF;&#x7EAF;BRIEF&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x76F8;&#x6BD4;&#x8F83;&#xFF0C;BRIEF&#x65B9;&#x5F0F;&#x91C7;&#x7528;&#x968F;&#x673A;&#x70B9;&#x65B9;&#x5F0F;&#x5F97;&#x6700;&#x7EC8;&#x63CF;&#x8FF0;&#x5B50;&#x3001;&#x800C;ORB&#x901A;&#x8FC7;FAST&#x5F97;&#x5230;&#x7279;&#x5F81;&#x70B9;&#x7136;&#x540E;&#x5F97;&#x5230;&#x63CF;&#x8FF0;&#x5B50;&#x3002;</p>
<p><img src="pic/111.png" alt=""></p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat box = imread(<span class="hljs-string">&quot;D:/images/box.png&quot;</span>);
    Mat box_in_sence = imread(<span class="hljs-string">&quot;D:/images/box_in_scene.png&quot;</span>);

    <span class="hljs-comment">// &#x521B;&#x5EFA;ORB</span>
    <span class="hljs-keyword">auto</span> orb_detector = ORB::create();
    <span class="hljs-built_in">vector</span>&lt;KeyPoint&gt; kpts_01, kpts_02;
    Mat descriptors1, descriptors2;
    orb_detector-&gt;detectAndCompute(box, Mat(), kpts_01, descriptors1);
    orb_detector-&gt;detectAndCompute(box_in_sence, Mat(), kpts_02, descriptors2);

    <span class="hljs-comment">// &#x5B9A;&#x4E49;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D; - &#x66B4;&#x529B;&#x5339;&#x914D;</span>
    Ptr&lt;DescriptorMatcher&gt; matcher = DescriptorMatcher::create(DescriptorMatcher::BRUTEFORCE);
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt; DMatch &gt; matches;
    matcher-&gt;match(descriptors1, descriptors2, matches);

    <span class="hljs-comment">// &#x7ED8;&#x5236;&#x5339;&#x914D;</span>
    Mat img_matches;
    drawMatches(box, kpts_01, box_in_sence, kpts_02, matches, img_matches);
    imshow(<span class="hljs-string">&quot;ORB-Matches&quot;</span>, img_matches);
    imwrite(<span class="hljs-string">&quot;D:/result.png&quot;</span>, img_matches);

    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="96&#x3001;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D;">96&#x3001;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D;</h3>
<p>&#x56FE;&#x50CF;&#x7279;&#x5F81;&#x68C0;&#x6D4B;&#x9996;&#x5148;&#x4F1A;&#x83B7;&#x53D6;&#x5173;&#x952E;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x5173;&#x952E;&#x70B9;&#x5468;&#x56F4;&#x50CF;&#x7D20;ROI&#x533A;&#x57DF;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x751F;&#x6210;&#x63CF;&#x8FF0;&#x5B50;&#xFF0C;&#x5B8C;&#x6574;&#x7684;&#x63CF;&#x8FF0;&#x5B50;&#x5411;&#x91CF;&#x5C31;&#x8868;&#x793A;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#x50CF;&#x7684;&#x7279;&#x5F81;&#xFF0C;&#x662F;&#x56FE;&#x50CF;&#x7279;&#x5F81;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4E5F;&#x88AB;&#x79F0;&#x4E3A;&#x56FE;&#x50CF;&#x7279;&#x5F81;&#x5DE5;&#x7A0B;&#xFF0C;&#x5373;&#x901A;&#x8FC7;&#x5148;&#x9A8C;&#x6A21;&#x578B;&#x4E0E;&#x5408;&#x7406;&#x8BA1;&#x7B97;&#x5F97;&#x5230;&#x56FE;&#x50CF;&#x7279;&#x5F81;&#x6570;&#x636E;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x6709;&#x4E86;&#x7279;&#x5F81;&#x6570;&#x636E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x7279;&#x5F81;&#x6570;&#x636E;&#x5B9E;&#x73B0;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x4E0E;&#x5BF9;&#x8C61;&#x8BC6;&#x522B;&#xFF0C;&#x8FD9;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x7279;&#x5F81;&#x5339;&#x914D;&#xFF0C;<code>Opencv</code> &#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x56FE;&#x50CF;&#x7279;&#x5F81;&#x5339;&#x914D;&#x7684;&#x7B97;&#x6CD5; </p>
<ul>
<li>&#x66B4;&#x529B;&#x5339;&#x914D; -<br>   <code>FLANN</code> &#x5339;&#x914D; </li>
</ul>
<p>&#x5176;&#x4E2D;<code>FLANN</code>&#x662F;&#x4E00;&#x79CD;&#x9AD8;&#x6548;&#x7684;&#x6570;&#x503C;&#x6216;&#x8005;&#x5B57;&#x7B26;&#x4E32;&#x5339;&#x914D;&#x7B97;&#x6CD5;&#xFF0C;SIFT/SURF&#x662F;&#x57FA;&#x4E8E;&#x6D6E;&#x70B9;&#x6570;&#x7684;&#x5339;&#x914D;&#xFF0C;ORB&#x662F;&#x4E8C;&#x503C;&#x5339;&#x914D;&#xFF0C;&#x901F;&#x5EA6;&#x66F4;&#x5FEB;&#x3002;&#x5BF9;&#x4E8E;<code>FLANN</code>&#x5339;&#x914D;&#x7B97;&#x6CD5;&#xFF0C;&#x5F53;&#x4F7F;&#x7528;ORB&#x5339;&#x914D;&#x7B97;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x6784;&#x9020;HASH&#x3002;&#x8FD9;&#x4E2A;&#x5728;C++&#x7684;&#x4EE3;&#x7801;&#x79CD;&#x505A;&#x4E86;&#x6F14;&#x793A;&#x3002;&#x66B4;&#x529B;&#x5339;&#x914D;&#x5728;Python&#x4EE3;&#x7801;&#x79CD;&#x505A;&#x4E86;&#x6F14;&#x793A;&#x3002;&#x5BF9;&#x5339;&#x914D;&#x4E4B;&#x540E;&#x7684;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#xFF0C;&#x6839;&#x636E;&#x8DDD;&#x79BB;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x5C31;&#x4F1A;&#x5F97;&#x5230;&#x8DDD;&#x79BB;&#x6BD4;&#x8F83;&#x7684;&#x5339;&#x914D;&#x70B9;&#xFF0C;&#x8FD9;&#x4E2A;&#x624D;&#x662F;&#x597D;&#x7684;&#x7279;&#x5F81;&#x5339;&#x914D;&#x3002;</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;math.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RATIO    0.4</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat box = imread(<span class="hljs-string">&quot;D:/images/box.png&quot;</span>);
    Mat scene = imread(<span class="hljs-string">&quot;D:/images/box_in_scene.png&quot;</span>);
    <span class="hljs-keyword">if</span> (scene.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not load image...\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    imshow(<span class="hljs-string">&quot;input image&quot;</span>, scene);
    <span class="hljs-built_in">vector</span>&lt;KeyPoint&gt; keypoints_obj, keypoints_sence;
    Mat descriptors_box, descriptors_sence;
    Ptr&lt;ORB&gt; detector = ORB::create();
    detector-&gt;detectAndCompute(scene, Mat(), keypoints_sence, descriptors_sence);
    detector-&gt;detectAndCompute(box, Mat(), keypoints_obj, descriptors_box);

    <span class="hljs-built_in">vector</span>&lt;DMatch&gt; matches;
    <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;flann&#x5339;&#x914D;</span>
    <span class="hljs-comment">// Ptr&lt;FlannBasedMatcher&gt; matcher = FlannBasedMatcher::create(); // default is bad, using local sensitive hash(LSH)</span>
    Ptr&lt;DescriptorMatcher&gt; matcher = makePtr&lt;FlannBasedMatcher&gt;(makePtr&lt;flann::LshIndexParams&gt;(<span class="hljs-number">12</span>, <span class="hljs-number">20</span>, <span class="hljs-number">2</span>));
    matcher-&gt;match(descriptors_box, descriptors_sence, matches);

    <span class="hljs-comment">// &#x53D1;&#x73B0;&#x5339;&#x914D;</span>
    <span class="hljs-built_in">vector</span>&lt;DMatch&gt; goodMatches;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;total match points : %d\n&quot;</span>, matches.size());
    <span class="hljs-keyword">float</span> maxdist = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; matches.size(); ++i) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;dist : %.2f \n&quot;</span>, matches[i].distance);
        maxdist = max(maxdist, matches[i].distance);
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; matches.size(); ++i) {
        <span class="hljs-keyword">if</span> (matches[i].distance &lt; maxdist*RATIO)
            goodMatches.push_back(matches[i]);
    }

    Mat dst;
    drawMatches(box, keypoints_obj, scene, keypoints_sence, goodMatches, dst);
    imshow(<span class="hljs-string">&quot;output&quot;</span>, dst);

    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="97&#x3001;&#x57FA;&#x4E8E;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D;&#x7684;&#x5DF2;&#x77E5;&#x5BF9;&#x8C61;&#x5B9A;&#x4F4D;">97&#x3001;&#x57FA;&#x4E8E;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D;&#x7684;&#x5DF2;&#x77E5;&#x5BF9;&#x8C61;&#x5B9A;&#x4F4D;</h3>
<p>&#x56FE;&#x50CF;&#x7279;&#x5F81;&#x70B9;&#x68C0;&#x6D4B;&#x3001;&#x63CF;&#x8FF0;&#x5B50;&#x751F;&#x6210;&#x4EE5;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;OpenCV&#x63D0;&#x4F9B;&#x7684;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D;&#x7B97;&#x6CD5;&#xFF0C;&#x5F97;&#x5230;&#x63CF;&#x8FF0;&#x5B50;&#x76F4;&#x63A5;&#x7684;&#x8DDD;&#x79BB;&#xFF0C;&#x8DDD;&#x79BB;&#x8D8A;&#x5C0F;&#x7684;&#x8BF4;&#x660E;&#x662F;&#x5339;&#x914D;&#x8D8A;&#x597D;&#x7684;&#xFF0C;&#x8BBE;&#x5B9A;&#x4E00;&#x4E2A;&#x8DDD;&#x79BB;&#x9608;&#x503C;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x6700;&#x5927;&#x5339;&#x914D;&#x8DDD;&#x79BB;&#x7684;1/5&#xFF5E;1/4&#x5DE6;&#x53F3;&#x4F5C;&#x4E3A;&#x9608;&#x503C;&#xFF0C;&#x5F97;&#x5230;&#x6240;&#x6709;&#x5C0F;&#x4E8E;&#x9608;&#x503C;&#x7684;&#x5339;&#x914D;&#x70B9;&#xFF0C;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#xFF0C;&#x901A;&#x8FC7;&#x5355;&#x5E94;&#x6027;&#x77E9;&#x9635;&#xFF0C;&#x83B7;&#x5F97;&#x8FD9;&#x4E24;&#x4E2A;&#x70B9;&#x6240;&#x5728;&#x5E73;&#x9762;&#x7684;&#x53D8;&#x6362;&#x5173;&#x7CFB;H&#xFF0C;&#x6839;&#x636E;H&#x4F7F;&#x7528;&#x900F;&#x89C6;&#x53D8;&#x6362;&#x5C31;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x8F93;&#x5165;&#x7684;&#x5BF9;&#x8C61;&#x56FE;&#x50CF;&#x83B7;&#x5F97;&#x573A;&#x666F;&#x56FE;&#x50CF;&#x4E2D;&#x5BF9;&#x8C61;&#x4F4D;&#x7F6E;&#xFF0C;&#x6700;&#x7EC8;&#x7ED8;&#x5236;&#x4F4D;&#x7F6E;&#x5373;&#x53EF;&#x3002;</p>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;math.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RATIO    0.4</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat box = imread(<span class="hljs-string">&quot;D:/images/box.png&quot;</span>);
    Mat scene = imread(<span class="hljs-string">&quot;D:/images/box_in_scene.png&quot;</span>);
    <span class="hljs-keyword">if</span> (scene.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not load image...\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    imshow(<span class="hljs-string">&quot;input image&quot;</span>, scene);
    <span class="hljs-built_in">vector</span>&lt;KeyPoint&gt; keypoints_obj, keypoints_sence;
    Mat descriptors_box, descriptors_sence;
    Ptr&lt;ORB&gt; detector = ORB::create();
    detector-&gt;detectAndCompute(scene, Mat(), keypoints_sence, descriptors_sence);
    detector-&gt;detectAndCompute(box, Mat(), keypoints_obj, descriptors_box);

    <span class="hljs-built_in">vector</span>&lt;DMatch&gt; matches;
    <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;flann&#x5339;&#x914D;</span>
    <span class="hljs-comment">// Ptr&lt;FlannBasedMatcher&gt; matcher = FlannBasedMatcher::create(); // default is bad, using local sensitive hash(LSH)</span>
    Ptr&lt;DescriptorMatcher&gt; matcher = makePtr&lt;FlannBasedMatcher&gt;(makePtr&lt;flann::LshIndexParams&gt;(<span class="hljs-number">12</span>, <span class="hljs-number">20</span>, <span class="hljs-number">2</span>));
    matcher-&gt;match(descriptors_box, descriptors_sence, matches);

    <span class="hljs-comment">// &#x53D1;&#x73B0;&#x5339;&#x914D;</span>
    <span class="hljs-built_in">vector</span>&lt;DMatch&gt; goodMatches;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;total match points : %d\n&quot;</span>, matches.size());
    <span class="hljs-keyword">float</span> maxdist = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; matches.size(); ++i) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;dist : %.2f \n&quot;</span>, matches[i].distance);
        maxdist = max(maxdist, matches[i].distance);
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; matches.size(); ++i) {
        <span class="hljs-keyword">if</span> (matches[i].distance &lt; maxdist*RATIO)
            goodMatches.push_back(matches[i]);
    }

    Mat dst;
    drawMatches(box, keypoints_obj, scene, keypoints_sence, goodMatches, dst);
    imshow(<span class="hljs-string">&quot;output&quot;</span>, dst);

    <span class="hljs-comment">//-- Localize the object</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Point2f&gt; obj_pts;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Point2f&gt; scene_pts;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; goodMatches.size(); i++)
    {
        <span class="hljs-comment">//-- Get the keypoints from the good matches</span>
        obj_pts.push_back(keypoints_obj[goodMatches[i].queryIdx].pt);
        scene_pts.push_back(keypoints_sence[goodMatches[i].trainIdx].pt);
    }
    Mat H = findHomography(obj_pts, scene_pts, RHO);
    <span class="hljs-comment">// &#x65E0;&#x6CD5;&#x914D;&#x51C6;</span>
    <span class="hljs-comment">// Mat H = findHomography(obj, scene, RANSAC);</span>

    <span class="hljs-comment">//-- Get the corners from the image_1 ( the object to be &quot;detected&quot; )</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Point2f&gt; obj_corners(<span class="hljs-number">4</span>);
    obj_corners[<span class="hljs-number">0</span>] = Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>); obj_corners[<span class="hljs-number">1</span>] = Point(box.cols, <span class="hljs-number">0</span>);
    obj_corners[<span class="hljs-number">2</span>] = Point(box.cols, box.rows); obj_corners[<span class="hljs-number">3</span>] = Point(<span class="hljs-number">0</span>, box.rows);
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Point2f&gt; scene_corners(<span class="hljs-number">4</span>);
    perspectiveTransform(obj_corners, scene_corners, H);

    <span class="hljs-comment">//-- Draw lines between the corners (the mapped object in the scene - image_2 )</span>
    line(dst, scene_corners[<span class="hljs-number">0</span>] + Point2f(box.cols, <span class="hljs-number">0</span>), scene_corners[<span class="hljs-number">1</span>] + Point2f(box.cols, <span class="hljs-number">0</span>), Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">4</span>);
    line(dst, scene_corners[<span class="hljs-number">1</span>] + Point2f(box.cols, <span class="hljs-number">0</span>), scene_corners[<span class="hljs-number">2</span>] + Point2f(box.cols, <span class="hljs-number">0</span>), Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">4</span>);
    line(dst, scene_corners[<span class="hljs-number">2</span>] + Point2f(box.cols, <span class="hljs-number">0</span>), scene_corners[<span class="hljs-number">3</span>] + Point2f(box.cols, <span class="hljs-number">0</span>), Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">4</span>);
    line(dst, scene_corners[<span class="hljs-number">3</span>] + Point2f(box.cols, <span class="hljs-number">0</span>), scene_corners[<span class="hljs-number">0</span>] + Point2f(box.cols, <span class="hljs-number">0</span>), Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">4</span>);

    <span class="hljs-comment">//-- Show detected matches</span>
    imshow(<span class="hljs-string">&quot;Good Matches &amp; Object detection&quot;</span>, dst);
    imwrite(<span class="hljs-string">&quot;D:/result.png&quot;</span>, dst);
    waitKey(<span class="hljs-number">0</span>);

    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="98&#x3001;sift&#x7279;&#x5F81;&#x63D0;&#x53D6;-&#x2013;-&#x5173;&#x952E;&#x70B9;&#x63D0;&#x53D6;">98&#x3001;SIFT&#x7279;&#x5F81;&#x63D0;&#x53D6; &#x2013; &#x5173;&#x952E;&#x70B9;&#x63D0;&#x53D6;</h3>
<p>SIFT&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x662F;&#x56FE;&#x50CF;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E2D;&#x6700;&#x7ECF;&#x5178;&#x7684;&#x4E00;&#x4E2A;&#x7B97;&#x6CD5;&#xFF0C;&#x5F52;&#x7EB3;&#x8D77;&#x6765;SIFT&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E3B;&#x8981;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x6B65;&#xFF1A; </p>
<ul>
<li>&#x6784;&#x5EFA;&#x9AD8;&#x65AF;&#x591A;&#x5C3A;&#x5EA6;&#x91D1;&#x5B57;&#x5854; 
   &#x5173;&#x952E;&#x70B9;&#x67E5;&#x627E;/&#x8FC7;&#x6EE4;&#x4E0E;&#x7CBE;&#x51C6;&#x5B9A;&#x4F4D; 
   &#x7A97;&#x53E3;&#x533A;&#x57DF;&#x89D2;&#x5EA6;&#x65B9;&#x5411;&#x76F4;&#x65B9;&#x56FE; 
   &#x63CF;&#x8FF0;&#x5B50;&#x751F;&#x6210; </li>
</ul>
<p>SIFT&#x7279;&#x5F81;&#x662F;&#x975E;&#x5E38;&#x7A33;&#x5B9A;&#x7684;&#x56FE;&#x50CF;&#x7279;&#x5F81;&#xFF0C;&#x5728;&#x56FE;&#x50CF;&#x641C;&#x7D22;&#x3001;&#x7279;&#x5F81;&#x5339;&#x914D;&#x3001;&#x56FE;&#x50CF;&#x5206;&#x7C7B;&#x68C0;&#x6D4B;&#x7B49;&#x65B9;&#x9762;&#x5E94;&#x7528;&#x5341;&#x5206;&#x5E7F;&#x6CDB;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x7684;&#x7F3A;&#x70B9;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x660E;&#x663E;&#xFF0C;&#x5C31;&#x662F;&#x8BA1;&#x7B97;&#x91CF;&#x6BD4;&#x8F83;&#x5927;&#xFF0C;&#x5F88;&#x96BE;&#x5B9E;&#x65F6;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x4E00;&#x4E9B;&#x5B9E;&#x65F6;&#x8981;&#x6C42;&#x6BD4;&#x8F83;&#x9AD8;&#x7684;&#x5E38;&#x89C1;SIFT&#x7B97;&#x6CD5;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;&#x9002;&#x7528;&#x3002;&#x5982;&#x4ECA;SIFT&#x7B97;&#x6CD5;&#x5728;&#x6DF1;&#x5EA6;&#x5B66;&#x4E60;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E0E;&#x5206;&#x7C7B;&#x68C0;&#x6D4B;&#x7F51;&#x7EDC;&#x5927;&#x884C;&#x5176;&#x9053;&#x7684;&#x80CC;&#x666F;&#x4E0B;&#xFF0C;&#x5DF2;&#x7ECF;&#x8D8A;&#x6765;&#x8D8A;&#x6709;&#x9E21;&#x808B;&#x7684;&#x611F;&#x89C9;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x672C;&#x8EAB;&#x7684;&#x7B97;&#x6CD5;&#x77E5;&#x8BC6;&#x8FD8;&#x662F;&#x5F88;&#x503C;&#x5F97;&#x6211;&#x4EEC;&#x5B66;&#x4E60;&#xFF0C;&#x5BF9;&#x6211;&#x4EEC;&#x4E5F;&#x6709;&#x5F88;&#x591A;&#x6709;&#x76CA;&#x7684;&#x542F;&#x793A;&#xFF0C;&#x672C;&#x8D28;&#x4E0A;SIFT&#x7B97;&#x6CD5;&#x662F;&#x5F88;&#x591A;&#x5E38;&#x89C1;&#x7B97;&#x6CD5;&#x7684;&#x7EC4;&#x5408;&#x4E0E;&#x5DE7;&#x5999;&#x8854;&#x63A5;&#xFF0C;&#x8FD9;&#x4E2A;&#x601D;&#x8DEF;&#x5BF9;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5904;&#x7406;&#x95EE;&#x9898;&#x53EF;&#x4EE5;&#x5E26;&#x6765;&#x5F88;&#x591A;&#x6709;&#x76CA;&#x7684;&#x5E2E;&#x52A9;&#x3002;&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x9AD8;&#x6E05;&#x695A;SIFT&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x7684;&#x524D;&#x9762;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#xFF0C;&#x5C3A;&#x5EA6;&#x7A7A;&#x95F4;&#x91D1;&#x5B57;&#x5854;&#x4E0E;&#x5173;&#x952E;&#x70B9;&#x8FC7;&#x6EE4;&#x3002;</p>
<p><code>OpenCV</code>&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;SIFT&#x7B97;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x5728;<code>OpenCV3.0</code>&#x4E4B;&#x540E;&#x56E0;&#x4E3A;&#x4E13;&#x5229;&#x6388;&#x6743;&#x95EE;&#x9898;&#xFF0C;&#x8BE5;&#x7B97;&#x6CD5;&#x5728;&#x6269;&#x5C55;&#x6A21;&#x5757;<code>xfeature2d</code>&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x7F16;&#x8BD1;&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;<code>OpenCV Python</code>&#x4E2D;&#x4ECE;3.4.2&#x4E4B;&#x540E;&#x6269;&#x5C55;&#x6A21;&#x5757;&#x4E5F;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x5355;&#x72EC;&#x7F16;&#x8BD1;<code>python SDK</code>&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x3002;&#x5176;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x4E0E;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x4ECB;&#x7ECD;&#x7684;ORB&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#x3002;&#x90FD;&#x662F;&#x9075;&#x5FAA;&#x4E0B;&#x9762;&#x7684;&#x6B65;&#x9AA4;</p>
<ol>
<li>&#x521B;&#x5EFA;&#x5BF9;&#x8C61; </li>
<li>&#x901A;&#x8FC7;detect&#x65B9;&#x6CD5;&#x63D0;&#x53D6;&#x5BF9;&#x8C61;&#x5173;&#x952E;&#x70B9; 
.    &#x540C;drawKeypoints&#x7ED8;&#x5236;&#x5173;&#x952E;&#x70B9; </li>
</ol>
<p>&#x6784;&#x5EFA;&#x591A;&#x5C3A;&#x5EA6;&#x9AD8;&#x65AF;&#x91D1;&#x5B57;&#x5854; &#x4E3A;&#x4E86;&#x5728;&#x6BCF;&#x7EC4;&#x56FE;&#x50CF;&#x4E2D;&#x68C0;&#x6D4B; S &#x4E2A;&#x5C3A;&#x5EA6;&#x7684;&#x6781;&#x503C;&#x70B9;&#xFF0C;<code>DoG</code> &#x91D1;&#x5B57;&#x5854;&#x6BCF;&#x7EC4;&#x9700; S+2 &#x5C42;&#x56FE;&#x50CF;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x7EC4;&#x7684;&#x7B2C;&#x4E00;&#x5C42;&#x548C;&#x6700;&#x540E;&#x4E00;&#x5C42;&#x56FE;&#x50CF;&#x4E0A;&#x4E0D;&#x80FD;&#x68C0;&#x6D4B;&#x6781;&#x503C;&#xFF0C;<code>DoG</code> &#x91D1;&#x5B57;&#x5854;&#x7531;&#x9AD8;&#x65AF;&#x91D1;&#x5B57;&#x5854;&#x76F8;&#x90BB;&#x4E24;&#x5C42;&#x76F8;&#x51CF;&#x5F97;&#x5230;&#xFF0C;&#x5219;&#x9AD8;&#x65AF;&#x91D1;&#x5B57;&#x5854;&#x6BCF;&#x7EC4;&#x6700;&#x5C11;&#x9700; S+3 &#x5C42;&#x56FE;&#x50CF;&#xFF0C;&#x5B9E;&#x9645;&#x8BA1;&#x7B97;&#x65F6; S &#x901A;&#x5E38;&#x5728;2&#x5230;5&#x4E4B;&#x95F4;&#x3002;</p>
<p><img src="pic/108.jpeg" alt="">  </p>
<p><img src="pic/109.jpeg" alt=""></p>
<p><img src="pic/112.png" alt=""></p>
<p><img src="pic/113.jpeg" alt=""></p>
<p><img src="pic/114.png" alt=""></p>
<p><img src="pic/115.png" alt=""></p>
<h3 id="99&#x3001;sift&#x7279;&#x5F81;&#x63D0;&#x53D6;-&#x2013;-&#x63CF;&#x8FF0;&#x5B50;&#x751F;&#x6210;">99&#x3001;SIFT&#x7279;&#x5F81;&#x63D0;&#x53D6; &#x2013; &#x63CF;&#x8FF0;&#x5B50;&#x751F;&#x6210;</h3>
<p>SIFT&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x662F;&#x56FE;&#x50CF;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E2D;&#x6700;&#x7ECF;&#x5178;&#x7684;&#x4E00;&#x4E2A;&#x7B97;&#x6CD5;&#xFF0C;&#x5F52;&#x7EB3;&#x8D77;&#x6765;SIFT&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E3B;&#x8981;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x6B65;&#xFF1A; </p>
<ul>
<li>&#x6784;&#x5EFA;&#x9AD8;&#x65AF;&#x591A;&#x5C3A;&#x5EA6;&#x91D1;&#x5B57;&#x5854;
   &#x5173;&#x952E;&#x70B9;&#x67E5;&#x627E;/&#x8FC7;&#x6EE4;&#x4E0E;&#x7CBE;&#x51C6;&#x5B9A;&#x4F4D; 
   &#x7A97;&#x53E3;&#x533A;&#x57DF;&#x89D2;&#x5EA6;&#x65B9;&#x5411;&#x76F4;&#x65B9;&#x56FE; 
   &#x63CF;&#x8FF0;&#x5B50;&#x751F;&#x6210; </li>
</ul>
<p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#x4E86;SIFT&#x7279;&#x5F81;&#x70B9;&#x662F;&#x5982;&#x4F55;&#x63D0;&#x53D6;&#x7684;&#xFF0C;&#x6709;&#x4E86;&#x7279;&#x5F81;&#x70B9;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x7279;&#x5F81;&#x70B9;&#x5468;&#x56F4;&#x7684;&#x50CF;&#x7D20;&#x5757;&#x8BA1;&#x7B97;&#x89D2;&#x5EA6;&#x65B9;&#x5411;&#x76F4;&#x65B9;&#x56FE;&#xFF0C;&#x5728;&#x8BA1;&#x7B97;&#x76F4;&#x65B9;&#x56FE;&#x4E4B;&#x524D;&#x9996;&#x5148;&#x9700;&#x8981;&#x5BF9;&#x56FE;&#x50CF;&#x8FDB;&#x884C;&#x68AF;&#x5EA6;&#x8BA1;&#x7B97;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>SOBEL</code>&#x7B97;&#x5B50;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;<code>dx</code>&#x4E0E;<code>dy</code>&#x8BA1;&#x7B97;&#x68AF;&#x5EA6;&#x548C;&#x4E0E;&#x89D2;&#x5EA6;</p>
<p><img src="pic/116.jpeg" alt=""></p>
<p><img src="pic/117.jpeg" alt=""></p>
<p><img src="pic/118.jpeg" alt=""></p>
<p><img src="pic/119.png" alt=""></p>
<h3 id="100&#x3001;hog&#x7279;&#x5F81;&#x4E0E;&#x884C;&#x4EBA;&#x68C0;&#x6D4B;">100&#x3001;HOG&#x7279;&#x5F81;&#x4E0E;&#x884C;&#x4EBA;&#x68C0;&#x6D4B;</h3>
<p>HOG(Histogram of Oriented Gradient)&#x7279;&#x5F81;&#x5728;&#x5BF9;&#x8C61;&#x8BC6;&#x522B;&#x4E0E;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#x4E2D;&#x662F;&#x4E00;&#x79CD;&#x5E38;&#x89C1;&#x7684;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x7B97;&#x6CD5;&#xFF0C;&#x662F;&#x57FA;&#x4E8E;&#x672C;&#x5730;&#x50CF;&#x7D20;&#x5757;&#x8FDB;&#x884C;&#x7279;&#x5F81;&#x76F4;&#x65B9;&#x56FE;&#x63D0;&#x53D6;&#x7684;&#x4E00;&#x79CD;&#x7B97;&#x6CD5;&#xFF0C;&#x5BF9;&#x8C61;&#x5C40;&#x90E8;&#x7684;&#x53D8;&#x5F62;&#x4E0E;&#x5149;&#x7167;&#x5F71;&#x54CD;&#x6709;&#x5F88;&#x597D;&#x7684;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x6700;&#x521D;&#x662F;&#x7528;HOG&#x7279;&#x5F81;&#x6765;&#x6765;&#x8BC6;&#x522B;&#x4EBA;&#x50CF;&#xFF0C;&#x901A;&#x8FC7;HOG&#x7279;&#x5F81;&#x63D0;&#x53D6;+SVM&#x8BAD;&#x7EC3;&#xFF0C;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x5F88;&#x597D;&#x7684;&#x6548;&#x679C;&#xFF0C;OpenCV&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x3002;HOG&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x7684;&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#x770B;&#x7B2C;&#x4E00;&#x5F20;&#x56FE;</p>
<p><img src="pic/119.jpeg" alt=""></p>
<p><img src="pic/120.jpeg" alt=""></p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial/data/images/pedestrian.png&quot;</span>);
    <span class="hljs-keyword">if</span> (src.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not load image..\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    imshow(<span class="hljs-string">&quot;input&quot;</span>, src);
    HOGDescriptor *hog = <span class="hljs-keyword">new</span> HOGDescriptor();
    hog-&gt;setSVMDetector(hog-&gt;getDefaultPeopleDetector());
    <span class="hljs-built_in">vector</span>&lt;Rect&gt; objects;
    hog-&gt;detectMultiScale(src, objects, <span class="hljs-number">0.0</span>, Size(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>), Size(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>), <span class="hljs-number">1.25</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; objects.size(); i++) {
        rectangle(src, objects[i], Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>);
    }
    imshow(<span class="hljs-string">&quot;result&quot;</span>, src);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="101&#x3001;hog&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;-&#x2013;-&#x591A;&#x5C3A;&#x5EA6;&#x68C0;&#x6D4B;">101&#x3001;HOG&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50; &#x2013; &#x591A;&#x5C3A;&#x5EA6;&#x68C0;&#x6D4B;</h3>
<p>HOG(Histogram of Oriented Gradient)&#x7279;&#x5F81;&#x672C;&#x8EAB;&#x4E0D;&#x652F;&#x6301;&#x65CB;&#x8F6C;&#x4E0D;&#x53D8;&#x6027;&#xFF0C;&#x901A;&#x8FC7;&#x91D1;&#x5B57;&#x5854;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x591A;&#x5C3A;&#x5EA6;&#x68C0;&#x6D4B;&#x5B9E;&#x73B0;&#x5C3A;&#x5EA6;&#x7A7A;&#x95F4;&#x4E0D;&#x53D8;&#x6027;&#xFF0C;OpenCV&#x4E2D;&#x652F;&#x6301;HOG&#x63CF;&#x8FF0;&#x5B50;&#x591A;&#x5C3A;&#x5EA6;&#x68C0;&#x6D4B;&#x7684;&#x76F8;&#x5173;API&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> cv::HOGDescriptor::detectMultiScale(
    InputArray     img,
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&amp;lt; Rect &amp;gt; &amp;     foundLocations,
    <span class="hljs-keyword">double</span>     hitThreshold = <span class="hljs-number">0</span>,
    Size     winStride = Size(),
    Size     padding = Size(),
    <span class="hljs-keyword">double</span>     scale = <span class="hljs-number">1.05</span>,
    <span class="hljs-keyword">double</span>     finalThreshold = <span class="hljs-number">2.0</span>,
    <span class="hljs-keyword">bool</span>     useMeanshiftGrouping = <span class="hljs-literal">false</span> 
)
Img&#x8868;&#x793A;&#x8F93;&#x5165;&#x56FE;&#x50CF;
foundLocations&#x8868;&#x793A;&#x53D1;&#x73B0;&#x5BF9;&#x8C61;&#x77E9;&#x5F62;&#x6846;
hitThreshold&#x8868;&#x793A;SVM&#x8DDD;&#x79BB;&#x5EA6;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;<span class="hljs-number">0</span>&#x8868;&#x793A;&#xFF0C;&#x8868;&#x793A;&#x7279;&#x5F81;&#x4E0E;SVM&#x5206;&#x7C7B;&#x8D85;&#x5E73;&#x9762;&#x4E4B;&#x95F4;
winStride&#x8868;&#x793A;&#x7A97;&#x53E3;&#x6B65;&#x957F;
padding&#x8868;&#x793A;&#x586B;&#x5145;
scale&#x8868;&#x793A;&#x5C3A;&#x5EA6;&#x7A7A;&#x95F4;
finalThreshold &#x6700;&#x7EC8;&#x9608;&#x503C;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;<span class="hljs-number">2.0</span>
useMeanshiftGrouping &#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#xFF0C;&#x901F;&#x5EA6;&#x592A;&#x6162;&#x62C9;
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x5176;&#x4E2D;&#x7A97;&#x53E3;&#x6B65;&#x957F;&#x4E0E;Scale&#x5BF9;&#x7ED3;&#x679C;&#x5F71;&#x54CD;&#x6700;&#x5927;&#xFF0C;&#x7279;&#x522B;&#x662F;Scale&#xFF0C;&#x5C0F;&#x7684;&#x5C3A;&#x5EA6;&#x53D8;&#x5316;&#x6709;&#x5229;&#x4E8E;&#x68C0;&#x51FA;&#x4F4E;&#x5206;&#x8FA8;&#x7387;&#x5BF9;&#x8C61;&#xFF0C;&#x540C;&#x4E8B;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;FP&#x53D1;&#x751F;&#xFF0C;&#x9AD8;&#x7684;&#x53EF;&#x4EE5;&#x907F;&#x514D;FP&#x4F46;&#x662F;&#x4F1A;&#x4EA7;&#x751F;FN&#xFF08;&#x6709;&#x5BF9;&#x8C61;&#x6F0F;&#x68C0;&#xFF09;&#x3002;&#x7A97;&#x53E3;&#x6B65;&#x957F;&#x662F;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;block&#x533A;&#x57DF;&#xFF0C;&#x5173;&#x4E8E;Block&#x533A;&#x57DF;&#x53EF;&#x4EE5;&#x770B;&#x7B2C;&#x4E00;&#x5F20;&#x56FE;&#xFF1A;</p>
<h3 id="102&#x3001;hog&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;-&#x2013;-&#x63D0;&#x53D6;&#x63CF;&#x8FF0;&#x5B50;">102&#x3001;HOG&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50; &#x2013; &#x63D0;&#x53D6;&#x63CF;&#x8FF0;&#x5B50;</h3>
<p>&#x5BF9;&#x4E8E;HOG&#x7279;&#x5F81;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x9884;&#x5148;&#x8BAD;&#x7EC3;&#x7684;&#x7279;&#x5F81;&#x6570;&#x636E;&#xFF0C;&#x8FDB;&#x884C;&#x591A;&#x5C3A;&#x5EA6;&#x7684;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#xFF0C;OpenCV&#x4E2D;&#x57FA;&#x4E8E;HOG&#x7684;&#x884C;&#x4EBA;&#x68C0;&#x6D4B;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x6848;&#x4F8B;&#xFF0C;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7684;&#x68C0;&#x6D4B;&#xFF0C;&#x8FD9;&#x79CD;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#xFF0C;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#xFF1A;&#x901A;&#x8FC7;&#x63D0;&#x53D6;&#x6837;&#x672C;&#x7684;HOG&#x63CF;&#x8FF0;&#x5B50;&#xFF0C;&#x751F;&#x6210;&#x6837;&#x672C;&#x7684;&#x7279;&#x5F81;&#x6570;&#x636E;&#xFF0C;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x901A;&#x8FC7;SVM&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#x5B66;&#x4E60;&#x4E0E;&#x8BAD;&#x7EC3;&#xFF0C;&#x4FDD;&#x5B58;&#x4E3A;&#x6A21;&#x578B;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x4EE5;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6A21;&#x578B;&#x6765;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x5566;&#x3002;&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x5206;&#x4EAB;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x63D0;&#x53D6;HOG&#x63CF;&#x8FF0;&#x5B50;&#x3002;OpenCV&#x4E2D;&#x63D0;&#x53D6;HOG&#x63CF;&#x8FF0;&#x5B50;&#x7684;API&#x8868;&#x793A;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> cv::HOGDescriptor::compute(
    InputArray     img,
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt; <span class="hljs-keyword">float</span> &gt; &amp;     descriptors,
    Size     winStride = Size(),
    Size     padding = Size(),
    <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt; Point &gt; &amp; locations = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt; Point &gt;() 
)
</code></pre>
<p>&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x5927;&#x5C0F;<code>WxH=72x128</code> &#x9ED8;&#x8BA4;&#x7684;<code>HOG</code>&#x63CF;&#x8FF0;&#x5B50;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#x4E3A;<code>64x128</code>&#xFF0C;&#x7A97;&#x53E3;&#x79FB;&#x52A8;&#x7684;&#x6B65;&#x957F;<code>8x8</code> &#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x5185;&#x90E8;&#xFF0C;&#x6BCF;&#x4E2A;Cell&#x5927;&#x5C0F;&#x662F;<code>8x8</code>&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x7A97;&#x53E3;&#x53EF;&#x4EE5;&#x5212;&#x5206;&#x4E3A;<code>8x16</code>&#x7684;<code>Cells</code>&#x5927;&#x5C0F; &#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;<code>Block</code>&#x533A;&#x57DF;&#x6765;&#x8BF4;&#xFF0C;&#x6BCF;&#x6B21;&#x79FB;&#x52A8;&#x6B65;&#x957F;&#x662F;&#x4E00;&#x4E2A;Cell&#xFF0C;<code>8x16Cells</code>&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x603B;&#x6570;<code>7x15&#x4E2A;Block</code> &#x6BCF;&#x4E2A;Block&#x90FD;&#x662F;4&#x4E2A;Cell, 36&#x4E2A;&#x5411;&#x91CF;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x5F97;&#x5230;&#xFF1A; <code>7x15x36x2 = 7560</code>&#x4E2A;&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;&#xFF0C;&#x8FD9;&#x4E9B;&#x63CF;&#x8FF0;&#x5B50;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x6D6E;&#x70B9;&#x6570;&#x7279;&#x5F81;&#x6570;&#x636E;&#xFF0C;&#x5BF9;&#x4E8E;&#x9700;&#x8981;&#x8F93;&#x5165;&#x7684;&#x6837;&#x672C;&#x56FE;&#x50CF;&#x6765;&#x8BF4;&#xFF0C;&#x9700;&#x8981;&#x9996;&#x5148;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x9884;&#x5904;&#x7406;&#xFF0C;&#x628A;&#x56FE;&#x50CF;&#x5927;&#x5C0F;<code>resize</code>&#x4E3A;&#x8DDF;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#x4E00;&#x81F4;&#x6216;&#x8005;&#x628A;&#x7A97;&#x53E3;resize&#x8DDF;&#x56FE;&#x50CF;&#x5927;&#x5C0F;&#x4E00;&#x81F4;&#xFF0C;&#x8FD9;&#x6837;&#x6709;&#x5229;&#x4E8E;&#x4E0B;&#x4E00;&#x6B65;&#x5904;&#x7406;&#x3002;</p>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial/data/images/gaoyy_min.png&quot;</span>);
    <span class="hljs-keyword">if</span> (src.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not load image..\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    imshow(<span class="hljs-string">&quot;input&quot;</span>, src);
    HOGDescriptor hog;
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; features;
    hog.compute(src, features, Size(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>), Size(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>));

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;feature sum size :%d \n&quot;</span>, features.size());
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; features.size(); i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;v: %.2f\n &quot;</span>, features[i]);
    }
    imshow(<span class="hljs-string">&quot;result&quot;</span>, src);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="103&#x3001;hog&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;-&#x2013;-&#x4F7F;&#x7528;&#x63CF;&#x8FF0;&#x5B50;&#x7279;&#x5F81;&#x751F;&#x6210;&#x6837;&#x672C;&#x6570;&#x636E;">103&#x3001;HOG&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50; &#x2013; &#x4F7F;&#x7528;&#x63CF;&#x8FF0;&#x5B50;&#x7279;&#x5F81;&#x751F;&#x6210;&#x6837;&#x672C;&#x6570;&#x636E;</h3>
<p>&#x5BF9;&#x4E8E;<code>HOG</code>&#x7279;&#x5F81;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x9884;&#x5148;&#x8BAD;&#x7EC3;&#x7684;&#x7279;&#x5F81;&#x6570;&#x636E;&#xFF0C;&#x8FDB;&#x884C;&#x591A;&#x5C3A;&#x5EA6;&#x7684;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#xFF0C;<code>OpenCV</code>&#x4E2D;&#x57FA;&#x4E8E;<code>HOG</code>&#x7684;&#x884C;&#x4EBA;&#x68C0;&#x6D4B;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x6848;&#x4F8B;&#xFF0C;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7684;&#x68C0;&#x6D4B;&#xFF0C;&#x8FD9;&#x79CD;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#xFF0C;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#xFF1A;&#x901A;&#x8FC7;&#x63D0;&#x53D6;&#x6837;&#x672C;&#x7684;<code>HOG</code>&#x63CF;&#x8FF0;&#x5B50;&#xFF0C;&#x751F;&#x6210;&#x6837;&#x672C;&#x7684;&#x7279;&#x5F81;&#x6570;&#x636E;&#xFF0C;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x901A;&#x8FC7;<code>SVM</code>&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#x5B66;&#x4E60;&#x4E0E;&#x8BAD;&#x7EC3;&#xFF0C;&#x4FDD;&#x5B58;&#x4E3A;&#x6A21;&#x578B;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x4EE5;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6A21;&#x578B;&#x6765;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x5566;&#x3002;&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x5206;&#x4EAB;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4F7F;&#x7528;<code>HOG</code>&#x63CF;&#x8FF0;&#x5B50;&#x7279;&#x5F81;&#x6570;&#x636E;&#x751F;&#x6210;&#x6570;&#x636E;&#x96C6;&#xFF0C;&#x8FDB;&#x884C;<code>SVM</code>&#x5206;&#x7C7B;&#x8BAD;&#x7EC3;&#xFF0C;&#x5B9E;&#x73B0;&#x5BF9;&#x8C61;&#x5206;&#x7C7B;&#x8BC6;&#x522B;&#x3002; &#x8FD9;&#x91CC;&#x6211;&#x5DF2;&#x4E00;&#x4E2A;&#x5F88;&#x5E38;&#x89C1;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x7535;&#x8868;&#x68C0;&#x6D4B;&#x4E3A;&#x4F8B;&#xFF0C;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#x65E9;&#x671F;&#x4E3B;&#x8981;&#x901A;&#x8FC7;&#x7279;&#x5F81;&#x5339;&#x914D;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x53D7;&#x5230;&#x5404;&#x79CD;&#x56E0;&#x7D20;&#x5E72;&#x6270;&#xFF0C;&#x4E0D;&#x662F;&#x5F88;&#x597D;&#xFF0C;&#x901A;&#x8FC7;&#x63D0;&#x53D6;<code>HOG</code>&#x7279;&#x5F81;&#x3001;&#x8FDB;&#x884C;<code>SVM</code>&#x7279;&#x5F81;&#x5206;&#x7C7B;&#x3001;&#x7136;&#x540E;&#x5F00;&#x7A97;&#x68C0;&#x6D4B;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002; &#x5728;<code>OpenCV</code>&#x4E2D;&#x8BAD;&#x7EC3;<code>SVM</code>&#x6A21;&#x578B;&#xFF0C;&#x5176;&#x6570;&#x636E;&#x683C;&#x5F0F;&#x5E38;&#x89C1;&#x7684;&#x662F;&#x201C;&#x884C;&#x6A21;&#x5F0F;&#x201D;&#x5C31;&#x662F;&#x4E00;&#x884C;&#xFF08;&#x591A;&#x5217;&#x5411;&#x91CF;&#xFF09;&#x662F;&#x4E00;&#x4E2A;&#x6837;&#x672C;&#xFF0C;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x6807;&#x7B7E;(label)&#x3002;&#x8FD9;&#x91CC;&#x91C7;&#x7528;&#x9ED8;&#x8BA4;&#x7684;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#x4E3A;<code>64x128</code> &#x63D0;&#x53D6;<code>HOG</code>&#x7279;&#x5F81;&#x5411;&#x91CF;&#xFF0C;&#x5F97;&#x5230;&#x7684;&#x6BCF;&#x4E2A;&#x6837;&#x672C;&#x7684;&#x5411;&#x91CF;&#x6570;&#x76EE;&#x7B49;&#x4E8E;<code>7x15x36=3780</code>&#xFF0C;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x6837;&#x672C;&#x5C31;&#x6709;&#x591A;&#x5C11;&#x884C;&#xFF0C; &#x5BF9;&#x4E8E;&#x7684;&#x6807;&#x7B7E;&#x662F;&#x6BCF;&#x4E00;&#x884C;&#x5BF9;&#x5E94;&#x81EA;&#x5DF1;&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x8BAD;&#x7EC3;&#x6837;&#x672C;&#xFF0C;&#x6807;&#x7B7E;&#x5C31;&#x6709;&#x591A;&#x5C11;&#x884C;&#xFF01;</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::ml;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-built_in">string</span> positive_dir = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/dataset/elec_watch/positive/&quot;</span>;
<span class="hljs-built_in">string</span> negative_dir = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/dataset/elec_watch/negative/&quot;</span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_hog_descripor</span><span class="hljs-params">(Mat &amp;image, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; &amp;desc)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">generate_dataset</span><span class="hljs-params">(Mat &amp;trainData, Mat &amp;labels)</span></span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat trainData = Mat::zeros(Size(<span class="hljs-number">3780</span>, <span class="hljs-number">26</span>), CV_32FC1);
    Mat labels = Mat::zeros(Size(<span class="hljs-number">1</span>, <span class="hljs-number">26</span>), CV_32SC1);
    generate_dataset(trainData, labels);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_hog_descripor</span><span class="hljs-params">(Mat &amp;image, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; &amp;desc)</span> </span>{
    HOGDescriptor hog;
    <span class="hljs-keyword">int</span> h = image.rows;
    <span class="hljs-keyword">int</span> w = image.cols;
    <span class="hljs-keyword">float</span> rate = <span class="hljs-number">64.0</span> / w;
    Mat img, gray;
    resize(image, img, Size(<span class="hljs-number">64</span>, <span class="hljs-keyword">int</span>(rate*h)));
    cvtColor(img, gray, COLOR_BGR2GRAY);
    Mat result = Mat::zeros(Size(<span class="hljs-number">64</span>, <span class="hljs-number">128</span>), CV_8UC1);
    result = Scalar(<span class="hljs-number">127</span>);
    Rect roi;
    roi.x = <span class="hljs-number">0</span>;
    roi.width = <span class="hljs-number">64</span>;
    roi.y = (<span class="hljs-number">128</span> - gray.rows) / <span class="hljs-number">2</span>;
    roi.height = gray.rows;
    gray.copyTo(result(roi));
    hog.compute(result, desc, Size(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>), Size(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>));
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">generate_dataset</span><span class="hljs-params">(Mat &amp;trainData, Mat &amp;labels)</span> </span>{
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; images;
    glob(positive_dir, images);
    <span class="hljs-keyword">int</span> pos_num = images.size();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; images.size(); i++) {
        Mat image = imread(images[i].c_str());
        <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; fv;
        imshow(<span class="hljs-string">&quot;image&quot;</span>, image);
        waitKey(<span class="hljs-number">0</span>);
        get_hog_descripor(image, fv);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;image path : %s, feature data length: %d \n&quot;</span>, images[i].c_str(), fv.size());
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; fv.size(); j++) {
            trainData.at&lt;<span class="hljs-keyword">float</span>&gt;(i, j) = fv[j];
        }
        labels.at&lt;<span class="hljs-keyword">int</span>&gt;(i, <span class="hljs-number">0</span>) = <span class="hljs-number">1</span>;
    }

    images.clear();
    glob(negative_dir, images);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; images.size(); i++) {
        Mat image = imread(images[i].c_str());
        <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; fv;
        imshow(<span class="hljs-string">&quot;image&quot;</span>, image);
        waitKey(<span class="hljs-number">0</span>);
        get_hog_descripor(image, fv);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;image path : %s, feature data length: %d \n&quot;</span>, images[i].c_str(), fv.size());
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; fv.size(); j++) {
            trainData.at&lt;<span class="hljs-keyword">float</span>&gt;(i+pos_num, j) = fv[j];
        }
        labels.at&lt;<span class="hljs-keyword">int</span>&gt;(i+ pos_num, <span class="hljs-number">0</span>) = <span class="hljs-number">-1</span>;
    }
}
</code></pre>
<h3 id="104&#x3001;&#x7EBF;&#x6027;svm">104&#x3001;&#x7EBF;&#x6027;SVM</h3>
<p>&#x5BF9;&#x4E8E;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x6784;&#x5316;HOG&#x7279;&#x5F81;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x521D;&#x59CB;&#x5316;SVM&#x8FDB;&#x884C;&#x56DE;&#x5F52;&#x5206;&#x7C7B;&#x8BAD;&#x7EC3;&#xFF0C;&#x8FD9;&#x91CC;&#x91C7;&#x7528;&#x7684;&#x8BAD;&#x7EC3;&#x5668;&#x662F;SVM&#x7EBF;&#x6027;&#x5206;&#x7C7B;&#x5668;&#xFF0C;SVM&#x8FD8;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5206;&#x7C7B;&#x5668;&#x5C31;&#x662F;&#x5BF9;&#x4E8E;&#x7EBF;&#x6027;&#x4E0D;&#x53EF;&#x5206;&#x6570;&#x636E;&#x7684;&#x5F84;&#x5411;&#x5206;&#x7C7B;&#x5668;&#x3002;OpenCV&#x4E2D;&#x4F7F;&#x7528;&#x5F84;&#x5411;&#x5206;&#x7C7B;&#x5668;SVM&#x6709;&#x65F6;&#x5019;&#x4F1A;&#x8BAD;&#x7EC3;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#xFF0C;&#x800C;&#x4E14;&#x7ED3;&#x679C;&#x5F88;&#x7CDF;&#x7CD5;&#xFF0C;&#x751A;&#x81F3;&#x4F1A;&#x62A5;&#x4E00;&#x4E9B;&#x83AB;&#x540D;&#x5176;&#x5999;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x611F;&#x89C9;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x597D;&#x3002;&#x6240;&#x4EE5;&#x63A8;&#x8350;&#x5927;&#x5BB6;&#x771F;&#x5BF9;&#x7EBF;&#x6027;&#x4E0D;&#x53EF;&#x5206;&#x7684;&#x95EE;&#x9898;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;ANN&#x6A21;&#x5757;&#x3002; &#x5728;&#x8BAD;&#x7EC3;&#x4E4B;&#x524D;&#xFF0C;&#x9996;&#x5148;&#x7B80;&#x5355;&#x7684;&#x8BA4;&#x8BC6;&#x4E00;&#x4E0B;SVM&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x8FB9;&#x662F;&#x901A;&#x8FC7;&#x4E8C;&#x5206;&#x7C7B;&#x6765;&#x5B8C;&#x6210;&#xFF0C;&#x662F;&#x5F88;&#x5178;&#x578B;&#x7684;&#x7EBF;&#x6027;&#x53EF;&#x5206;&#x79BB;&#x7684;SVM&#x3002;</p>
<p>&#x5BF9;&#x7EBF;&#x6027;&#x53EF;&#x5206;&#x7684;&#x9009;&#x62E9;&#x7528;SVM&#xFF0C;&#x901A;&#x8FC7;&#x5F88;&#x5C11;&#x7684;&#x6837;&#x672C;&#x5B66;&#x4E60;&#x5C31;&#x4F1A;&#x53D6;&#x5F97;&#x5F88;&#x597D;&#x7684;&#x6548;&#x679C;&#x3002;OpenCV&#x4E2D;SVM&#x8BAD;&#x7EC3;&#x7684;API&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-c"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> cv::ml::StatModel::train(
    InputArray     samples,
    <span class="hljs-keyword">int</span> layout,
    InputArray     responses 
)
Sample&#x8868;&#x793A;&#x8BAD;&#x7EC3;&#x6837;&#x672C;&#x6570;&#x636E;/HOG&#x7279;&#x5F81;&#x6570;&#x636E;
Layout &#x6709;&#x4E24;&#x79CD;&#x7EC4;&#x7EC7;&#x65B9;&#x5F0F;ROW_SAMPLE&#x4E0E;COL_SAMPLE
Responses &#x6BCF;&#x4E2A;&#x8F93;&#x5165;&#x6837;&#x672C;&#x7684;&#x6807;&#x7B7E;

&#x5BF9;&#x4E8E;&#x8BAD;&#x7EC3;&#x597D;&#x7684;&#x6570;&#x636E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;save&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x4FDD;&#x5B58;&#xFF0C;&#x53EA;&#x8981;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x4FDD;&#x5B58;&#x8DEF;&#x5F84;&#x5373;&#x53EF;
</code></pre>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::ml;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-built_in">string</span> positive_dir = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/dataset/elec_watch/positive/&quot;</span>;
<span class="hljs-built_in">string</span> negative_dir = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/dataset/elec_watch/negative/&quot;</span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_hog_descripor</span><span class="hljs-params">(Mat &amp;image, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; &amp;desc)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">generate_dataset</span><span class="hljs-params">(Mat &amp;trainData, Mat &amp;labels)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">svm_train</span><span class="hljs-params">(Mat &amp;trainData, Mat &amp;labels)</span></span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat trainData = Mat::zeros(Size(<span class="hljs-number">3780</span>, <span class="hljs-number">26</span>), CV_32FC1);
    Mat labels = Mat::zeros(Size(<span class="hljs-number">1</span>, <span class="hljs-number">26</span>), CV_32SC1);
    generate_dataset(trainData, labels);
    svm_train(trainData, labels);
    Ptr&lt;SVM&gt; svm = SVM::load(<span class="hljs-string">&quot;./hog_elec.yml&quot;</span>);
    Mat test_img = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/dataset/elec_watch/test/scene_05.jpg&quot;</span>);
    <span class="hljs-comment">// Mat test_img = imread(&quot;D:/images/train_data/elec_watch/positive/box_01.bmp&quot;);</span>
    imshow(<span class="hljs-string">&quot;test image&quot;</span>, test_img);

    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; fv;
    get_hog_descripor(test_img, fv);
    Mat one_row = Mat::zeros(Size(fv.size(), <span class="hljs-number">1</span>), CV_32FC1);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; fv.size(); i++) {
        one_row.at&lt;<span class="hljs-keyword">float</span>&gt;(<span class="hljs-number">0</span>, i) = fv[i];
    }
    <span class="hljs-keyword">float</span> result = svm-&gt;predict(one_row);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n prediction result : %.2f \n&quot;</span>, result);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">svm_train</span><span class="hljs-params">(Mat &amp;trainData, Mat &amp;labels)</span> </span>{
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n start SVM training... \n&quot;</span>);
    Ptr&lt; SVM &gt; svm = SVM::create();
    <span class="hljs-comment">/* Default values to train SVM */</span>
    svm-&gt;setGamma(<span class="hljs-number">5.383</span>);
    svm-&gt;setKernel(SVM::LINEAR);
    svm-&gt;setC(<span class="hljs-number">2.67</span>);
    svm-&gt;setType(SVM::C_SVC);
    svm-&gt;train(trainData, ROW_SAMPLE, labels);
    <span class="hljs-built_in">clog</span> &lt;&lt; <span class="hljs-string">&quot;...[done]&quot;</span> &lt;&lt; <span class="hljs-built_in">endl</span>;

    <span class="hljs-comment">// save xml</span>
    svm-&gt;save(<span class="hljs-string">&quot;./hog_elec.yml&quot;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_hog_descripor</span><span class="hljs-params">(Mat &amp;image, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; &amp;desc)</span> </span>{
    HOGDescriptor hog;
    <span class="hljs-keyword">int</span> h = image.rows;
    <span class="hljs-keyword">int</span> w = image.cols;
    <span class="hljs-keyword">float</span> rate = <span class="hljs-number">64.0</span> / w;
    Mat img, gray;
    resize(image, img, Size(<span class="hljs-number">64</span>, <span class="hljs-keyword">int</span>(rate*h)));
    cvtColor(img, gray, COLOR_BGR2GRAY);
    Mat result = Mat::zeros(Size(<span class="hljs-number">64</span>, <span class="hljs-number">128</span>), CV_8UC1);
    result = Scalar(<span class="hljs-number">127</span>);
    Rect roi;
    roi.x = <span class="hljs-number">0</span>;
    roi.width = <span class="hljs-number">64</span>;
    roi.y = (<span class="hljs-number">128</span> - gray.rows) / <span class="hljs-number">2</span>;
    roi.height = gray.rows;
    gray.copyTo(result(roi));
    hog.compute(result, desc, Size(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>), Size(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>));
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">generate_dataset</span><span class="hljs-params">(Mat &amp;trainData, Mat &amp;labels)</span> </span>{
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; images;
    glob(positive_dir, images);
    <span class="hljs-keyword">int</span> pos_num = images.size();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; images.size(); i++) {
        Mat image = imread(images[i].c_str());
        <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; fv;
        get_hog_descripor(image, fv);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;image path : %s, feature data length: %d \n&quot;</span>, images[i].c_str(), fv.size());
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; fv.size(); j++) {
            trainData.at&lt;<span class="hljs-keyword">float</span>&gt;(i, j) = fv[j];
        }
        labels.at&lt;<span class="hljs-keyword">int</span>&gt;(i, <span class="hljs-number">0</span>) = <span class="hljs-number">1</span>;
    }

    images.clear();
    glob(negative_dir, images);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; images.size(); i++) {
        Mat image = imread(images[i].c_str());
        <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; fv;
        get_hog_descripor(image, fv);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;image path : %s, feature data length: %d \n&quot;</span>, images[i].c_str(), fv.size());
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; fv.size(); j++) {
            trainData.at&lt;<span class="hljs-keyword">float</span>&gt;(i + pos_num, j) = fv[j];
        }
        labels.at&lt;<span class="hljs-keyword">int</span>&gt;(i + pos_num, <span class="hljs-number">0</span>) = <span class="hljs-number">-1</span>;
    }
}
</code></pre>
<h3 id="105&#x3001;hog&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;-&#x2013;-&#x4F7F;&#x7528;hog&#x8FDB;&#x884C;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;">105&#x3001;HOG&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50; &#x2013; &#x4F7F;&#x7528;HOG&#x8FDB;&#x884C;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;</h3>
<p>&#x5BF9;&#x4E8E;&#x5DF2;&#x7ECF;&#x8BAD;&#x7EC3;&#x597D;&#x7684;HOG+SVM&#x7684;&#x6A21;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5F00;&#x7A97;&#x5B9E;&#x73B0;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#xFF0C;&#x4ECE;&#x800C;&#x5B8C;&#x6210;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x3002;&#x4EE5;&#x7535;&#x8868;&#x68C0;&#x6D4B;&#x4E3A;&#x4F8B;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x5B9E;&#x73B0;HOG+SVM&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x5168;&#x6D41;&#x7A0B;&#x3002;OpenCV&#x4E2D;&#x5B9E;&#x73B0;&#x5BF9;&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x50CF;&#x7D20;&#x5757;&#x9884;&#x6D4B;&#xFF0C;&#x9700;&#x8981;&#x9996;&#x5148;&#x52A0;&#x8F7D;SVM&#x6A21;&#x578B;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;predict&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x9884;&#x6D4B;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x7F3A;&#x70B9;&#x5C31;&#x662F;&#x5F00;&#x7A97;&#x68C0;&#x6D4B;&#x662F;&#x4ECE;&#x5DE6;&#x5230;&#x53F3;&#x3001;&#x4ECE;&#x4E0A;&#x5230;&#x4E0B;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x9AD8;&#x8017;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x6B65;&#x957F;&#x9009;&#x62E9;&#x4E00;&#x822C;&#x4F1A;&#x9009;&#x62E9;HOG&#x7A97;&#x53E3;&#x9ED8;&#x8BA4;&#x6B65;&#x957F;&#x7684;&#x4E00;&#x534A;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x68C0;&#x6D4B;&#x6846;&#x7684;&#x6570;&#x76EE;&#xFF0C;&#x540C;&#x65F6;&#x5728;predict&#x65F6;&#x5019;&#x4F1A;&#x53D1;&#x73B0;&#x591A;&#x4E2A;&#x91CD;&#x590D;&#x6846;&#xFF0C;&#x6C42;&#x53D6;&#x5B83;&#x4EEC;&#x7684;&#x5E73;&#x5747;&#x503C;&#x5373;&#x53EF;&#x5F97;&#x5230;&#x6700;&#x7EC8;&#x7684;&#x68C0;&#x6D4B;&#x6846;</p>
<pre><code class="lang-cpp">#include &lt;opencv2/opencv.hpp&gt;
#include &lt;iostream&gt;

using namespace cv;
using namespace cv::ml;
using namespace std;

string positive_dir = &quot;D:/images/train_data/elec_watch/positive/&quot;;
string negative_dir = &quot;D:/images/train_data/elec_watch/negative/&quot;;
void get_hog_descripor(Mat &amp;image, vector&lt;float&gt; &amp;desc);
void generate_dataset(Mat &amp;trainData, Mat &amp;labels);
void svm_train(Mat &amp;trainData, Mat &amp;labels);
vector&lt; float &gt; get_svm_detector(const Ptr&lt; SVM &gt;&amp; svm);

int main(int argc, char** argv) {
    /*
    Mat trainData = Mat::zeros(Size(3780, 26), CV_32FC1);
    Mat labels = Mat::zeros(Size(1, 26), CV_32SC1);
    generate_dataset(trainData, labels);
    svm_train(trainData, labels);
    */
    Ptr&lt;SVM&gt; svm = SVM::load(&quot;D:/vcworkspaces/hog_elec.yml&quot;);
    Mat test = imread(&quot;D:/images/train_data/elec_watch/test/scene_08.jpg&quot;);
    resize(test, test, Size(0, 0), 0.20, 0.20);

    imshow(&quot;input&quot;, test);
    Rect winRect;
    winRect.width = 64;
    winRect.height = 128;
    int sum_x = 0;
    int sum_y = 0;
    int count = 0;
    for (int row = 64; row &lt; test.rows - 64; row+=4) {
        for (int col = 32; col &lt; test.cols-32; col += 4) {
            winRect.x = col-32;
            winRect.y = row - 64;
            vector&lt;float&gt; fv;
            get_hog_descripor(test(winRect), fv);
            Mat one_row = Mat::zeros(Size(fv.size(), 1), CV_32FC1);
            for (int i = 0; i &lt; fv.size(); i++) {
                one_row.at&lt;float&gt;(0, i) = fv[i];
            }
            float result = svm-&gt;predict(one_row);
            if (result &gt; 0) {
                // rectangle(test, winRect, Scalar(0, 0, 255), 1, 8, 0);
                sum_x += winRect.x;
                sum_y += winRect.y;
                count++;
            }
        }
    }
    winRect.x = sum_x / count;
    winRect.y = sum_y / count;
    rectangle(test, winRect, Scalar(255, 0, 0), 1, 8, 0);
    imshow(&quot;result&quot;, test);
    waitKey(0);
    return 0;
}

vector&lt; float &gt; get_svm_detector(const Ptr&lt; SVM &gt;&amp; svm)
{
    // get the support vectors
    Mat sv = svm-&gt;getSupportVectors();
    const int sv_total = sv.rows;
    // get the decision function
    Mat alpha, svidx;
    double rho = svm-&gt;getDecisionFunction(0, alpha, svidx);

    CV_Assert(alpha.total() == 1 &amp;&amp; svidx.total() == 1 &amp;&amp; sv_total == 1);
    CV_Assert((alpha.type() == CV_64F &amp;&amp; alpha.at&lt;double&gt;(0) == 1.) ||
        (alpha.type() == CV_32F &amp;&amp; alpha.at&lt;float&gt;(0) == 1.f));
    CV_Assert(sv.type() == CV_32F);

    vector&lt; float &gt; hog_detector(sv.cols + 1);
    memcpy(&amp;hog_detector[0], sv.ptr(), sv.cols * sizeof(hog_detector[0]));
    hog_detector[sv.cols] = (float)-rho;
    return hog_detector;
}

void svm_train(Mat &amp;trainData, Mat &amp;labels) {
    printf(&quot;\n start SVM training... \n&quot;);
    Ptr&lt; SVM &gt; svm = SVM::create();
    /* Default values to train SVM */
    svm-&gt;setGamma(5.383);
    svm-&gt;setKernel(SVM::LINEAR);
    svm-&gt;setC(2.67);
    svm-&gt;setType(SVM::C_SVC);
    svm-&gt;train(trainData, ROW_SAMPLE, labels);
    clog &lt;&lt; &quot;...[done]&quot; &lt;&lt; endl;

    // save xml
    svm-&gt;save(&quot;D:/vcworkspaces/hog_elec.yml&quot;);
}

void get_hog_descripor(Mat &amp;image, vector&lt;float&gt; &amp;desc) {
    HOGDescriptor hog;
    int h = image.rows;
    int w = image.cols;
    float rate = 64.0 / w;
    Mat img, gray;
    resize(image, img, Size(64, int(rate*h)));
    cvtColor(img, gray, COLOR_BGR2GRAY);
    Mat result = Mat::zeros(Size(64, 128), CV_8UC1);
    result = Scalar(127);
    Rect roi;
    roi.x = 0;
    roi.width = 64;
    roi.y = (128 - gray.rows) / 2;
    roi.height = gray.rows;
    gray.copyTo(result(roi));
    hog.compute(result, desc, Size(8, 8), Size(0, 0));
}

void generate_dataset(Mat &amp;trainData, Mat &amp;labels) {
    vector&lt;string&gt; images;
    glob(positive_dir, images);
    int pos_num = images.size();
    for (int i = 0; i &lt; images.size(); i++) {
        Mat image = imread(images[i].c_str());
        vector&lt;float&gt; fv;
        get_hog_descripor(image, fv);
        printf(&quot;image path : %s, feature data length: %d \n&quot;, images[i].c_str(), fv.size());
        for (int j = 0; j &lt; fv.size(); j++) {
            trainData.at&lt;float&gt;(i, j) = fv[j];
        }
        labels.at&lt;int&gt;(i, 0) = 1;
    }

    images.clear();
    glob(negative_dir, images);
    for (int i = 0; i &lt; images.size(); i++) {
        Mat image = imread(images[i].c_str());
        vector&lt;float&gt; fv;
        get_hog_descripor(image, fv);
        printf(&quot;image path : %s, feature data length: %d \n&quot;, images[i].c_str(), fv.size());
        for (int j = 0; j &lt; fv.size(); j++) {
            trainData.at&lt;float&gt;(i + pos_num, j) = fv[j];
        }
        labels.at&lt;int&gt;(i + pos_num, 0) = -1;
    }
}
</code></pre>
<h3 id="106&#x3001;akaze&#x7279;&#x5F81;&#x4E0E;&#x63CF;&#x8FF0;&#x5B50;">106&#x3001;AKAZE&#x7279;&#x5F81;&#x4E0E;&#x63CF;&#x8FF0;&#x5B50;</h3>
<p>AKAZE&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x7B97;&#x6CD5;&#x662F;&#x5C40;&#x90E8;&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;&#x7B97;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x6210;&#x662F;SIFT&#x7B97;&#x6CD5;&#x7684;&#x6539;&#x8FDB;&#x3001;&#x91C7;&#x7528;&#x975E;&#x7EBF;&#x6027;&#x6269;&#x6563;&#x6EE4;&#x6CE2;&#x8FED;&#x4EE3;&#x6765;&#x63D0;&#x53D6;&#x4E0E;&#x6784;&#x5EFA;&#x5C3A;&#x5EA6;&#x7A7A;&#x95F4;&#x3001;&#x91C7;&#x7528;&#x4E0E;SIFT&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x5BFB;&#x627E;&#x7279;&#x5F81;&#x70B9;&#x3001;&#x5728;&#x63CF;&#x8FF0;&#x5B50;&#x751F;&#x6210;&#x9636;&#x6BB5;&#x91C7;&#x7528;ORB&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x751F;&#x6210;&#x63CF;&#x8FF0;&#x5B50;&#xFF0C;&#x4F46;&#x662F;&#x63CF;&#x8FF0;&#x5B50;&#x6BD4;ORB&#x591A;&#x4E86;&#x65CB;&#x8F6C;&#x4E0D;&#x53D8;&#x6027;&#x7279;&#x5F81;&#x3002;ORB&#x91C7;&#x7528;LDB&#x65B9;&#x6CD5;&#xFF0C;AKAZE&#x91C7;&#x7528; M-LDB</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat box = imread(<span class="hljs-string">&quot;D:/images/box.png&quot;</span>);
    Mat box_in_sence = imread(<span class="hljs-string">&quot;D:/images/box_in_scene.png&quot;</span>);

    <span class="hljs-comment">// &#x521B;&#x5EFA;AKAZE</span>
    <span class="hljs-keyword">auto</span> akaze_detector = AKAZE::create();
    <span class="hljs-built_in">vector</span>&lt;KeyPoint&gt; kpts_01, kpts_02;
    Mat descriptors1, descriptors2;
    akaze_detector-&gt;detectAndCompute(box, Mat(), kpts_01, descriptors1);
    akaze_detector-&gt;detectAndCompute(box_in_sence, Mat(), kpts_02, descriptors2);

    <span class="hljs-comment">// &#x5B9A;&#x4E49;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D; - &#x66B4;&#x529B;&#x5339;&#x914D;</span>
    Ptr&lt;DescriptorMatcher&gt; matcher = DescriptorMatcher::create(DescriptorMatcher::BRUTEFORCE);
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt; DMatch &gt; matches;
    matcher-&gt;match(descriptors1, descriptors2, matches);

    <span class="hljs-comment">// &#x7ED8;&#x5236;&#x5339;&#x914D;</span>
    Mat img_matches;
    drawMatches(box, kpts_01, box_in_sence, kpts_02, matches, img_matches);
    imshow(<span class="hljs-string">&quot;AKAZE-Matches&quot;</span>, img_matches);
    imwrite(<span class="hljs-string">&quot;D:/result.png&quot;</span>, img_matches);

    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="17&#x3001;brisk&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E0E;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D;">17&#x3001;Brisk&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E0E;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D;</h3>
<p>Brisk&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E0E;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D; BRISK(Binary robust invariant scalable keypoints)&#x662F;&#x4E00;&#x79CD;&#x57FA;&#x4E8E;&#x5C3A;&#x5EA6;&#x7A7A;&#x95F4;&#x4E0D;&#x53D8;&#x6027;&#x7C7B;&#x4F3C;ORB&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x5B50;&#x7684;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x7B97;&#x6CD5;&#x3002;BRISK&#x4E3B;&#x8981;&#x6B65;&#x9AA4;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x5982;&#x4E0B;&#x4E24;&#x6B65;&#xFF1A; </p>
<ol>
<li>&#x6784;&#x5EFA;&#x5C3A;&#x5EA6;&#x7A7A;&#x95F4;&#x91D1;&#x5B57;&#x5854;&#x5B9E;&#x73B0;&#x5173;&#x952E;&#x70B9;&#x5B9A;&#x4F4D; 
.    &#x6839;&#x636E;&#x5173;&#x952E;&#x70B9;&#x751F;&#x6210;&#x63CF;&#x8FF0;&#x5B50;</li>
</ol>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat box = imread(<span class="hljs-string">&quot;D:/images/box.png&quot;</span>);
    Mat box_in_sence = imread(<span class="hljs-string">&quot;D:/images/box_in_scene.png&quot;</span>);

    <span class="hljs-comment">// &#x521B;&#x5EFA;BRISK</span>
    <span class="hljs-keyword">auto</span> brisk_detector = BRISK::create();
    <span class="hljs-built_in">vector</span>&lt;KeyPoint&gt; kpts_01, kpts_02;
    Mat descriptors1, descriptors2;
    brisk_detector-&gt;detectAndCompute(box, Mat(), kpts_01, descriptors1);
    brisk_detector-&gt;detectAndCompute(box_in_sence, Mat(), kpts_02, descriptors2);

    <span class="hljs-comment">// &#x5B9A;&#x4E49;&#x63CF;&#x8FF0;&#x5B50;&#x5339;&#x914D; - &#x66B4;&#x529B;&#x5339;&#x914D;</span>
    Ptr&lt;DescriptorMatcher&gt; matcher = DescriptorMatcher::create(DescriptorMatcher::BRUTEFORCE);
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt; DMatch &gt; matches;
    matcher-&gt;match(descriptors1, descriptors2, matches);

    <span class="hljs-comment">// &#x7ED8;&#x5236;&#x5339;&#x914D;</span>
    Mat img_matches;
    drawMatches(box, kpts_01, box_in_sence, kpts_02, matches, img_matches);
    imshow(<span class="hljs-string">&quot;AKAZE-Matches&quot;</span>, img_matches);
    imwrite(<span class="hljs-string">&quot;D:/result.png&quot;</span>, img_matches);

    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="18&#x3001;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E4B;&#x5173;&#x952E;&#x70B9;&#x68C0;&#x6D4B;---gfttdetector">18&#x3001;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E4B;&#x5173;&#x952E;&#x70B9;&#x68C0;&#x6D4B; - GFTTDetector</h3>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x57FA;&#x4E8E;shi-tomas&#x89D2;&#x70B9;&#x68C0;&#x6D4B;&#x53D8;&#x5316;&#x800C;&#x6765;&#x7684;&#x4E00;&#x79CD;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x65B9;&#x6CD5;&#xFF0C;OpenCV&#x521B;&#x5EFA;&#x8BE5;&#x68C0;&#x6D4B;&#x5668;&#x7684;API&#x4E0E;goodfeaturetotrack&#x7684;API&#x53C2;&#x6570;&#x6781;&#x5176;&#x7C7B;&#x4F3C;&#xFF1A;</p>
<pre><code class="lang-cpp">Ptr&lt;GFTTDetector&gt; cv::GFTTDetector::create(
    <span class="hljs-keyword">int</span> maxCorners = <span class="hljs-number">1000</span>,
    <span class="hljs-keyword">double</span> qualityLevel = <span class="hljs-number">0.01</span>,
    <span class="hljs-keyword">double</span> minDistance = <span class="hljs-number">1</span>,
    <span class="hljs-keyword">int</span> blockSize = <span class="hljs-number">3</span>,
    <span class="hljs-keyword">bool</span> useHarrisDetector = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">double</span> k = <span class="hljs-number">0.04</span> 
)
</code></pre>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;D:/images/test1.png&quot;</span>);
    <span class="hljs-keyword">auto</span> keypoint_detector = GFTTDetector::create(<span class="hljs-number">1000</span>, <span class="hljs-number">0.01</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">3</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0.04</span>);
    <span class="hljs-built_in">vector</span>&lt;KeyPoint&gt; kpts;
    keypoint_detector-&gt;detect(src, kpts);
    Mat result = src.clone();
    drawKeypoints(src, kpts, result, Scalar::all(<span class="hljs-number">-1</span>), DrawMatchesFlags::DEFAULT);
    imshow(<span class="hljs-string">&quot;GFTT-Keypoint-Detect&quot;</span>, result);
    imwrite(<span class="hljs-string">&quot;D:/result.png&quot;</span>, result);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="109&#x3001;blob&#x7279;&#x5F81;&#x5206;&#x6790;-&#x2013;-simpleblobdetector&#x4F7F;&#x7528;">109&#x3001;BLOB&#x7279;&#x5F81;&#x5206;&#x6790; &#x2013; simpleblobdetector&#x4F7F;&#x7528;</h3>
<p>BLOB&#x662F;&#x56FE;&#x50CF;&#x4E2D;&#x7070;&#x5EA6;&#x5757;&#x7684;&#x4E00;&#x79CD;&#x4E13;&#x4E1A;&#x79F0;&#x547C;&#xFF0C;&#x66F4;&#x52A0;&#x53D8;&#x901A;&#x4E00;&#x70B9;&#x7684;&#x53EF;&#x4EE5;&#x8BF4;&#x5B83;&#x8DDF;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x4E8C;&#x503C;&#x56FE;&#x50CF;&#x5206;&#x6790;&#x7684;&#x8054;&#x901A;&#x7EC4;&#x4EF6;&#x7C7B;&#x4F3C;&#xFF0C;&#x901A;&#x8FC7;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x4E2D;&#x7684;SimpleBlobDetector&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5E38;&#x89C1;&#x7684;&#x5404;&#x79CD;&#x7070;&#x5EA6;BLOB&#x5BF9;&#x8C61;&#x7EC4;&#x4EF6;&#x68C0;&#x6D4B;&#x4E0E;&#x5206;&#x79BB;&#x3002;&#x4F7F;&#x7528;&#x8BE5;&#x68C0;&#x6D4B;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x8F93;&#x5165;&#x4E0D;&#x540C;&#x53C2;&#x6570;&#xFF0C;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x8DDF;&#x8F93;&#x5165;&#x7684;&#x53C2;&#x6570;&#x606F;&#x606F;&#x76F8;&#x5173;&#x3002;&#x5E38;&#x89C1;&#x7684;BLOB&#x5206;&#x6790;&#x652F;&#x6301;&#x5982;&#x4E0B;&#xFF1A; -    &#x6839;&#x636E;BLOB&#x9762;&#x79EF;&#x8FC7;&#x6EE4; -    &#x6839;&#x636E;&#x7070;&#x5EA6;/&#x989C;&#x8272;&#x503C;&#x8FC7;&#x6EE4; -    &#x6839;&#x636E;&#x5706;&#x5EA6;&#x8FC7;&#x6EE4; -    &#x6839;&#x636E;&#x957F;&#x8F74;&#x4E0E;&#x77ED;&#x8F74;&#x8FC7;&#x6EE4; -    &#x6839;&#x636E;&#x51F9;&#x51F8;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4; &#x53C2;&#x6570;&#x5217;&#x8868;&#xFF01; </p>
<pre><code class="lang-cpp">SimpleBlobDetector::Params::Params() 

<span class="hljs-keyword">bool</span>     filterByArea 

<span class="hljs-keyword">bool</span>     filterByCircularity 

<span class="hljs-keyword">bool</span>     filterByColor 

<span class="hljs-keyword">bool</span>     filterByConvexity 

<span class="hljs-keyword">bool</span>     filterByInertia 

<span class="hljs-keyword">float</span>     maxArea 

<span class="hljs-keyword">float</span>     maxCircularity 

<span class="hljs-keyword">float</span>     maxConvexity 

<span class="hljs-keyword">float</span>     maxInertiaRatio 

<span class="hljs-keyword">float</span>     maxThreshold 

<span class="hljs-keyword">float</span>     minArea 

<span class="hljs-keyword">float</span>     minCircularity 

<span class="hljs-keyword">float</span>     minConvexity 

<span class="hljs-keyword">float</span>     minDistBetweenBlobs 

<span class="hljs-keyword">float</span>     minInertiaRatio
</code></pre>
<h3 id="110&#x3001;kmeans-&#x6570;&#x636E;&#x5206;&#x7C7B;">110&#x3001;KMeans &#x6570;&#x636E;&#x5206;&#x7C7B;</h3>
<p>K-Means&#x7B97;&#x6CD5;&#x7684;&#x4F5C;&#x8005;&#x662F;MacQueen&#xFF0C; K-Means&#x7684;&#x7B97;&#x6CD5;&#x662F;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#x7684;&#x7B97;&#x6CD5;&#xFF0C;&#x91C7;&#x7528;&#x7684;&#x786C;&#x5206;&#x7C7B;&#x65B9;&#x5F0F;&#xFF0C;&#x662F;&#x5C5E;&#x4E8E;&#x975E;&#x76D1;&#x7763;&#x5B66;&#x4E60;&#x7684;&#x7B97;&#x6CD5;&#xFF0C;&#x9884;&#x5148;&#x8981;&#x6C42;&#x77E5;&#x9053;&#x5206;&#x4E3A;&#x51E0;&#x4E2A;&#x7C7B;&#x522B;&#xFF0C;&#x7136;&#x540E;&#x6BCF;&#x4E2A;&#x7C7B;&#x522B;&#x6709;&#x4E00;&#x4E2A;&#x4E2D;&#x5FC3;&#x70B9;&#xFF0C;&#x6839;&#x636E;&#x8DDD;&#x79BB;&#x5EA6;&#x91CF;&#x6765;&#x51B3;&#x5B9A;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x70B9;&#x5C5E;&#x4E8E;&#x54EA;&#x4E2A;&#x7C7B;&#x522B;&#x6807;&#x7B7E;&#xFF0C;&#x4E00;&#x6B21;&#x5FAA;&#x73AF;&#x5B9E;&#x73B0;&#x5BF9;&#x6240;&#x6709;&#x6570;&#x636E;&#x70B9;&#x5206;&#x7C7B;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x6807;&#x7B7E;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x5404;&#x4E2A;&#x7C7B;&#x578B;&#x7684;&#x4E2D;&#x5FC3;&#x4F4D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x7EE7;&#x7EED;&#x5FAA;&#x73AF;&#x6570;&#x636E;&#x96C6;&#x518D;&#x6B21;&#x5206;&#x7C7B;&#x6807;&#x7B7E;&#x6837;&#x672C;&#x6570;&#x636E;&#xFF0C;&#x5982;&#x6B64;&#x4E0D;&#x65AD;&#x8FED;&#x4EE3;&#xFF0C;&#x76F4;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x5FAA;&#x73AF;&#x6570;&#x76EE;&#x6216;&#x8005;&#x524D;&#x540E;&#x4E24;&#x6B21;delta&#x5C0F;&#x4E8E;&#x6307;&#x5B9A;&#x9608;&#x503C;&#xFF0C;&#x505C;&#x6B62;&#x8BA1;&#x7B97;&#xFF0C;&#x5F97;&#x5230;&#x6700;&#x7EC8;&#x5404;&#x4E2A;&#x6837;&#x672C;&#x6570;&#x636E;&#x7684;&#x6807;&#x7B7E;&#x3002;</p>
<pre><code class="lang-cpp">OpenCV&#x4E2D;KMeans&#x6570;&#x636E;&#x5206;&#x7C7B;&#x7684;API&#x4E3A;&#xFF1A;
<span class="hljs-keyword">double</span> cv::kmeans(
    InputArray data,
    <span class="hljs-keyword">int</span> K,
    InputOutputArray bestLabels,
    TermCriteria criteria,
    <span class="hljs-keyword">int</span> attempts,
    <span class="hljs-keyword">int</span> flags,
    OutputArray centers = noArray() 
)
data&#x8868;&#x793A;&#x8F93;&#x5165;&#x7684;&#x6837;&#x672C;&#x6570;&#x636E;&#xFF0C;&#x5FC5;&#x987B;&#x662F;&#x6309;&#x884C;&#x7EC4;&#x7EC7;&#x6837;&#x672C;&#xFF0C;&#x6BCF;&#x4E00;&#x884C;&#x4E3A;&#x4E00;&#x4E2A;&#x6837;&#x672C;&#x6570;&#x636E;&#xFF0C;&#x5217;&#x8868;&#x793A;&#x6837;&#x672C;&#x7684;&#x7EF4;&#x5EA6;
K&#x8868;&#x793A;&#x6700;&#x7EC8;&#x7684;&#x5206;&#x7C7B;&#x6570;&#x76EE;
bestLabels &#x8868;&#x793A;&#x6700;&#x7EC8;&#x5206;&#x7C7B;&#x6BCF;&#x4E2A;&#x6837;&#x672C;&#x7684;&#x6807;&#x7B7E;
criteria &#x8868;&#x793A;KMeans&#x5206;&#x5272;&#x7684;&#x505C;&#x6B62;&#x6761;&#x4EF6;
attempts &#x8868;&#x793A;&#x91C7;&#x6837;&#x4E0D;&#x540C;&#x521D;&#x59CB;&#x5316;&#x6807;&#x7B7E;&#x5C1D;&#x8BD5;&#x6B21;&#x6570;
flag&#x8868;&#x793A;&#x4E2D;&#x5FC3;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;
-    KMEANS_RANDOM_CENTERS     
-    KMEANS_PP_CENTERS     
-    KMEANS_USE_INITIAL_LABELS
centers&#x8868;&#x793A;&#x6700;&#x7EC8;&#x5206;&#x5272;&#x4EE5;&#x540E;&#x7684;&#x6BCF;&#x4E2A;cluster&#x7684;&#x4E2D;&#x5FC3;&#x4F4D;&#x7F6E;
</code></pre>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    <span class="hljs-function">Mat <span class="hljs-title">img</span><span class="hljs-params">(<span class="hljs-number">500</span>, <span class="hljs-number">500</span>, CV_8UC3)</span></span>;
    <span class="hljs-function">RNG <span class="hljs-title">rng</span><span class="hljs-params">(<span class="hljs-number">12345</span>)</span></span>;

    Scalar colorTab[] = {
        Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>),
        Scalar(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
    };

    <span class="hljs-keyword">int</span> numCluster = <span class="hljs-number">2</span>;
    <span class="hljs-keyword">int</span> sampleCount = rng.uniform(<span class="hljs-number">5</span>, <span class="hljs-number">500</span>);
    <span class="hljs-function">Mat <span class="hljs-title">points</span><span class="hljs-params">(sampleCount, <span class="hljs-number">1</span>, CV_32FC2)</span></span>;

    <span class="hljs-comment">// &#x751F;&#x6210;&#x968F;&#x673A;&#x6570;</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; numCluster; k++) {
        Point center;
        center.x = rng.uniform(<span class="hljs-number">0</span>, img.cols);
        center.y = rng.uniform(<span class="hljs-number">0</span>, img.rows);
        Mat pointChunk = points.rowRange(k*sampleCount / numCluster,
            k == numCluster - <span class="hljs-number">1</span> ? sampleCount : (k + <span class="hljs-number">1</span>)*sampleCount / numCluster);
        rng.fill(pointChunk, RNG::NORMAL, Scalar(center.x, center.y), Scalar(img.cols*<span class="hljs-number">0.05</span>, img.rows*<span class="hljs-number">0.05</span>));
    }
    randShuffle(points, <span class="hljs-number">1</span>, &amp;rng);

    <span class="hljs-comment">// &#x4F7F;&#x7528;KMeans</span>
    Mat labels;
    Mat centers;
    kmeans(points, numCluster, labels, TermCriteria(TermCriteria::EPS + TermCriteria::COUNT, <span class="hljs-number">10</span>, <span class="hljs-number">0.1</span>), <span class="hljs-number">3</span>, KMEANS_PP_CENTERS, centers);

    <span class="hljs-comment">// &#x7528;&#x4E0D;&#x540C;&#x989C;&#x8272;&#x663E;&#x793A;&#x5206;&#x7C7B;</span>
    img = Scalar::all(<span class="hljs-number">255</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; sampleCount; i++) {
        <span class="hljs-keyword">int</span> index = labels.at&lt;<span class="hljs-keyword">int</span>&gt;(i);
        Point p = points.at&lt;Point2f&gt;(i);
        circle(img, p, <span class="hljs-number">2</span>, colorTab[index], <span class="hljs-number">-1</span>, <span class="hljs-number">8</span>);
    }

    <span class="hljs-comment">// &#x6BCF;&#x4E2A;&#x805A;&#x7C7B;&#x7684;&#x4E2D;&#x5FC3;&#x6765;&#x7ED8;&#x5236;&#x5706;</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; centers.rows; i++) {
        <span class="hljs-keyword">int</span> x = centers.at&lt;<span class="hljs-keyword">float</span>&gt;(i, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">int</span> y = centers.at&lt;<span class="hljs-keyword">float</span>&gt;(i, <span class="hljs-number">1</span>);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;c.x= %d, c.y=%d&quot;</span>, x, y);
        circle(img, Point(x, y), <span class="hljs-number">40</span>, colorTab[i], <span class="hljs-number">1</span>, LINE_AA);
    }

    imshow(<span class="hljs-string">&quot;KMeans-Data-Demo&quot;</span>, img);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="111&#x3001;kmeans-&#x56FE;&#x50CF;&#x5206;&#x5272;">111&#x3001;KMeans &#x56FE;&#x50CF;&#x5206;&#x5272;</h3>
<p><code>KMean</code>&#x4E0D;&#x5149;&#x53EF;&#x4EE5;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5BF9;&#x56FE;&#x50CF;&#x5206;&#x5272;&#xFF0C;&#x4EC0;&#x4E48;&#x56FE;&#x50CF;&#x5206;&#x5272;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x5C31;&#x8981;&#x56FE;&#x50CF;&#x7684;&#x5404;&#x79CD;&#x50CF;&#x7D20;&#x503C;&#xFF0C;&#x5206;&#x5272;&#x4E3A;&#x51E0;&#x4E2A;&#x6307;&#x5B9A;&#x7C7B;&#x522B;&#x989C;&#x8272;&#x503C;&#xFF0C;&#x8FD9;&#x79CD;&#x5206;&#x5272;&#x6709;&#x4E24;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x56FE;&#x50CF;&#x4E3B;&#x8272;&#x5F69;&#x7684;&#x7B80;&#x5355;&#x63D0;&#x53D6;&#xFF0C;&#x53E6;&#x5916;&#x9488;&#x5BF9;&#x7279;&#x5B9A;&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x8BC1;&#x4EF6;&#x7167;&#x7247;&#x7684;&#x80CC;&#x666F;&#x66FF;&#x6362;&#x6548;&#x679C;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x9762;&#x65E9;&#x671F;&#x6700;&#x597D;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x662F;&#x8BC1;&#x4EF6;&#x4E4B;&#x661F;&#x4E0A;&#x9762;&#x7684;&#x80CC;&#x666F;&#x66FF;&#x6362;&#x3002;&#x5F53;&#x7136;&#x8981;&#x60F3;&#x5B9E;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x7EDD;&#x5BF9;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;<code>KMeans</code>&#x5C31;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x7684;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x7CFB;&#x5217;&#x540E;&#x7EED;&#x7684;&#x4EA4;&#x4E92;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x5B8C;&#x6210;&#x3002;&#x5BF9;&#x56FE;&#x50CF;&#x6570;&#x636E;&#x6765;&#x8BF4;&#xFF0C;&#x8981;&#x628A;&#x6BCF;&#x4E2A;&#x50CF;&#x7D20;&#x70B9;&#x4F5C;&#x4E3A;&#x5355;&#x72EC;&#x7684;&#x6837;&#x672C;&#xFF0C;&#x6309;&#x884C;&#x7EC4;&#x7EC7;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8C03;&#x7528;<code>OpenCV</code>&#x7684;Mat&#x4E2D;&#x51FD;&#x6570;reshape&#x5373;&#x53EF;&#x5B9E;&#x73B0;</p>
<pre><code>Mat cv::Mat::reshape(
    int cn,
    int rows = 0 
)const
cn&#x53C2;&#x6570;&#x8868;&#x793A;&#x901A;&#x9053;&#x6570;
rows&#x8868;&#x793A;&#x6539;&#x4E3A;&#x591A;&#x5C11;&#x884C;
</code></pre><pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/toux.jpg&quot;</span>);
    <span class="hljs-keyword">if</span> (src.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not load image...\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    namedWindow(<span class="hljs-string">&quot;input image&quot;</span>, WINDOW_AUTOSIZE);
    imshow(<span class="hljs-string">&quot;input image&quot;</span>, src);

    Scalar colorTab[] = {
        Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>),
        Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>),
        Scalar(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
        Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>),
        Scalar(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)
    };

    <span class="hljs-keyword">int</span> width = src.cols;
    <span class="hljs-keyword">int</span> height = src.rows;
    <span class="hljs-keyword">int</span> dims = src.channels();

    <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;&#x5B9A;&#x4E49;</span>
    <span class="hljs-keyword">int</span> sampleCount = width*height;
    <span class="hljs-keyword">int</span> clusterCount = <span class="hljs-number">3</span>;
    Mat labels;
    Mat centers;

    <span class="hljs-comment">// RGB &#x6570;&#x636E;&#x8F6C;&#x6362;&#x5230;&#x6837;&#x672C;&#x6570;&#x636E;</span>
    Mat sample_data = src.reshape(<span class="hljs-number">3</span>, sampleCount);
    Mat data;
    sample_data.convertTo(data, CV_32F);

    <span class="hljs-comment">// &#x8FD0;&#x884C;K-Means</span>
    TermCriteria criteria = TermCriteria(TermCriteria::EPS + TermCriteria::COUNT, <span class="hljs-number">10</span>, <span class="hljs-number">0.1</span>);
    kmeans(data, clusterCount, labels, criteria, clusterCount, KMEANS_PP_CENTERS, centers);

    <span class="hljs-comment">// &#x663E;&#x793A;&#x56FE;&#x50CF;&#x5206;&#x5272;&#x7ED3;&#x679C;</span>
    <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;
    Mat result = Mat::zeros(src.size(), src.type());
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; height; row++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> col = <span class="hljs-number">0</span>; col &lt; width; col++) {
            index = row*width + col;
            <span class="hljs-keyword">int</span> label = labels.at&lt;<span class="hljs-keyword">int</span>&gt;(index, <span class="hljs-number">0</span>);
            result.at&lt;Vec3b&gt;(row, col)[<span class="hljs-number">0</span>] = colorTab[label][<span class="hljs-number">0</span>];
            result.at&lt;Vec3b&gt;(row, col)[<span class="hljs-number">1</span>] = colorTab[label][<span class="hljs-number">1</span>];
            result.at&lt;Vec3b&gt;(row, col)[<span class="hljs-number">2</span>] = colorTab[label][<span class="hljs-number">2</span>];
        }
    }

    imshow(<span class="hljs-string">&quot;KMeans-image-Demo&quot;</span>, result);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="112&#x3001;kmeans-&#x56FE;&#x50CF;&#x5206;&#x5272;-&#x2013;-&#x80CC;&#x666F;&#x66FF;&#x6362;">112&#x3001;KMeans &#x56FE;&#x50CF;&#x5206;&#x5272; &#x2013; &#x80CC;&#x666F;&#x66FF;&#x6362;</h3>
<p>KMeans&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;&#x8BC1;&#x4EF6;&#x7167;&#x7247;&#x7684;&#x80CC;&#x666F;&#x5206;&#x5272;&#x63D0;&#x53D6;&#x4E0E;&#x66FF;&#x6362;&#xFF0C;&#x5927;&#x81F4;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x5982;&#x4E0B;&#x51E0;&#x6B65;&#x5B9E;&#x73B0; </p>
<ol>
<li>&#x8BFB;&#x5165;&#x56FE;&#x50CF;&#x5EFA;&#x7ACB;KMenas&#x6837;&#x672C; 
.    &#x4F7F;&#x7528;KMeans&#x56FE;&#x50CF;&#x5206;&#x5272;&#xFF0C;&#x6307;&#x5B9A;&#x6307;&#x5B9A;&#x5206;&#x7C7B;&#x6570;&#x76EE; 
.    &#x53D6;&#x5DE6;&#x4E0A;&#x89D2;&#x7684;label&#x5F97;&#x5230;&#x80CC;&#x666F;cluster index 
.    &#x751F;&#x6210;mask&#x533A;&#x57DF;&#xFF0C;&#x7136;&#x540E;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;&#x8FDB;&#x884C;&#x80CC;&#x666F;&#x66FF;&#x6362;</li>
</ol>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/toux.jpg&quot;</span>);
    <span class="hljs-keyword">if</span> (src.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not load image...\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    namedWindow(<span class="hljs-string">&quot;input image&quot;</span>, WINDOW_AUTOSIZE);
    imshow(<span class="hljs-string">&quot;input image&quot;</span>, src);

    <span class="hljs-keyword">int</span> width = src.cols;
    <span class="hljs-keyword">int</span> height = src.rows;
    <span class="hljs-keyword">int</span> dims = src.channels();

    <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;&#x5B9A;&#x4E49;</span>
    <span class="hljs-keyword">int</span> sampleCount = width*height;
    <span class="hljs-keyword">int</span> clusterCount = <span class="hljs-number">3</span>;
    Mat labels;
    Mat centers;

    <span class="hljs-comment">// RGB &#x6570;&#x636E;&#x8F6C;&#x6362;&#x5230;&#x6837;&#x672C;&#x6570;&#x636E;</span>
    Mat sample_data = src.reshape(<span class="hljs-number">3</span>, sampleCount);
    Mat data;
    sample_data.convertTo(data, CV_32F);

    <span class="hljs-comment">// &#x8FD0;&#x884C;K-Means</span>
    TermCriteria criteria = TermCriteria(TermCriteria::EPS + TermCriteria::COUNT, <span class="hljs-number">10</span>, <span class="hljs-number">0.1</span>);
    kmeans(data, clusterCount, labels, criteria, clusterCount, KMEANS_PP_CENTERS, centers);

    Mat mask = Mat::zeros(src.size(), CV_8UC1);
    <span class="hljs-keyword">int</span> index = labels.at&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    labels = labels.reshape(<span class="hljs-number">1</span>, height);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; height; row++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> col = <span class="hljs-number">0</span>; col &lt; width; col++) {
            <span class="hljs-keyword">int</span> c = labels.at&lt;<span class="hljs-keyword">int</span>&gt;(row, col);
            <span class="hljs-keyword">if</span> (c == index) {
                mask.at&lt;uchar&gt;(row, col) = <span class="hljs-number">255</span>;
            }
        }
    }

    Mat se = getStructuringElement(MORPH_RECT, Size(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), Point(<span class="hljs-number">-1</span>, <span class="hljs-number">-1</span>));
    dilate(mask, mask, se);
    GaussianBlur(mask, mask, Size(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>), <span class="hljs-number">0</span>);
    Mat result = Mat::zeros(src.size(), CV_8UC3);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; height; row++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> col = <span class="hljs-number">0</span>; col &lt; width; col++) {
            <span class="hljs-keyword">float</span> w1 = mask.at&lt;uchar&gt;(row, col) / <span class="hljs-number">255.0</span>;
            Vec3b bgr = src.at&lt;Vec3b&gt;(row, col);
            bgr[<span class="hljs-number">0</span>] = w1 * <span class="hljs-number">255.0</span> + bgr[<span class="hljs-number">0</span>] * (<span class="hljs-number">1.0</span> - w1);
            bgr[<span class="hljs-number">1</span>] = w1 * <span class="hljs-number">0</span> + bgr[<span class="hljs-number">1</span>] * (<span class="hljs-number">1.0</span> - w1);
            bgr[<span class="hljs-number">2</span>] = w1 * <span class="hljs-number">255.0</span> + bgr[<span class="hljs-number">2</span>] * (<span class="hljs-number">1.0</span> - w1);
            result.at&lt;Vec3b&gt;(row, col) = bgr;
        }
    }
    imshow(<span class="hljs-string">&quot;KMeans-image-Demo&quot;</span>, result);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="113&#x3001;kmeans-&#x56FE;&#x50CF;&#x5206;&#x5272;-&#x2013;-&#x4E3B;&#x8272;&#x5F69;&#x63D0;&#x53D6;">113&#x3001;KMeans &#x56FE;&#x50CF;&#x5206;&#x5272; &#x2013; &#x4E3B;&#x8272;&#x5F69;&#x63D0;&#x53D6;</h3>
<p>KMeans &#x56FE;&#x50CF;&#x5206;&#x5272; &#x2013; &#x4E3B;&#x8272;&#x5F69;&#x63D0;&#x53D6; KMeans&#x5206;&#x5272;&#x4F1A;&#x8BA1;&#x7B97;&#x51FA;&#x6BCF;&#x4E2A;&#x805A;&#x7C7B;&#x7684;&#x50CF;&#x7D20;&#x5E73;&#x5747;&#x503C;&#xFF0C;&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x56FE;&#x50CF;&#x7684;&#x4E3B;&#x8272;&#x5F69;RGB&#x5206;&#x5E03;&#x6210;&#x5206;&#x591A;&#x5C11;&#xFF0C;&#x5F97;&#x5230;&#x5404;&#x79CD;&#x8272;&#x5F69;&#x5728;&#x56FE;&#x50CF;&#x4E2D;&#x7684;&#x6BD4;&#x91CD;&#xFF0C;&#x7ED8;&#x5236;&#x51FA;&#x56FE;&#x50CF;&#x5BF9;&#x5E94;&#x7684;&#x53D6;&#x8272;&#x5361;&#xFF01;&#x8FD9;&#x4E2A;&#x65B9;&#x9762;&#x5728;&#x7EBA;&#x7EC7;&#x4E0E;&#x586B;&#x8272;&#x65B9;&#x9762;&#x7279;&#x522B;&#x6709;&#x7528;&#xFF01;&#x4E3B;&#x8981;&#x6B65;&#x9AA4;&#x663E;&#x793A;&#x5982;&#x4E0B;&#xFF1A; </p>
<ol>
<li>&#x8BFB;&#x5165;&#x56FE;&#x50CF;&#x5EFA;&#x7ACB;KMenas&#x6837;&#x672C;
.    &#x4F7F;&#x7528;KMeans&#x56FE;&#x50CF;&#x5206;&#x5272;&#xFF0C;&#x6307;&#x5B9A;&#x5206;&#x7C7B;&#x6570;&#x76EE; 
.    &#x7EDF;&#x8BA1;&#x5404;&#x4E2A;&#x805A;&#x7C7B;&#x5360;&#x603B;&#x50CF;&#x7D20;&#x6BD4;&#x7387;&#xFF0C;&#x6839;&#x636E;&#x6BD4;&#x7387;&#x5EFA;&#x7ACB;&#x8272;&#x5361;&#xFF01;</li>
</ol>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial/data/images/master.jpg&quot;</span>);
    <span class="hljs-keyword">if</span> (src.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not load image...\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    namedWindow(<span class="hljs-string">&quot;input image&quot;</span>, WINDOW_AUTOSIZE);
    imshow(<span class="hljs-string">&quot;input image&quot;</span>, src);

    <span class="hljs-keyword">int</span> width = src.cols;
    <span class="hljs-keyword">int</span> height = src.rows;
    <span class="hljs-keyword">int</span> dims = src.channels();

    <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;&#x5B9A;&#x4E49;</span>
    <span class="hljs-keyword">int</span> sampleCount = width*height;
    <span class="hljs-keyword">int</span> clusterCount = <span class="hljs-number">4</span>;
    Mat labels;
    Mat centers;

    <span class="hljs-comment">// RGB &#x6570;&#x636E;&#x8F6C;&#x6362;&#x5230;&#x6837;&#x672C;&#x6570;&#x636E;</span>
    Mat sample_data = src.reshape(<span class="hljs-number">3</span>, sampleCount);
    Mat data;
    sample_data.convertTo(data, CV_32F);

    <span class="hljs-comment">// &#x8FD0;&#x884C;K-Means</span>
    TermCriteria criteria = TermCriteria(TermCriteria::EPS + TermCriteria::COUNT, <span class="hljs-number">10</span>, <span class="hljs-number">0.1</span>);
    kmeans(data, clusterCount, labels, criteria, clusterCount, KMEANS_PP_CENTERS, centers);

    Mat card = Mat::zeros(Size(width, <span class="hljs-number">50</span>), CV_8UC3);
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; clusters(clusterCount);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; labels.rows; i++) {
        clusters[labels.at&lt;<span class="hljs-keyword">int</span>&gt;(i, <span class="hljs-number">0</span>)]++;
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; clusters.size(); i++) {
        clusters[i] = clusters[i] / sampleCount;
    }
    <span class="hljs-keyword">int</span> x_offset = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; clusterCount; x++) {
        Rect rect;
        rect.x = x_offset;
        rect.y = <span class="hljs-number">0</span>;
        rect.height = <span class="hljs-number">50</span>;
        rect.width = round(clusters[x] * width);
        x_offset += rect.width;
        <span class="hljs-keyword">int</span> b = centers.at&lt;<span class="hljs-keyword">float</span>&gt;(x, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">int</span> g = centers.at&lt;<span class="hljs-keyword">float</span>&gt;(x, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">int</span> r = centers.at&lt;<span class="hljs-keyword">float</span>&gt;(x, <span class="hljs-number">2</span>);
        rectangle(card, rect, Scalar(b, g, r), <span class="hljs-number">-1</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>);
    }

    imshow(<span class="hljs-string">&quot;Image Color Card&quot;</span>, card);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="114&#x3001;knn&#x7B97;&#x6CD5;&#x4ECB;&#x7ECD;">114&#x3001;KNN&#x7B97;&#x6CD5;&#x4ECB;&#x7ECD;</h3>
<p>OpenCV&#x4E2D;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x6A21;&#x5757;&#x7684;&#x6700;&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;KNN&#xFF0C; &#x4F7F;&#x7528;KNN&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;&#x624B;&#x5199;&#x6570;&#x5B57;&#x8BC6;&#x522B;&#xFF0C;OpenCV&#x5728;sample/data&#x4E2D;&#x6709;&#x4E00;&#x5F20;&#x81EA;&#x5E26;&#x7684;&#x624B;&#x5199;&#x6570;&#x5B57;&#x6570;&#x636E;&#x96C6;&#x56FE;&#x50CF;&#xFF0C;0~9 &#x6BCF;&#x4E2A;&#x6709;500&#x4E2A;&#x6837;&#x672C;&#xFF0C;&#x603B;&#x8BA1;&#x6709;5000&#x4E2A;&#x6570;&#x5B57;&#x3002;&#x56FE;&#x50CF;&#x5927;&#x5C0F;&#x4E3A;1000x2000&#x7684;&#x5927;&#x5C0F;&#x56FE;&#x50CF;&#xFF0C;&#x5206;&#x5272;&#x4E3A;20x20&#x5927;&#x5C0F;&#x7684;&#x5355;&#x4E2A;&#x6570;&#x5B57;&#x56FE;&#x50CF;&#xFF0C;&#x6BCF;&#x4E2A;&#x6837;&#x672C;400&#x4E2A;&#x50CF;&#x7D20;&#x3002;&#x7136;&#x540E;&#x4F7F;&#x7528;KNN&#x76F8;&#x5173;API&#x5B9E;&#x73B0;&#x8BAD;&#x7EC3;&#x4E0E;&#x7ED3;&#x679C;&#x7684;&#x4FDD;&#x5B58;&#x3002;&#x5927;&#x81F4;&#x7684;&#x987A;&#x5E8F;&#x5982;&#x4E0B;&#xFF1A; </p>
<ol>
<li>&#x8BFB;&#x5165;&#x6D4B;&#x8BD5;&#x56FE;&#x50CF;digit.png
.    &#x6784;&#x5EFA;&#x6837;&#x672C;&#x6570;&#x636E;&#x4E0E;&#x6807;&#x7B7E; 
.    &#x521B;&#x5EFA;KNN&#x8BAD;&#x7EC3;&#x5E76;&#x4FDD;&#x5B58;&#x8BAD;&#x7EC3;&#x7ED3;&#x679C;</li>
</ol>
<p>OpenCV&#x4E2D;KNN&#x521B;&#x5EFA;&#x7684;API&#x5982;&#x4E0B;&#xFF1A; Ptr&lt;KNearest&gt; knn = KNearest::create();</p>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::ml;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat data = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/digits.png&quot;</span>);
    Mat gray;
    cvtColor(data, gray, COLOR_BGR2GRAY);

    Mat images = Mat::zeros(<span class="hljs-number">5000</span>, <span class="hljs-number">400</span>, CV_8UC1);
    Mat labels = Mat::zeros(<span class="hljs-number">5000</span>, <span class="hljs-number">1</span>, CV_8UC1);
    Rect rect;
    rect.height = <span class="hljs-number">20</span>;
    rect.width = <span class="hljs-number">20</span>;
    <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;
    Rect roi;
    roi.x = <span class="hljs-number">0</span>;
    roi.height = <span class="hljs-number">1</span>;
    roi.width = <span class="hljs-number">400</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-number">50</span>; row++) {
        <span class="hljs-keyword">int</span> label = row / <span class="hljs-number">5</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-number">100</span>; col++) {
            Mat digit = Mat::zeros(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, CV_8UC1);
            index = row * <span class="hljs-number">100</span> + col;
            rect.x = col * <span class="hljs-number">20</span>;
            rect.y = row * <span class="hljs-number">20</span>;
            gray(rect).copyTo(digit);
            Mat one_row = digit.reshape(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
            roi.y = index;
            one_row.copyTo(images(roi));
            labels.at&lt;uchar&gt;(index, <span class="hljs-number">0</span>) = label;
        }
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;load sample hand-writing data...\n&quot;</span>);


    images.convertTo(images, CV_32FC1);
    labels.convertTo(labels, CV_32SC1);


    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Start to knn train...\n&quot;</span>);
    Ptr&lt;KNearest&gt; knn = KNearest::create();
    knn-&gt;setDefaultK(<span class="hljs-number">5</span>);
    knn-&gt;setIsClassifier(<span class="hljs-literal">true</span>);
    Ptr&lt;ml::TrainData&gt; tdata = ml::TrainData::create(images, ml::ROW_SAMPLE, labels);
    knn-&gt;train(tdata);
    knn-&gt;save(<span class="hljs-string">&quot;./knn_knowledge.yml&quot;</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Finished KNN...\n&quot;</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h3 id="115&#x3001;knn&#x7B97;&#x6CD5;-&#x4F7F;&#x7528;">115&#x3001;KNN&#x7B97;&#x6CD5; &#x4F7F;&#x7528;</h3>
<p>OpenCV&#x4E2D;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x6A21;&#x5757;&#x7684;&#x6700;&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;KNN&#xFF0C; &#x5BF9;&#x4F7F;&#x7528;KNN&#x8BAD;&#x7EC3;&#x597D;&#x7684;XML&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7B97;&#x6CD5;&#x63A5;&#x53E3;&#x7684;load&#x65B9;&#x6CD5;&#x52A0;&#x8F7D;&#x6210;&#x4E3A;KNN&#x5206;&#x7C7B;&#x5668;&#xFF0C;&#x4F7F;&#x7528;findNearest&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x9884;&#x6D4B;&#x3002;OpenCV KNN&#x9884;&#x6D4B;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x89E3;&#x91CA;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-c++"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">float</span> cv::ml::KNearest::findNearest(
    InputArray     samples,
    <span class="hljs-keyword">int</span>     k,
    OutputArray     results,
    OutputArray     neighborResponses = noArray(),
    OutputArray     dist = noArray() 
)
</code></pre>
<p>&#x5176;&#x4E2D;sample&#x662F;&#x5F85;&#x9884;&#x6D4B;&#x7684;&#x6570;&#x636E;&#x6837;&#x672C; </p>
<p>K&#xFF1A;&#x8868;&#x793A;&#x9009;&#x62E9;&#x6700;&#x8FD1;&#x90BB;&#x7684;&#x6570;&#x76EE; </p>
<p>Result&#xFF1A;&#x8868;&#x793A;&#x9884;&#x6D4B;&#x7ED3;&#x679C; </p>
<p>neighborResponses&#xFF1A;&#x8868;&#x793A;&#x6BCF;&#x4E2A;&#x6837;&#x672C;&#x7684;&#x524D;k&#x4E2A;&#x90BB;&#x5C45; </p>
<p>dist&#xFF1A;&#x8868;&#x793A;&#x6BCF;&#x4E2A;&#x6837;&#x672C;&#x524D;k&#x7684;&#x90BB;&#x5C45;&#x7684;&#x8DDD;&#x79BB;  </p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::ml;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">knn_test</span><span class="hljs-params">(Mat&amp; data, Mat&amp; labels)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat data = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/digits.png&quot;</span>);
    Mat gray;
    cvtColor(data, gray, COLOR_BGR2GRAY);

    <span class="hljs-comment">// &#x5206;&#x5272;&#x4E3A;5000&#x4E2A;cells</span>
    Mat images = Mat::zeros(<span class="hljs-number">5000</span>, <span class="hljs-number">400</span>, CV_8UC1);
    Mat labels = Mat::zeros(<span class="hljs-number">5000</span>, <span class="hljs-number">1</span>, CV_8UC1);

    <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;
    Rect roi;
    roi.x = <span class="hljs-number">0</span>;
    roi.height = <span class="hljs-number">1</span>;
    roi.width = <span class="hljs-number">400</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-number">50</span>; row++) {
        <span class="hljs-keyword">int</span> label = row / <span class="hljs-number">5</span>;
        <span class="hljs-keyword">int</span> offsety = row * <span class="hljs-number">20</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-number">100</span>; col++) {
            <span class="hljs-keyword">int</span> offsetx = col * <span class="hljs-number">20</span>;
            Mat digit = Mat::zeros(Size(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>), CV_8UC1);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sr = <span class="hljs-number">0</span>; sr &lt; <span class="hljs-number">20</span>; sr++) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sc = <span class="hljs-number">0</span>; sc &lt; <span class="hljs-number">20</span>; sc++) {
                    digit.at&lt;uchar&gt;(sr, sc) = gray.at&lt;uchar&gt;(sr + offsety, sc + offsetx);
                }
            }
            Mat one_row = digit.reshape(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;index : %d \n&quot;</span>, index);
            roi.y = index;
            one_row.copyTo(images(roi));
            labels.at&lt;uchar&gt;(index, <span class="hljs-number">0</span>) = label;
            index++;
        }
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;load sample hand-writing data...\n&quot;</span>);
    imwrite(<span class="hljs-string">&quot;./result.png&quot;</span>, images);

    <span class="hljs-comment">// &#x8F6C;&#x6362;&#x4E3A;&#x6D6E;&#x70B9;&#x6570;</span>
    images.convertTo(images, CV_32FC1);
    labels.convertTo(labels, CV_32SC1);

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;load sample hand-writing data...\n&quot;</span>);


    <span class="hljs-comment">// &#x5F00;&#x59CB;KNN&#x8BAD;&#x7EC3;</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Start to knn train...\n&quot;</span>);
    Ptr&lt;KNearest&gt; knn = KNearest::create();
    knn-&gt;setDefaultK(<span class="hljs-number">5</span>);
    knn-&gt;setIsClassifier(<span class="hljs-literal">true</span>);
    Ptr&lt;ml::TrainData&gt; tdata = ml::TrainData::create(images, ml::ROW_SAMPLE, labels);
    knn-&gt;train(tdata);
    knn-&gt;save(<span class="hljs-string">&quot;./knn_knowledge.yml&quot;</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Finished KNN...\n&quot;</span>);

    <span class="hljs-comment">// &#x6D4B;&#x8BD5;KNN</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;start to test knn...\n&quot;</span>);
    knn_test(images, labels);

    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">knn_test</span><span class="hljs-params">(Mat&amp; data, Mat&amp; labels)</span> 
</span>{
    <span class="hljs-comment">// &#x52A0;&#x8F7D;KNN&#x5206;&#x7C7B;&#x5668;</span>
    Ptr&lt;ml::KNearest&gt; knn = Algorithm::load&lt;ml::KNearest&gt;(<span class="hljs-string">&quot;./knn_knowledge.yml&quot;</span>); 
    Mat result;
    knn-&gt;findNearest(data, <span class="hljs-number">5</span>, result);
    <span class="hljs-keyword">float</span> count = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; result.rows; row++) {
        <span class="hljs-keyword">int</span> predict = result.at&lt;<span class="hljs-keyword">float</span>&gt;(row, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> (labels.at&lt;<span class="hljs-keyword">int</span>&gt;(row, <span class="hljs-number">0</span>) == predict) {
            count++;
        }
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;test acc of digit numbers : %.2f \n &quot;</span>, (count / result.rows));

    <span class="hljs-comment">// real test it</span>
    Mat t1 = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/knn_01.png&quot;</span>, IMREAD_GRAYSCALE);
    Mat t2 = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/knn_02.png&quot;</span>, IMREAD_GRAYSCALE);
    imshow(<span class="hljs-string">&quot;t1&quot;</span>, t1);
    imshow(<span class="hljs-string">&quot;t2&quot;</span>, t2);
    Mat m1, m2;
    resize(t1, m1, Size(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>));
    resize(t2, m2, Size(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>));
    Mat testdata = Mat::zeros(<span class="hljs-number">2</span>, <span class="hljs-number">400</span>, CV_8UC1);
    Mat testlabels = Mat::zeros(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, CV_32SC1);
    Rect rect;
    rect.x = <span class="hljs-number">0</span>;
    rect.y = <span class="hljs-number">0</span>;
    rect.height = <span class="hljs-number">1</span>;
    rect.width = <span class="hljs-number">400</span>;
    Mat one = m1.reshape(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
    Mat two = m2.reshape(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
    one.copyTo(testdata(rect));
    rect.y = <span class="hljs-number">1</span>;
    two.copyTo(testdata(rect));
    testlabels.at&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) = <span class="hljs-number">1</span>;
    testlabels.at&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>) = <span class="hljs-number">2</span>;
    testdata.convertTo(testdata, CV_32F);

    Mat result2;
    knn-&gt;findNearest(testdata, <span class="hljs-number">5</span>, result2);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i&lt; result2.rows; i++) {
        <span class="hljs-keyword">int</span> predict = result2.at&lt;<span class="hljs-keyword">float</span>&gt;(i, <span class="hljs-number">0</span>);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;knn t%d predict : %d, actual label &#xFF1A;%d \n&quot;</span>,(i+<span class="hljs-number">1</span>),  predict, testlabels.at&lt;<span class="hljs-keyword">int</span>&gt;(i, <span class="hljs-number">0</span>));
    }

}
</code></pre>
<p><img src="pic/121.png" alt=""></p>
<h3 id="116&#x3001;&#x51B3;&#x7B56;&#x6811;&#x7B97;&#x6CD5;-&#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;">116&#x3001;&#x51B3;&#x7B56;&#x6811;&#x7B97;&#x6CD5; &#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;</h3>
<p>OpenCV&#x4E2D;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x6A21;&#x5757;&#x7684;&#x51B3;&#x7B56;&#x6811;&#x7B97;&#x6CD5;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x7C7B;&#x522B;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x968F;&#x673A;&#x68EE;&#x6797;(Random Trees)&#x3001;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5F3A;&#x5316;&#x5206;&#x7C7B;(Boosting Classification)&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x7B97;&#x6CD5;&#x90FD;&#x5C5E;&#x4E8E;&#x51B3;&#x7B56;&#x6811;&#x7B97;&#x6CD5;&#x3002;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">float</span> cv::ml::StatModel::predict(
    InputArray     samples,
    OutputArray results = noArray(),
    <span class="hljs-keyword">int</span> flags = <span class="hljs-number">0</span> 
)<span class="hljs-keyword">const</span>
</code></pre>
<p>sample&#xFF1A;&#x8F93;&#x5165;&#x6837;&#x672C;
result&#xFF1A;&#x9884;&#x6D4B;&#x7ED3;&#x679C;</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::ml;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat data = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/digits.png&quot;</span>);
    Mat gray;
    cvtColor(data, gray, COLOR_BGR2GRAY);

    <span class="hljs-comment">// &#x951F;&#x8857;&#x9769;&#x62F7;&#x4E3A;5000&#x951F;&#x65A4;&#x62F7;cells</span>
    Mat images = Mat::zeros(<span class="hljs-number">5000</span>, <span class="hljs-number">400</span>, CV_8UC1);
    Mat labels = Mat::zeros(<span class="hljs-number">5000</span>, <span class="hljs-number">1</span>, CV_8UC1);

    <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;
    Rect roi;
    roi.x = <span class="hljs-number">0</span>;
    roi.height = <span class="hljs-number">1</span>;
    roi.width = <span class="hljs-number">400</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-number">50</span>; row++) {
        <span class="hljs-keyword">int</span> label = row / <span class="hljs-number">5</span>;
        <span class="hljs-keyword">int</span> offsety = row * <span class="hljs-number">20</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-number">100</span>; col++) {
            <span class="hljs-keyword">int</span> offsetx = col * <span class="hljs-number">20</span>;
            Mat digit = Mat::zeros(Size(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>), CV_8UC1);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sr = <span class="hljs-number">0</span>; sr &lt; <span class="hljs-number">20</span>; sr++) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sc = <span class="hljs-number">0</span>; sc &lt; <span class="hljs-number">20</span>; sc++) {
                    digit.at&lt;uchar&gt;(sr, sc) = gray.at&lt;uchar&gt;(sr + offsety, sc + offsetx);
                }
            }
            Mat one_row = digit.reshape(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;index : %d \n&quot;</span>, index);
            roi.y = index;
            one_row.copyTo(images(roi));
            labels.at&lt;uchar&gt;(index, <span class="hljs-number">0</span>) = label;
            index++;
        }
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;load sample hand-writing data...\n&quot;</span>);
    imwrite(<span class="hljs-string">&quot;./result.png&quot;</span>, images);

    <span class="hljs-comment">// &#x8F6C;&#x951F;&#x65A4;&#x62F7;&#x4E3A;&#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;</span>
    images.convertTo(images, CV_32FC1);
    labels.convertTo(labels, CV_32SC1);

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;load sample hand-writing data...\n&quot;</span>);


    <span class="hljs-comment">// &#x951F;&#x65A4;&#x62F7;&#x59CB;&#x8BAD;&#x951F;&#x65A4;&#x62F7;</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Start to Random Trees train...\n&quot;</span>);
    Ptr&lt;RTrees&gt; model = RTrees::create();
    <span class="hljs-comment">/*model-&gt;setMaxDepth(10);
    model-&gt;setMinSampleCount(10);
    model-&gt;setRegressionAccuracy(0);
    model-&gt;setUseSurrogates(false);
    model-&gt;setMaxCategories(15);
    model-&gt;setPriors(Mat());
    model-&gt;setCalculateVarImportance(true);
    model-&gt;setActiveVarCount(4);
    */</span>
    TermCriteria tc = TermCriteria(TermCriteria::MAX_ITER + TermCriteria::EPS, <span class="hljs-number">100</span>, <span class="hljs-number">0.01</span>);
    model-&gt;setTermCriteria(tc);
    Ptr&lt;ml::TrainData&gt; tdata = ml::TrainData::create(images, ml::ROW_SAMPLE, labels);
    model-&gt;train(tdata);
    model-&gt;save(<span class="hljs-string">&quot;D:/vcworkspaces/rtrees_knowledge.yml&quot;</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Finished Random trees...\n&quot;</span>);

    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h3 id="117&#x3001;&#x56FE;&#x50CF;&#x5747;&#x503C;&#x6F02;&#x79FB;&#x5206;&#x5272;">117&#x3001;&#x56FE;&#x50CF;&#x5747;&#x503C;&#x6F02;&#x79FB;&#x5206;&#x5272;</h3>
<p>&#x56FE;&#x50CF;&#x5747;&#x503C;&#x6F02;&#x79FB;&#x5206;&#x5272;&#x662F;&#x4E00;&#x79CD;&#x65E0;&#x76D1;&#x7763;&#x7684;&#x56FE;&#x50CF;&#x5206;&#x5272;&#x65B9;&#x6CD5;&#xFF0C;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5728;&#x8DDF;&#x8E2A;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#x4ECB;&#x7ECD;&#x8FC7;&#x5747;&#x503C;&#x8FC1;&#x79FB;&#x7B97;&#x6CD5;&#xFF0C;&#x77E5;&#x9053;&#x5747;&#x503C;&#x8FC1;&#x79FB;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x56FE;&#x50CF;&#x4E2D;&#x7279;&#x5F81;&#x76F4;&#x65B9;&#x56FE;&#x7A7A;&#x95F4;&#x7684;&#x5CF0;&#x503C;&#x5206;&#x5E03;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x4F7F;&#x7528;&#x5747;&#x503C;&#x8FC1;&#x79FB;&#xFF0C;&#x8BA9;&#x5B83;&#x53BB;&#x4E0D;&#x65AD;&#x5206;&#x5272;&#x627E;&#x5230;&#x7A7A;&#x95F4;&#x989C;&#x8272;&#x5206;&#x5E03;&#x7684;&#x5CF0;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x5CF0;&#x503C;&#x8FDB;&#x884C;&#x76F8;&#x4F3C;&#x5EA6;&#x5408;&#x5E76;&#xFF0C;&#x89E3;&#x51B3;&#x8FC7;&#x5EA6;&#x5206;&#x5272;&#x95EE;&#x9898;&#xFF0C;&#x5F97;&#x5230;&#x6700;&#x7EC8;&#x7684;&#x5206;&#x5272;&#x56FE;&#x50CF;&#xFF0C;&#x5BF9;&#x4E8E;&#x56FE;&#x50CF;&#x591A;&#x7EF4;&#x5EA6;&#x6570;&#x636E;&#x989C;&#x8272;&#x503C;(RGB)&#x4E0E;&#x7A7A;&#x95F4;&#x4F4D;&#x7F6E;(x,y)&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x7A97;&#x53E3;&#x534A;&#x5F84;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x7A7A;&#x95F4;&#x534A;&#x5F84;&#x3001;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x662F;&#x989C;&#x8272;&#x534A;&#x5F84;&#xFF0C;&#x7ECF;&#x8FC7;&#x5747;&#x503C;&#x6F02;&#x79FB;&#x7A97;&#x53E3;&#x7684;&#x6240;&#x6709;&#x7684;&#x50CF;&#x7D20;&#x70B9;&#x4F1A;&#x5177;&#x6709;&#x76F8;&#x540C;&#x7684;&#x50CF;&#x7D20;&#x503C;&#xFF0C;OpenCV&#x4E2D;&#x5747;&#x503C;&#x6F02;&#x79FB;&#x5206;&#x5272;&#x7684;API&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">void</span> cv::pyrMeanShiftFiltering(
    InputArray src,
    OutputArray dst,
    <span class="hljs-keyword">double</span> sp,
    <span class="hljs-keyword">double</span> sr,
    <span class="hljs-keyword">int</span> maxLevel = <span class="hljs-number">1</span>,
    TermCriteria termcrit = TermCriteria(TermCriteria::MAX_ITER+TermCriteria::EPS, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>) 
)
</code></pre>
<p>src &#xFF1A;&#x8F93;&#x5165;&#x56FE;&#x50CF; </p>
<p>dst&#xFF1A;&#x8F93;&#x51FA;&#x7ED3;&#x679C; </p>
<p>sp &#xFF1A;&#x8868;&#x793A;&#x7A7A;&#x95F4;&#x7A97;&#x53E3;&#x5927;&#x5C0F; </p>
<p>sr &#xFF1A;&#x8868;&#x793A;&#x8868;&#x793A;&#x989C;&#x8272;&#x7A7A;&#x95F4; </p>
<p>maxLevel&#xFF1A;&#x8868;&#x793A;&#x91D1;&#x5B57;&#x5854;&#x5C42;&#x6570;&#xFF0C;&#x603B;&#x5C42;&#x6570;&#x4E3A;maxlevel+1 </p>
<p>termcrit&#xFF1A;&#x8868;&#x793A;&#x505C;&#x6B62;&#x6761;&#x4EF6;</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/yuan_test.png&quot;</span>);
    imshow(<span class="hljs-string">&quot;input&quot;</span>, src);
    Mat dst;
    TermCriteria tc = TermCriteria(TermCriteria::MAX_ITER + TermCriteria::EPS, <span class="hljs-number">10</span>, <span class="hljs-number">0.1</span>);
    pyrMeanShiftFiltering(src, dst, <span class="hljs-number">20</span>, <span class="hljs-number">40</span>, <span class="hljs-number">2</span>, tc);
    imshow(<span class="hljs-string">&quot;mean shift segementation demo&quot;</span>, dst);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="118&#x3001;grabcut&#x56FE;&#x50CF;&#x5206;&#x5272;">118&#x3001;Grabcut&#x56FE;&#x50CF;&#x5206;&#x5272;</h3>
<p>Grabcut&#x662F;&#x57FA;&#x4E8E;&#x56FE;&#x5272;(graph cut)&#x5B9E;&#x73B0;&#x7684;&#x56FE;&#x50CF;&#x5206;&#x5272;&#x7B97;&#x6CD5;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x7528;&#x6237;&#x8F93;&#x5165;&#x4E00;&#x4E2A;bounding box&#x4F5C;&#x4E3A;&#x5206;&#x5272;&#x76EE;&#x6807;&#x4F4D;&#x7F6E;&#xFF0C;&#x5B9E;&#x73B0;&#x5BF9;&#x76EE;&#x6807;&#x4E0E;&#x80CC;&#x666F;&#x7684;&#x5206;&#x79BB;/&#x5206;&#x5272;&#xFF0C;&#x8FD9;&#x4E2A;&#x8DDF;KMeans&#x4E0E;MeanShift&#x7B49;&#x56FE;&#x50CF;&#x5206;&#x5272;&#x65B9;&#x6CD5;&#x6709;&#x5F88;&#x5927;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x4F46;&#x662F;Grabcut&#x5206;&#x5272;&#x901F;&#x5EA6;&#x5FEB;&#xFF0C;&#x6548;&#x679C;&#x597D;&#xFF0C;&#x652F;&#x6301;&#x4EA4;&#x4E92;&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5F88;&#x591A;APP&#x56FE;&#x50CF;&#x5206;&#x5272;/&#x80CC;&#x666F;&#x865A;&#x5316;&#x7684;&#x8F6F;&#x4EF6;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5176;&#x8EAB;&#x5F71;&#x3002;</p>
<pre><code class="lang-c"><span class="hljs-keyword">void</span> cv::grabCut(
    InputArray     img,
    InputOutputArray     mask,
    Rect     rect,
    InputOutputArray     bgdModel,
    InputOutputArray     fgdModel,
    <span class="hljs-keyword">int</span>     iterCount,
    <span class="hljs-keyword">int</span>     mode = GC_EVAL 
)
img:&#x8F93;&#x5165;&#x7684;&#x4E09;&#x901A;&#x9053;&#x56FE;&#x50CF;
mask:&#x8F93;&#x5165;&#x7684;&#x5355;&#x901A;&#x9053;&#x56FE;&#x50CF;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x5F0F;&#x4E3A;GC_INIT_WITH_RECT&#x8868;&#x793A;ROI&#x533A;&#x57DF;&#x53EF;&#x4EE5;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x4E3A;&#xFF1A;
GC_BGD &#x5B9A;&#x4E49;&#x4E3A;&#x660E;&#x663E;&#x7684;&#x80CC;&#x666F;&#x50CF;&#x7D20; <span class="hljs-number">0</span>
GC_FGD &#x5B9A;&#x4E49;&#x4E3A;&#x660E;&#x663E;&#x7684;&#x524D;&#x666F;&#x50CF;&#x7D20; <span class="hljs-number">1</span>
GC_PR_BGD &#x5B9A;&#x4E49;&#x4E3A;&#x53EF;&#x80FD;&#x7684;&#x80CC;&#x666F;&#x50CF;&#x7D20; <span class="hljs-number">2</span>
GC_PR_FGD &#x5B9A;&#x4E49;&#x4E3A;&#x53EF;&#x80FD;&#x7684;&#x524D;&#x666F;&#x50CF;&#x7D20; <span class="hljs-number">3</span>
rect : &#x8868;&#x793A;roi&#x533A;&#x57DF;
bgdModel&#xFF1A;&#x8868;&#x793A;&#x4E34;&#x65F6;&#x80CC;&#x666F;&#x6A21;&#x578B;&#x6570;&#x7EC4;
fgdModel&#xFF1A;&#x8868;&#x793A;&#x4E34;&#x65F6;&#x524D;&#x666F;&#x6A21;&#x578B;&#x6570;&#x7EC4;
iterCount&#xFF1A;&#x8868;&#x793A;&#x56FE;&#x5272;&#x7B97;&#x6CD5;&#x8FED;&#x4EE3;&#x6B21;&#x6570;
mode&#xFF1A;&#x5F53;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x7684;roi&#x65F6;&#x5019;&#x4F7F;&#x7528;GC_INIT_WITH_RECT
</code></pre>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/master.jpg&quot;</span>);
    <span class="hljs-keyword">if</span> (src.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not load image...\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    namedWindow(<span class="hljs-string">&quot;input&quot;</span>, WINDOW_AUTOSIZE);
    imshow(<span class="hljs-string">&quot;input&quot;</span>, src);

    Mat mask = Mat::zeros(src.size(), CV_8UC1);
    <span class="hljs-function">Rect <span class="hljs-title">rect</span><span class="hljs-params">(<span class="hljs-number">180</span>, <span class="hljs-number">20</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>)</span></span>;
    Mat bgdmodel = Mat::zeros(<span class="hljs-number">1</span>, <span class="hljs-number">65</span>, CV_64FC1);
    Mat fgdmodel = Mat::zeros(<span class="hljs-number">1</span>, <span class="hljs-number">65</span>, CV_64FC1);
    grabCut(src, mask, rect, bgdmodel, fgdmodel, <span class="hljs-number">5</span>, GC_INIT_WITH_RECT);
    Mat result;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; mask.rows; row++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> col = <span class="hljs-number">0</span>; col &lt; mask.cols; col++) {
            <span class="hljs-keyword">int</span> pv = mask.at&lt;uchar&gt;(row, col);
            <span class="hljs-keyword">if</span> (pv == <span class="hljs-number">1</span> || pv == <span class="hljs-number">3</span>) {
                mask.at&lt;uchar&gt;(row, col) = <span class="hljs-number">255</span>;
            }
            <span class="hljs-keyword">else</span> {
                mask.at&lt;uchar&gt;(row, col) = <span class="hljs-number">0</span>;
            }
        }
    }
    bitwise_and(src, src, result, mask);
    imshow(<span class="hljs-string">&quot;grabcut result&quot;</span>, result);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
 }
</code></pre>
<h3 id="119&#x3001;grabcut&#x56FE;&#x50CF;&#x5206;&#x5272;-&#x2013;-&#x80CC;&#x666F;&#x66FF;&#x6362;">119&#x3001;Grabcut&#x56FE;&#x50CF;&#x5206;&#x5272; &#x2013; &#x80CC;&#x666F;&#x66FF;&#x6362;</h3>
<p>&#x4F7F;&#x7528;Grabcut&#x5B9E;&#x73B0;&#x56FE;&#x50CF;&#x5BF9;&#x8C61;&#x63D0;&#x53D6;&#xFF0C;&#x901A;&#x8FC7;&#x80CC;&#x666F;&#x56FE;&#x50CF;&#x66FF;&#x6362;&#xFF0C;&#x5B9E;&#x73B0;&#x56FE;&#x50CF;&#x5408;&#x6210;&#xFF0C;&#x901A;&#x8FC7;&#x5BF9;&#x80CC;&#x666F;&#x56FE;&#x50CF;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;&#x5B9E;&#x73B0;&#x80CC;&#x666F;&#x865A;&#x5316;&#x6548;&#x679C;&#xFF0C;&#x5B8C;&#x6574;&#x7684;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A; 1. ROI&#x533A;&#x57DF;&#x9009;&#x62E9; 2. Grabcut&#x5BF9;&#x8C61;&#x5206;&#x5272; 3. Mask&#x751F;&#x6210; 4. &#x4F7F;&#x7528;mask&#xFF0C;&#x5B9E;&#x73B0;&#x80CC;&#x666F;&#x4E0E;&#x524D;&#x666F;&#x7684;&#x9AD8;&#x65AF;&#x6743;&#x91CD;&#x878D;&#x5408;</p>
<ol>
<li>ROI&#x533A;&#x57DF;&#x9009;&#x62E9; </li>
<li>Grabcut&#x5BF9;&#x8C61;&#x5206;&#x5272; </li>
<li>Mask&#x751F;&#x6210; </li>
<li>&#x4F7F;&#x7528;mask&#xFF0C;&#x5B9E;&#x73B0;&#x80CC;&#x666F;&#x4E0E;&#x524D;&#x666F;&#x7684;&#x9AD8;&#x65AF;&#x6743;&#x91CD;&#x878D;&#x5408;</li>
</ol>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> cv2 <span class="hljs-keyword">as</span> cv
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

src = cv.imread(<span class="hljs-string">&quot;D:/images/master.jpg&quot;</span>);
background = cv.imread(<span class="hljs-string">&quot;D:/images/land.png&quot;</span>)
cv.imshow(<span class="hljs-string">&quot;input&quot;</span>, src)
cv.imshow(<span class="hljs-string">&quot;background&quot;</span>, background)

h, w, ch = src.shape
mask = np.zeros(src.shape[:<span class="hljs-number">2</span>], dtype=np.uint8)
rect = (<span class="hljs-number">53</span>,<span class="hljs-number">12</span>,w<span class="hljs-number">-100</span>,h<span class="hljs-number">-12</span>)
bgdmodel = np.zeros((<span class="hljs-number">1</span>,<span class="hljs-number">65</span>),np.float64)
fgdmodel = np.zeros((<span class="hljs-number">1</span>,<span class="hljs-number">65</span>),np.float64)

cv.grabCut(src,mask,rect,bgdmodel,fgdmodel,<span class="hljs-number">5</span>,mode=cv.GC_INIT_WITH_RECT)
mask2 = np.where((mask==<span class="hljs-number">1</span>) + (mask==<span class="hljs-number">3</span>), <span class="hljs-number">255</span>, <span class="hljs-number">0</span>).astype(<span class="hljs-string">&apos;uint8&apos;</span>)
print(mask2.shape)

<span class="hljs-comment"># &#x9AD8;&#x65AF;&#x6A21;&#x7CCA;</span>
se = cv.getStructuringElement(cv.MORPH_RECT, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>))
cv.dilate(mask2, se, mask2)
mask2 = cv.GaussianBlur(mask2, (<span class="hljs-number">5</span>, <span class="hljs-number">5</span>), <span class="hljs-number">0</span>)
cv.imshow(<span class="hljs-string">&apos;background-mask&apos;</span>,mask2)

<span class="hljs-comment"># &#x865A;&#x5316;&#x80CC;&#x666F;</span>
background = cv.GaussianBlur(background, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">15</span>)

<span class="hljs-comment"># blend image</span>
result = np.zeros((h, w, ch), dtype=np.uint8)
<span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> range(h):
    <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> range(w):
        w1 = mask2[row, col] / <span class="hljs-number">255.0</span>
        b, g, r = src[row, col]
        b1,g1,r1 = background[row, col]
        b = (<span class="hljs-number">1.0</span>-w1) * b1 + b * w1
        g = (<span class="hljs-number">1.0</span>-w1) * g1 + g * w1
        r = (<span class="hljs-number">1.0</span>-w1) * r1 + r * w1
        result[row, col] = (b, g, r)

cv.imshow(<span class="hljs-string">&quot;result&quot;</span>, result)
cv.waitKey(<span class="hljs-number">0</span>)
cv.destroyAllWindows()
</code></pre>
<h3 id="120&#x3001;&#x4E8C;&#x7EF4;&#x7801;&#x68C0;&#x6D4B;&#x4E0E;&#x8BC6;&#x522B;">120&#x3001;&#x4E8C;&#x7EF4;&#x7801;&#x68C0;&#x6D4B;&#x4E0E;&#x8BC6;&#x522B;</h3>
<p>OpenCV&#x5728;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x6A21;&#x5757;&#x4E2D;QRCodeDetector&#x6709;&#x4E24;&#x4E2A;&#x76F8;&#x5173;API&#x5206;&#x522B;&#x5B9E;&#x73B0;&#x4E8C;&#x7EF4;&#x7801;&#x68C0;&#x6D4B;&#x4E0E;&#x4E8C;&#x7EF4;&#x7801;&#x89E3;&#x6790;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">bool</span> cv::QRCodeDetector::detect(
    InputArray img,
    OutputArray points 
)<span class="hljs-keyword">const</span>
</code></pre>
<p>img&#xFF1A;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#xFF0C;&#x7070;&#x5EA6;&#x6216;&#x8005;&#x5F69;&#x8272;&#x56FE;&#x50CF; </p>
<p>points&#xFF1A; &#x5F97;&#x5230;&#x7684;&#x4E8C;&#x7EF4;&#x7801;&#x56DB;&#x4E2A;&#x70B9;&#x7684;&#x5750;&#x6807;&#x4FE1;&#x606F;</p>
<pre><code class="lang-cpp"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> cv::QRCodeDetector::decode(
    InputArray img,
    InputArray points,
    OutputArray straight_qrcode = noArray() 
)
</code></pre>
<p>img&#xFF1A;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#xFF0C;&#x7070;&#x5EA6;&#x6216;&#x8005;&#x5F69;&#x8272;&#x56FE;&#x50CF; </p>
<p>points&#xFF1A; &#x4E8C;&#x7EF4;&#x7801;ROI&#x6700;&#x5C0F;&#x5916;&#x63A5;&#x77E9;&#x5F62;&#x9876;&#x70B9;&#x5750;&#x6807; </p>
<p>qrcode &#xFF1A;&#x8F93;&#x51FA;&#x7684;&#x662F;&#x4E8C;&#x7EF4;&#x7801;&#x533A;&#x57DF;ROI&#x56FE;&#x50CF;&#x4FE1;&#x606F; </p>
<p>&#x8FD4;&#x56DE;&#x7684;&#x4E8C;&#x7EF4;&#x7801;utf-8&#x5B57;&#x7B26;&#x4E32;</p>
<pre><code class="lang-cpp">&#x4E0A;&#x8FF0;&#x4E24;&#x4E2A;API&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;API&#x8C03;&#x7528;&#x5B9E;&#x73B0;&#xFF0C;&#x8BE5;API&#x5982;&#x4E0B;&#xFF1A;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> cv::QRCodeDetector::detectAndDecode(
    InputArray img,
    OutputArray points = noArray(),
    OutputArray straight_qrcode = noArray() 
)
</code></pre>
<h3 id="121&#x3001;opencv-dnn-&#x83B7;&#x53D6;&#x5BFC;&#x5165;&#x6A21;&#x578B;&#x5404;&#x5C42;&#x4FE1;&#x606F;">121&#x3001;OpenCV DNN &#x83B7;&#x53D6;&#x5BFC;&#x5165;&#x6A21;&#x578B;&#x5404;&#x5C42;&#x4FE1;&#x606F;</h3>
<p>&#x6A21;&#x578B;&#x652F;&#x6301;1000&#x4E2A;&#x7C7B;&#x522B;&#x7684;&#x56FE;&#x50CF;&#x5206;&#x7C7B;&#xFF0C;OpenCV DNN&#x6A21;&#x5757;&#x652F;&#x6301;&#x4E0B;&#x9762;&#x6846;&#x67B6;&#x7684;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x7684;&#x524D;&#x9988;&#x7F51;&#x7EDC;(&#x9884;&#x6D4B;&#x56FE;)&#x4F7F;&#x7528;</p>
<ul>
<li>Caffe<ul>
<li>Tensorflow
 Torch 
 DLDT 
 Darknet</li>
</ul>
</li>
</ul>
<p>&#x540C;&#x65F6;&#x8FD8;&#x652F;&#x6301;&#x81EA;&#x5B9A;&#x4E49;&#x5C42;&#x89E3;&#x6790;&#x3001;&#x975E;&#x6700;&#x5927;&#x6291;&#x5236;&#x64CD;&#x4F5C;&#x3001;&#x83B7;&#x53D6;&#x5404;&#x5C42;&#x7684;&#x4FE1;&#x606F;&#x7B49;&#x3002;OpenCV&#x52A0;&#x8F7D;&#x6A21;&#x578B;&#x7684;&#x901A;&#x7528;API&#x4E3A;  </p>
<pre><code class="lang-cpp">Net cv::dnn::readNet(
    <span class="hljs-keyword">const</span> String &amp;     model,
    <span class="hljs-keyword">const</span> String &amp;     config = <span class="hljs-string">&quot;&quot;</span>,
    <span class="hljs-keyword">const</span> String &amp;     framework = <span class="hljs-string">&quot;&quot;</span> 
)
</code></pre>
<p>model&#x4E8C;&#x8FDB;&#x5236;&#x8BAD;&#x7EC3;&#x597D;&#x7684;&#x7F51;&#x7EDC;&#x6743;&#x91CD;&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x80FD;&#x6765;&#x81EA;&#x652F;&#x6301;&#x7684;&#x7F51;&#x7EDC;&#x6846;&#x67B6;&#xFF0C;&#x6269;&#x5C55;&#x540D;&#x4E3A;&#x5982;&#x4E0B;&#xFF1A; </p>
<p>*.caffemodel (Caffe, <a href="http://caffe.berkeleyvision.org/)" target="_blank">http://caffe.berkeleyvision.org/)</a> </p>
<p>*.pb (TensorFlow, <a href="https://www.tensorflow.org/)" target="_blank">https://www.tensorflow.org/)</a> </p>
<p><em>.t7 | </em>.net (Torch, <a href="http://torch.ch/)" target="_blank">http://torch.ch/)</a> </p>
<p>*.weights (Darknet, <a href="https://pjreddie.com/darknet/)" target="_blank">https://pjreddie.com/darknet/)</a> </p>
<p>*.bin (DLDT, <a href="https://software.intel.com/openvino-toolkit)" target="_blank">https://software.intel.com/openvino-toolkit)</a> </p>
<p>config&#x9488;&#x5BF9;&#x6A21;&#x578B;&#x4E8C;&#x8FDB;&#x5236;&#x7684;&#x63CF;&#x8FF0;&#x6587;&#x4EF6;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x6846;&#x67B6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6709;&#x4E0D;&#x540C;&#x6269;&#x5C55;&#x540D; </p>
<p>*.prototxt (Caffe, <a href="http://caffe.berkeleyvision.org/)" target="_blank">http://caffe.berkeleyvision.org/)</a> </p>
<p>*.pbtxt (TensorFlow, <a href="https://www.tensorflow.org/)" target="_blank">https://www.tensorflow.org/)</a> </p>
<p>*.cfg (Darknet, <a href="https://pjreddie.com/darknet/)" target="_blank">https://pjreddie.com/darknet/)</a> </p>
<p>*.xml (DLDT, <a href="https://software.intel.com/openvino-toolkit)" target="_blank">https://software.intel.com/openvino-toolkit)</a>  </p>
<p>framework&#x663E;&#x793A;&#x58F0;&#x660E;&#x53C2;&#x6570;&#xFF0C;&#x8BF4;&#x660E;&#x6A21;&#x578B;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x6846;&#x67B6;&#x8BAD;&#x7EC3;&#x51FA;&#x6765;&#x7684;  </p>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/dnn.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::dnn;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    <span class="hljs-built_in">string</span> bin_model = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/googlenet/bvlc_googlenet.caffemodel&quot;</span>;
    <span class="hljs-built_in">string</span> protxt = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/googlenet/bvlc_googlenet.prototxt&quot;</span>;

    <span class="hljs-comment">// load CNN model</span>
    Net net = dnn::readNet(bin_model, protxt);

    <span class="hljs-comment">// &#x83B7;&#x53D6;&#x5404;&#x5C42;&#x4FE1;&#x606F;</span>
    <span class="hljs-built_in">vector</span>&lt;String&gt; layer_names = net.getLayerNames();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; layer_names.size(); i++) {
        <span class="hljs-keyword">int</span> id = net.getLayerId(layer_names[i]);
        <span class="hljs-keyword">auto</span> layer = net.getLayer(id);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;layer id:%d, type: %s, name:%s \n&quot;</span>, id, layer-&gt;type.c_str(), layer-&gt;name.c_str());
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="122&#x3001;opencv-dnn-&#x5B9E;&#x73B0;&#x56FE;&#x50CF;&#x5206;&#x7C7B;">122&#x3001;OpenCV DNN &#x5B9E;&#x73B0;&#x56FE;&#x50CF;&#x5206;&#x7C7B;</h3>
<p>&#x4F7F;&#x7528;ImageNet&#x6570;&#x636E;&#x96C6;&#x652F;&#x6301;1000&#x5206;&#x7C7B;&#x7684;GoogleNet&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#xFF0C; &#x5206;&#x522B;&#x6F14;&#x793A;&#x4E86;Python&#x4E0E;C++&#x8BED;&#x8A00;&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x8BE5;&#x6A21;&#x578B;&#x5B9E;&#x73B0;&#x56FE;&#x50CF;&#x5206;&#x7C7B;&#x6807;&#x7B7E;&#x9884;&#x6D4B;&#x3002;&#x5176;&#x4E2D;label&#x6807;&#x7B7E;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x6587;&#x672C;&#x6587;&#x4EF6;&#x4E2D;&#x8BFB;&#x53D6;&#xFF0C;&#x6A21;&#x578B;&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x94FE;&#x63A5;&#x4E2D;&#x4E0B;&#x8F7D;&#x5373;&#x53EF;&#x3002;&#x8BFB;&#x53D6;&#x6A21;&#x578B;&#x7684;API&#xFF1A;</p>
<pre><code class="lang-c++">Net cv::dnn::readNetFromCaffe(
    <span class="hljs-keyword">const</span> String &amp;     prototxt,
    <span class="hljs-keyword">const</span> String &amp;     caffeModel = String() 
)
</code></pre>
<p>prototxt&#xFF1A;&#x8868;&#x793A;&#x6A21;&#x578B;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6; </p>
<p>caffeModel&#xFF1A;&#x8868;&#x793A;&#x6A21;&#x578B;&#x7684;&#x6743;&#x91CD;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;</p>
<p>&#x4F7F;&#x7528;&#x6A21;&#x578B;&#x5B9E;&#x73B0;&#x9884;&#x6D4B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x8BFB;&#x53D6;&#x56FE;&#x50CF;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#xFF0C;&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#x652F;&#x6301;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x56DB;&#x7EF4;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x628A;&#x8BFB;&#x53D6;&#x5230;&#x7684;Mat&#x5BF9;&#x8C61;&#x8F6C;&#x6362;&#x4E3A;&#x56DB;&#x7EF4;&#x5F20;&#x91CF;&#xFF0C;OpenCV&#x7684;&#x63D0;&#x4F9B;&#x7684;API&#x4E3A;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-c++">Mat cv::dnn::blobFromImage(
    InputArray     image,
    <span class="hljs-keyword">double</span>     scalefactor = <span class="hljs-number">1.0</span>,
    <span class="hljs-keyword">const</span> Size &amp;     size = Size(),
    <span class="hljs-keyword">const</span> Scalar &amp;     mean = Scalar(),
    <span class="hljs-keyword">bool</span>     swapRB = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">bool</span>     crop = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">int</span>     ddepth = CV_32F 
)
</code></pre>
<p>image&#x8F93;&#x5165;&#x56FE;&#x50CF; </p>
<p>scalefactor &#xFF1A;&#x9ED8;&#x8BA4;1.0 </p>
<p>size&#xFF1A;&#x8868;&#x793A;&#x7F51;&#x7EDC;&#x63A5;&#x53D7;&#x7684;&#x6570;&#x636E;&#x5927;&#x5C0F; </p>
<p>mean&#xFF1A;&#x8868;&#x793A;&#x8BAD;&#x7EC3;&#x65F6;&#x6570;&#x636E;&#x96C6;&#x7684;&#x5747;&#x503C; </p>
<p>swapRB&#xFF1A; &#x662F;&#x5426;&#x4E92;&#x6362;Red&#x4E0E;Blur&#x901A;&#x9053; </p>
<p>crop&#xFF1A;&#x526A;&#x5207; </p>
<p>ddepth&#xFF1A; &#x6570;&#x636E;&#x7C7B;&#x578B;</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/dnn.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span>
<span class="hljs-comment">/******************************************************
*
********************************************************/</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::dnn;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

String labels_txt_file = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/inception5h/imagenet_comp_graph_label_strings.txt&quot;</span>;
String tf_pb_file = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/inception5h/tensorflow_inception_graph.pb&quot;</span>;
<span class="hljs-built_in">vector</span>&lt;String&gt; readClassNames();
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat src = imread(<span class="hljs-string">&quot;D:/images/space_shuttle.jpg&quot;</span>);
    <span class="hljs-keyword">if</span> (src.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not load image...\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    namedWindow(<span class="hljs-string">&quot;input&quot;</span>, WINDOW_AUTOSIZE);
    imshow(<span class="hljs-string">&quot;input&quot;</span>, src);
    <span class="hljs-built_in">vector</span>&lt;String&gt; labels = readClassNames();

    Mat rgb;
    cvtColor(src, rgb, COLOR_BGR2RGB);
    <span class="hljs-keyword">int</span> w = <span class="hljs-number">224</span>;
    <span class="hljs-keyword">int</span> h = <span class="hljs-number">224</span>;

    <span class="hljs-comment">// &#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;</span>
    Net net = readNetFromTensorflow(tf_pb_file);
    <span class="hljs-keyword">if</span> (net.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;read caffe model data failure...\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    Mat inputBlob = blobFromImage(src, <span class="hljs-number">1.0f</span>, Size(<span class="hljs-number">224</span>, <span class="hljs-number">224</span>), Scalar(), <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
    inputBlob -= <span class="hljs-number">117.0</span>; <span class="hljs-comment">// &#x951F;&#x65A4;&#x62F7;&#x503C;</span>

                        <span class="hljs-comment">// &#x6267;&#x951F;&#x65A4;&#x62F7;&#x56FE;&#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;&#x951F;&#xFFFD;</span>
    Mat prob;
    net.setInput(inputBlob, <span class="hljs-string">&quot;input&quot;</span>);
    prob = net.forward(<span class="hljs-string">&quot;softmax2&quot;</span>);

    <span class="hljs-comment">// &#x951F;&#x77EB;&#x7889;&#x62F7;&#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;&#x828A;&#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;</span>
    Mat probMat = prob.reshape(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
    Point classNumber;
    <span class="hljs-keyword">double</span> classProb;
    minMaxLoc(probMat, <span class="hljs-literal">NULL</span>, &amp;classProb, <span class="hljs-literal">NULL</span>, &amp;classNumber);
    <span class="hljs-keyword">int</span> classidx = classNumber.x;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n current image classification : %s, possible : %.2f&quot;</span>, labels.at(classidx).c_str(), classProb);

    <span class="hljs-comment">// &#x951F;&#x65A4;&#x62F7;&#x793A;&#x951F;&#x4FA5;&#x618B;&#x62F7;</span>
    putText(src, labels.at(classidx), Point(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>), FONT_HERSHEY_SIMPLEX, <span class="hljs-number">1.0</span>, Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>);
    imshow(<span class="hljs-string">&quot;Image Classification&quot;</span>, src);
    imwrite(<span class="hljs-string">&quot;D:/result.png&quot;</span>, src);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;String&gt; readClassNames()
{
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;String&gt; classNames;

    <span class="hljs-built_in">std</span>::<span class="hljs-function">ifstream <span class="hljs-title">fp</span><span class="hljs-params">(labels_txt_file)</span></span>;
    <span class="hljs-keyword">if</span> (!fp.is_open())
    {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not open file...\n&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);
    }
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;
    <span class="hljs-keyword">while</span> (!fp.eof())
    {
        <span class="hljs-built_in">std</span>::getline(fp, name);
        <span class="hljs-keyword">if</span> (name.length())
            classNames.push_back(name);
    }
    fp.close();
    <span class="hljs-keyword">return</span> classNames;
}
</code></pre>
<h3 id="123&#x3001;-dnn-&#x4E3A;&#x6A21;&#x578B;&#x8FD0;&#x884C;&#x8BBE;&#x7F6E;&#x76EE;&#x6807;&#x8BBE;&#x5907;&#x4E0E;&#x8BA1;&#x7B97;&#x540E;&#x53F0;">123&#x3001; DNN &#x4E3A;&#x6A21;&#x578B;&#x8FD0;&#x884C;&#x8BBE;&#x7F6E;&#x76EE;&#x6807;&#x8BBE;&#x5907;&#x4E0E;&#x8BA1;&#x7B97;&#x540E;&#x53F0;</h3>
<p>OpenCV&#x4E2D;&#x52A0;&#x8F7D;&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x8BA1;&#x7B97;&#x540E;&#x53F0;&#x4E0E;&#x8BA1;&#x7B97;&#x76EE;&#x6807;&#x8BBE;&#x5907;&#xFF0C;OpenCV DNN&#x6A21;&#x5757;&#x652F;&#x6301;&#x8FD9;&#x4E24;&#x4E2A;&#x8BBE;&#x7F6E;&#x7684;&#x76F8;&#x5173;API&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-cpp">cv::dnn::Net::setPreferableBackend(
    <span class="hljs-keyword">int</span> backendId
)
</code></pre>
<p>backendId &#x8868;&#x793A;&#x540E;&#x53F0;&#x8BA1;&#x7B97;id&#xFF0C; </p>
<ul>
<li>DNN_BACKEND_DEFAULT (DNN_BACKEND_INFERENCE_ENGINE)&#x8868;&#x793A;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;intel&#x7684;&#x9884;&#x6D4B;&#x63A8;&#x65AD;&#x5E93;(&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;Intel&#xAE; OpenVINO&#x2122; toolkit&#xFF0C; &#x7136;&#x540E;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;OpenCV&#x6E90;&#x7801;&#xFF0C;&#x5728;CMake&#x65F6;&#x5019;enable&#x8BE5;&#x9009;&#x9879;&#x65B9;&#x53EF;)&#xFF0C; &#x53EF;&#x52A0;&#x901F;&#x8BA1;&#x7B97;&#xFF01; 
   DNN_BACKEND_OPENCV &#x4E00;&#x822C;&#x60C5;&#x51B5;&#x90FD;&#x662F;&#x4F7F;&#x7528;opencv dnn&#x4F5C;&#x4E3A;&#x540E;&#x53F0;&#x8BA1;&#x7B97;&#xFF0C;</li>
</ul>
<pre><code class="lang-c"><span class="hljs-keyword">void</span> cv::dnn::Net::setPreferableTarget(
    <span class="hljs-keyword">int</span> targetId
)
</code></pre>
<p>&#x5E38;&#x89C1;&#x7684;&#x76EE;&#x6807;&#x8BBE;&#x5907;id&#x5982;&#x4E0B;&#xFF1A; </p>
<ul>
<li>DNN_TARGET_CPU&#x5176;&#x4E2D;&#x8868;&#x793A;&#x4F7F;&#x7528;CPU&#x8BA1;&#x7B97;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x7684; 
   DNN_TARGET_OPENCL &#x8868;&#x793A;&#x4F7F;&#x7528;OpenCL&#x52A0;&#x901F;&#xFF0C;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x901F;&#x5EA6;&#x90FD;&#x5F88;&#x626F; 
   DNN_TARGET_OPENCL_FP16 &#x53EF;&#x4EE5;&#x5C1D;&#x8BD5; 
   DNN_TARGET_MYRIAD &#x6811;&#x8393;&#x6D3E;&#x4E0A;&#x7684;</li>
</ul>
<h3 id="124&#x3001;dnn-&#x57FA;&#x4E8E;ssd&#x5B9E;&#x73B0;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;">124&#x3001;DNN &#x57FA;&#x4E8E;SSD&#x5B9E;&#x73B0;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;</h3>
<p>OpenCV DNN&#x6A21;&#x5757;&#x652F;&#x6301;&#x5E38;&#x89C1;&#x5F97;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x6A21;&#x578B;SSD&#xFF0C; &#x4EE5;&#x53CA;&#x5B83;&#x7684;&#x79FB;&#x52A8;&#x7248;Mobile Net-SSD&#xFF0C;&#x7279;&#x522B;&#x662F;&#x540E;&#x8005;&#x5728;&#x7AEF;&#x4FA7;&#x8FB9;&#x7F18;&#x8BBE;&#x5907;&#x4E0A;&#x53EF;&#x4EE5;&#x5B9E;&#x65F6;&#x8BA1;&#x7B97;&#xFF0C;&#x57FA;&#x4E8E;Caffe&#x8BAD;&#x7EC3;&#x597D;&#x7684;mobile-net SSD&#x652F;&#x6301;20&#x7C7B;&#x522B;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#xFF0C;&#x5176;&#x6A21;&#x578B;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-c++">&#x52A0;&#x8F7D;&#x7F51;&#x7EDC;&#x4E4B;&#x540E;&#xFF0C;&#x63A8;&#x65AD;&#x8C03;&#x7528;&#x7684;&#x5173;&#x952E;API&#x5982;&#x4E0B;&#xFF1A;
Mat cv::dnn::Net::forward(
<span class="hljs-keyword">const</span> String &amp;     outputName = String()
)
</code></pre>
<p>&#x5BF9;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x7F51;&#x7EDC;&#x6765;&#x8BF4;&#xFF1A; &#x8BE5;API&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x56DB;&#x7EF4;&#x7684;tensor&#xFF0C;&#x524D;&#x4E24;&#x4E2A;&#x7EF4;&#x5EA6;&#x662F;1&#xFF0C;&#x540E;&#x9762;&#x7684;&#x4E24;&#x4E2A;&#x7EF4;&#x5EA6;&#xFF0C;&#x5206;&#x522B;&#x8868;&#x793A;&#x68C0;&#x6D4B;&#x5230;BOX&#x6570;&#x91CF;&#xFF0C;&#x4EE5;&#x53CA;&#x6BCF;&#x4E2A;BOX&#x7684;&#x5750;&#x6807;&#xFF0C;&#x5BF9;&#x8C61;&#x7C7B;&#x522B;&#xFF0C;&#x5F97;&#x5206;&#x7B49;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x7279;&#x522B;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5750;&#x6807;&#x662F;&#x6D6E;&#x70B9;&#x6570;&#x7684;&#x6BD4;&#x7387;&#xFF0C;&#x4E0D;&#x662F;&#x50CF;&#x7D20;&#x503C;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x8F6C;&#x6362;&#x4E3A;&#x50CF;&#x7D20;&#x5750;&#x6807;&#x624D;&#x53EF;&#x4EE5;&#x7ED8;&#x5236;BOX/&#x77E9;&#x5F62;&#x3002;</p>
<pre><code class="lang-cpp">#include &lt;opencv2/opencv.hpp&gt;
#include &lt;opencv2/dnn.hpp&gt;
#include &lt;iostream&gt;

using namespace cv;
using namespace cv::dnn;
using namespace std;

const size_t width = 300;
const size_t height = 300;
String labelFile = &quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/ssd/labelmap_det.txt&quot;;
String modelFile = &quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/ssd/MobileNetSSD_deploy.caffemodel&quot;;
String model_text_file = &quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/ssd/MobileNetSSD_deploy.prototxt&quot;;

String objNames[] = { &quot;background&quot;,
&quot;aeroplane&quot;, &quot;bicycle&quot;, &quot;bird&quot;, &quot;boat&quot;,
&quot;bottle&quot;, &quot;bus&quot;, &quot;car&quot;, &quot;cat&quot;, &quot;chair&quot;,
&quot;cow&quot;, &quot;diningtable&quot;, &quot;dog&quot;, &quot;horse&quot;,
&quot;motorbike&quot;, &quot;person&quot;, &quot;pottedplant&quot;,
&quot;sheep&quot;, &quot;sofa&quot;, &quot;train&quot;, &quot;tvmonitor&quot; };

int main(int argc, char** argv) 
{
    Mat frame = imread(&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/dog.jpg&quot;);
    if (frame.empty()) {
        printf(&quot;could not load image...\n&quot;);
        return -1;
    }
    namedWindow(&quot;input image&quot;, WINDOW_AUTOSIZE);
    imshow(&quot;input image&quot;, frame);

    Net net = readNetFromCaffe(model_text_file, modelFile);
    net.setPreferableBackend(DNN_BACKEND_INFERENCE_ENGINE);
    net.setPreferableTarget(DNN_TARGET_CPU);
    Mat blobImage = blobFromImage(frame, 0.007843,
        Size(300, 300),
        Scalar(127.5, 127.5, 127.5), true, false);
    printf(&quot;blobImage width : %d, height: %d\n&quot;, blobImage.cols, blobImage.rows);

    net.setInput(blobImage, &quot;data&quot;);
    Mat detection = net.forward(&quot;detection_out&quot;);
    vector&lt;double&gt; layersTimings;
    double freq = getTickFrequency() / 1000;
    double time = net.getPerfProfile(layersTimings) / freq;
    printf(&quot;execute time : %.2f ms\n&quot;, time);


    Mat detectionMat(detection.size[2], detection.size[3], CV_32F, detection.ptr&lt;float&gt;());
    float confidence_threshold = 0.5;
    for (int i = 0; i &lt; detectionMat.rows; i++) {
        float confidence = detectionMat.at&lt;float&gt;(i, 2);
        if (confidence &gt; confidence_threshold) {
            size_t objIndex = (size_t)(detectionMat.at&lt;float&gt;(i, 1));
            float tl_x = detectionMat.at&lt;float&gt;(i, 3) * frame.cols;
            float tl_y = detectionMat.at&lt;float&gt;(i, 4) * frame.rows;
            float br_x = detectionMat.at&lt;float&gt;(i, 5) * frame.cols;
            float br_y = detectionMat.at&lt;float&gt;(i, 6) * frame.rows;

            Rect object_box((int)tl_x, (int)tl_y, (int)(br_x - tl_x), (int)(br_y - tl_y));
            rectangle(frame, object_box, Scalar(0, 0, 255), 2, 8, 0);
            putText(frame, format(&quot; confidence %.2f, %s&quot;, confidence, objNames[objIndex].c_str()), Point(tl_x - 10, tl_y - 5), FONT_HERSHEY_SIMPLEX, 0.7, Scalar(255, 0, 0), 2, 8);
        }
    }
    imshow(&quot;ssd-demo&quot;, frame);

    waitKey(0);
    return 0;
}
</code></pre>
<h3 id="125&#x3001;dnn-&#x57FA;&#x4E8E;ssd&#x5B9E;&#x73B0;&#x5B9E;&#x65F6;&#x89C6;&#x9891;&#x68C0;&#x6D4B;">125&#x3001;DNN &#x57FA;&#x4E8E;SSD&#x5B9E;&#x73B0;&#x5B9E;&#x65F6;&#x89C6;&#x9891;&#x68C0;&#x6D4B;</h3>
<p>OpenCV DNN&#x6A21;&#x5757;&#x652F;&#x6301;&#x5E38;&#x89C1;&#x5F97;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x6A21;&#x578B;SSD&#xFF0C; &#x4EE5;&#x53CA;&#x5B83;&#x7684;&#x79FB;&#x52A8;&#x7248;Mobile Net-SSD&#xFF0C;&#x7279;&#x522B;&#x662F;&#x540E;&#x8005;&#x5728;&#x7AEF;&#x4FA7;&#x8FB9;&#x7F18;&#x8BBE;&#x5907;&#x4E0A;&#x53EF;&#x4EE5;&#x5B9E;&#x65F6;&#x8BA1;&#x7B97;&#xFF0C;&#x57FA;&#x4E8E;Caffe&#x8BAD;&#x7EC3;&#x597D;&#x7684;mobile-net SSD&#x652F;&#x6301;20&#x7C7B;&#x522B;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;</p>
<p>SSD&#x7684;mobilenet&#x7248;&#x672C;&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;&#x56FE;&#x50CF;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;&#x89C6;&#x9891;&#xFF0C;&#x8FBE;&#x5230;&#x7A33;&#x5B9A;&#x5B9E;&#x65F6;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x57FA;&#x4E8E;124&#x7684;&#x5206;&#x4EAB;&#x5185;&#x5BB9;&#xFF0C;&#x6211;&#x7A0D;&#x5FAE;&#x505A;&#x4E86;&#x4E00;&#x4E0B;&#x6539;&#x52A8;&#x5B9E;&#x73B0;&#x4E86;&#x5728;Python&#x4E0E;C++&#x4E2D;&#x7684;&#x57FA;&#x4E8E;SSD&#x89C6;&#x9891;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8BE6;&#x7EC6;&#x53C2;&#x89C1;&#x6E90;&#x7801;zip&#x6587;&#x4EF6;&#x5373;&#x53EF;&#x3002; &#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;API&#xFF0C; &#x83B7;&#x53D6;&#x7F51;&#x7EDC;&#x5404;&#x5C42;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x4E0E;&#x603B;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;API:</p>
<pre><code class="lang-cpp">int64 cv::dnn::Net::getPerfProfile(
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt; <span class="hljs-keyword">double</span> &gt; &amp; timings
)
</code></pre>
<p>&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x7F51;&#x7EDC;&#x6267;&#x884C;&#x63A8;&#x65AD;&#x7684;&#x65F6;&#x95F4; </p>
<p>Timings&#x662F;&#x7F51;&#x7EDC;&#x5BF9;&#x5E94;&#x7684;&#x5404;&#x5C42;&#x6267;&#x884C;&#x65F6;&#x95F4;  </p>
<pre><code class="lang-cpp">#include &lt;opencv2/opencv.hpp&gt;
#include &lt;opencv2/dnn.hpp&gt;
#include &lt;iostream&gt;

using namespace cv;
using namespace cv::dnn;
using namespace std;

const size_t width = 300;
const size_t height = 300;
String labelFile = &quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/ssd/labelmap_det.txt&quot;;
String modelFile = &quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/ssd/MobileNetSSD_deploy.caffemodel&quot;;
String model_text_file = &quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/ssd/MobileNetSSD_deploy.prototxt&quot;;

String objNames[] = { &quot;background&quot;,
&quot;aeroplane&quot;, &quot;bicycle&quot;, &quot;bird&quot;, &quot;boat&quot;,
&quot;bottle&quot;, &quot;bus&quot;, &quot;car&quot;, &quot;cat&quot;, &quot;chair&quot;,
&quot;cow&quot;, &quot;diningtable&quot;, &quot;dog&quot;, &quot;horse&quot;,
&quot;motorbike&quot;, &quot;person&quot;, &quot;pottedplant&quot;,
&quot;sheep&quot;, &quot;sofa&quot;, &quot;train&quot;, &quot;tvmonitor&quot; };

int main(int argc, char** argv) {
    // load model
    Net net = readNetFromCaffe(model_text_file, modelFile);
    net.setPreferableBackend(DNN_BACKEND_OPENCV);
    net.setPreferableTarget(DNN_TARGET_CPU);

    VideoCapture cap = VideoCapture(0);
    Mat frame;
    while (true) {
        bool ret = cap.read(frame);
        if (!ret) break;
        Mat blobImage = blobFromImage(frame, 0.007843,
            Size(300, 300),
            Scalar(127.5, 127.5, 127.5), true, false);
        printf(&quot;blobImage width : %d, height: %d\n&quot;, blobImage.size[2], blobImage.size[3]);

        net.setInput(blobImage, &quot;data&quot;);
        Mat detection = net.forward(&quot;detection_out&quot;);
        vector&lt;double&gt; layersTimings;
        double freq = getTickFrequency() / 1000;
        double time = net.getPerfProfile(layersTimings) / freq;
        printf(&quot;execute time : %.2f ms\n&quot;, time);


        Mat detectionMat(detection.size[2], detection.size[3], CV_32F, detection.ptr&lt;float&gt;());
        float confidence_threshold = 0.5;
        for (int i = 0; i &lt; detectionMat.rows; i++) {
            float confidence = detectionMat.at&lt;float&gt;(i, 2);
            if (confidence &gt; confidence_threshold) {
                size_t objIndex = (size_t)(detectionMat.at&lt;float&gt;(i, 1));
                float tl_x = detectionMat.at&lt;float&gt;(i, 3) * frame.cols;
                float tl_y = detectionMat.at&lt;float&gt;(i, 4) * frame.rows;
                float br_x = detectionMat.at&lt;float&gt;(i, 5) * frame.cols;
                float br_y = detectionMat.at&lt;float&gt;(i, 6) * frame.rows;

                Rect object_box((int)tl_x, (int)tl_y, (int)(br_x - tl_x), (int)(br_y - tl_y));
                rectangle(frame, object_box, Scalar(0, 0, 255), 2, 8, 0);
                putText(frame, format(&quot; confidence %.2f, %s&quot;, confidence, objNames[objIndex].c_str()), Point(tl_x - 10, tl_y - 5), FONT_HERSHEY_SIMPLEX, 0.7, Scalar(255, 0, 0), 2, 8);
            }
        }
        imshow(&quot;ssd-video-demo&quot;, frame);
        char c = waitKey(10);
        if (c == 27) {
            break;
        }
    }

    waitKey(0);
    return 0;
}
</code></pre>
<h3 id="126&#x3001;dnn-&#x57FA;&#x4E8E;&#x6B8B;&#x5DEE;&#x7F51;&#x7EDC;&#x7684;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;">126&#x3001;DNN &#x57FA;&#x4E8E;&#x6B8B;&#x5DEE;&#x7F51;&#x7EDC;&#x7684;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;</h3>
<p>OpenCV&#x5728;DNN&#x6A21;&#x5757;&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x57FA;&#x4E8E;&#x6B8B;&#x5DEE;SSD&#x7F51;&#x7EDC;&#x8BAD;&#x7EC3;&#x7684;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x6A21;&#x578B;&#xFF0C;&#x8BE5;&#x6A21;&#x578B;&#x5206;&#x522B;&#x63D0;&#x4F9B;&#x4E86;tensorflow&#x7248;&#x672C;&#xFF0C;caffe&#x7248;&#x672C;&#xFF0C;torch&#x7248;&#x672C;&#x6A21;&#x578B;&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x4E2D;tensorflow&#x7248;&#x672C;&#x7684;&#x6A21;&#x578B;&#x505A;&#x4E86;&#x66F4;&#x52A0;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x538B;&#x7F29;&#x4F18;&#x5316;&#xFF0C;&#x5927;&#x5C0F;&#x53EA;&#x6709;2MB&#x5DE6;&#x53F3;&#xFF0C;&#x975E;&#x5E38;&#x9002;&#x5408;&#x79FB;&#x690D;&#x5230;&#x79FB;&#x52A8;&#x7AEF;&#x4F7F;&#x7528;&#xFF0C;&#x5B9E;&#x73B0;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x529F;&#x80FD;&#xFF0C;&#x800C;caffe&#x7248;&#x672C;&#x7684;&#x662F;fp16&#x7684;&#x6D6E;&#x70B9;&#x6570;&#x6A21;&#x578B;&#xFF0C;&#x7CBE;&#x51C6;&#x5EA6;&#x66F4;&#x597D;&#x3002;&#x8981;&#x5148;&#x83B7;&#x5F97;&#x8FD9;&#x4E9B;&#x6A21;&#x578B;&#xFF0C;&#x53EA;&#x8981;&#x4E0B;&#x8F7D;OpenCV4.0&#x6E90;&#x7801;&#x4E4B;&#x540E;&#xFF0C; &#x6253;&#x5F00;&#x8FD0;&#x884C;sources\samples\dnn\face_detector\download_weights.py&#x8BE5;&#x811A;&#x672C;&#x5373;&#x53EF;&#x3002;</p>
<pre><code class="lang-cpp">#include &lt;opencv2/opencv.hpp&gt;
#include &lt;opencv2/dnn.hpp&gt;
#include &lt;iostream&gt;

using namespace cv;
using namespace cv::dnn;
using namespace std;

const size_t width = 300;
const size_t height = 300;
String model_bin = &quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/face_detector/opencv_face_detector_uint8.pb&quot;;
String config_text = &quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/face_detector/opencv_face_detector.pbtxt&quot;;

int main(int argc, char** argv) {
    Mat frame = imread(&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/persons.png&quot;);
    if (frame.empty()) {
        printf(&quot;could not load image...\n&quot;);
        return -1;
    }
    namedWindow(&quot;input image&quot;, WINDOW_AUTOSIZE);
    imshow(&quot;input image&quot;, frame);

    Net net = readNetFromTensorflow(model_bin, config_text);
    net.setPreferableBackend(DNN_BACKEND_OPENCV);
    net.setPreferableTarget(DNN_TARGET_CPU);
    Mat blobImage = blobFromImage(frame, 1.0,
        Size(300, 300),
        Scalar(104.0, 177.0, 123.0), false, false);

    net.setInput(blobImage, &quot;data&quot;);
    Mat detection = net.forward(&quot;detection_out&quot;);
    vector&lt;double&gt; layersTimings;
    double freq = getTickFrequency() / 1000;
    double time = net.getPerfProfile(layersTimings) / freq;
    printf(&quot;execute time : %.2f ms\n&quot;, time);

    Mat detectionMat(detection.size[2], detection.size[3], CV_32F, detection.ptr&lt;float&gt;());
    float confidence_threshold = 0.5;
    for (int i = 0; i &lt; detectionMat.rows; i++) {
        float confidence = detectionMat.at&lt;float&gt;(i, 2);
        if (confidence &gt; confidence_threshold) {
            size_t objIndex = (size_t)(detectionMat.at&lt;float&gt;(i, 1));
            float tl_x = detectionMat.at&lt;float&gt;(i, 3) * frame.cols;
            float tl_y = detectionMat.at&lt;float&gt;(i, 4) * frame.rows;
            float br_x = detectionMat.at&lt;float&gt;(i, 5) * frame.cols;
            float br_y = detectionMat.at&lt;float&gt;(i, 6) * frame.rows;

            Rect object_box((int)tl_x, (int)tl_y, (int)(br_x - tl_x), (int)(br_y - tl_y));
            rectangle(frame, object_box, Scalar(0, 0, 255), 2, 8, 0);
            putText(frame, format(&quot; confidence %.2f&quot;, confidence),
                Point(tl_x - 10, tl_y - 5), FONT_HERSHEY_SIMPLEX, 0.5, Scalar(255, 0, 0), 1, 8);
        }
    }
    imshow(&quot;ssd-face-detection&quot;, frame);

    waitKey(0);
    return 0;
}
</code></pre>
<h3 id="127&#x3001;dnn-&#x57FA;&#x4E8E;&#x6B8B;&#x5DEE;&#x7F51;&#x7EDC;&#x7684;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;">127&#x3001;DNN &#x57FA;&#x4E8E;&#x6B8B;&#x5DEE;&#x7F51;&#x7EDC;&#x7684;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;</h3>
<h3 id="128&#x3001;dnn-&#x76F4;&#x63A5;&#x8C03;&#x7528;tensorflow&#x7684;&#x5BFC;&#x51FA;&#x6A21;&#x578B;">128&#x3001;DNN &#x76F4;&#x63A5;&#x8C03;&#x7528;tensorflow&#x7684;&#x5BFC;&#x51FA;&#x6A21;&#x578B;</h3>
<p>OpenCV&#x5728;DNN&#x6A21;&#x5757;&#x4E2D;&#x652F;&#x6301;&#x76F4;&#x63A5;&#x8C03;&#x7528;tensorflow object detection&#x8BAD;&#x7EC3;&#x5BFC;&#x51FA;&#x7684;&#x6A21;&#x578B;&#x4F7F;&#x7528;&#xFF0C;&#x652F;&#x6301;&#x7684;&#x6A21;&#x578B;&#x5305;&#x62EC;</p>
<ul>
<li>SSD</li>
<li>Faster-RCNN</li>
<li>Mask-RCNN</li>
</ul>
<pre><code class="lang-c++">#include &lt;opencv2/opencv.hpp&gt;
#include &lt;opencv2/dnn.hpp&gt;
#include &lt;fstream&gt;

using namespace cv;
using namespace cv::dnn;
using namespace std;

string label_map = &quot;D:/tensorflow/models/research/object_detection/data/mscoco_label_map.pbtxt&quot;;
string model = &quot;D:/tensorflow/faster_rcnn_resnet50_coco_2018_01_28/frozen_inference_graph.pb&quot;;
string config = &quot;D:/tensorflow/faster_rcnn_resnet50_coco_2018_01_28/graph.pbtxt&quot;;

std::map&lt;int, String&gt; readLabelMaps();
int main(int argc, char** argv) {
    Mat src = imread(&quot;D:/images/person.jpg&quot;);
    int width = src.cols;
    int height = src.rows;
    if (src.empty()) {
        printf(&quot;could not load image...\n&quot;);
        return 0;
    }
    namedWindow(&quot;input&quot;, WINDOW_AUTOSIZE);
    imshow(&quot;input&quot;, src);
    map&lt;int, string&gt; names = readLabelMaps();

    // &#x52A0;&#x8F7D;Faster-RCNN
    Net net = readNetFromTensorflow(model, config);
    Mat blob = blobFromImage(src, 1.0, Size(300, 300), Scalar(), true, false);
    net.setInput(blob);

    // &#x9884;&#x6D4B;
    Mat detection = net.forward();
    Mat detectionMat(detection.size[2], detection.size[3], CV_32F, detection.ptr&lt;float&gt;());
    float threshold = 0.5;

    // &#x5904;&#x7406;&#x8F93;&#x51FA;&#x6570;&#x636E;&#xFF0C;&#x7ED8;&#x5236;&#x9884;&#x6D4B;&#x6846;&#x4E0E;&#x6587;&#x672C;
    for (int row = 0; row &lt; detectionMat.rows; row++) {
        float confidence = detectionMat.at&lt;float&gt;(row, 2);
        if (confidence &gt; threshold) {

            // base zero
            int object_class = detectionMat.at&lt;float&gt;(row, 1) + 1;

            // predict box
            int left = detectionMat.at&lt;float&gt;(row, 3) * width;
            int top = detectionMat.at&lt;float&gt;(row, 4) * height;
            int right = detectionMat.at&lt;float&gt;(row, 5) * width;
            int bottom = detectionMat.at&lt;float&gt;(row, 6) * height;

            Rect rect;
            rect.x = left;
            rect.y = top;
            rect.width = (right - left);
            rect.height = (bottom - top);

            // render bounding box and label name
            rectangle(src, rect, Scalar(255, 0, 255), 4, 8, 0);
            map&lt;int, string&gt;::iterator it = names.find(object_class);
            printf(&quot;id : %d, display name : %s \n&quot;, object_class, (it-&gt;second).c_str());
            putText(src, (it-&gt;second).c_str(), Point(left, top - 5), FONT_HERSHEY_SIMPLEX, 0.5, Scalar(255, 0, 0), 1);
        }
    }
    imshow(&quot;faster-rcnn-demo&quot;, src);
    waitKey(0);
    return 0;
}

std::map&lt;int, string&gt; readLabelMaps()
{
    std::map&lt;int, string&gt; labelNames;
    std::ifstream fp(label_map);
    if (!fp.is_open())
    {
        printf(&quot;could not open file...\n&quot;);
        exit(-1);
    }
    string one_line;
    string display_name;
    while (!fp.eof())
    {
        std::getline(fp, one_line);
        std::size_t found = one_line.find(&quot;id:&quot;);
        if (found != std::string::npos) {
            int index = found;
            string id = one_line.substr(index + 4, one_line.length() - index);

            std::getline(fp, display_name);
            std::size_t  found = display_name.find(&quot;display_name:&quot;);

            index = found + 15;
            string name = display_name.substr(index, display_name.length() - index);
            name = name.replace(name.length() - 1, name.length(), &quot;&quot;);
            // printf(&quot;id : %d, name: %s \n&quot;, stoi(id.c_str()), name.c_str());
            labelNames[stoi(id)] = name;
        }
    }
    fp.close();
    return labelNames;
}
</code></pre>
<h3 id="129&#x3001;dnn-&#x8C03;&#x7528;openpose&#x6A21;&#x578B;&#x5B9E;&#x73B0;&#x59FF;&#x6001;&#x8BC4;&#x4F30;">129&#x3001;DNN &#x8C03;&#x7528;openpose&#x6A21;&#x578B;&#x5B9E;&#x73B0;&#x59FF;&#x6001;&#x8BC4;&#x4F30;</h3>
<p>&#x5176;&#x4E2D;COCO&#x6A21;&#x578B;&#x4F1A;&#x751F;&#x6210;18&#x4E2A;&#x70B9;&#xFF0C;MPI&#x6A21;&#x578B;&#x751F;&#x6210;14&#x4E2A;&#x70B9;&#xFF0C;&#x624B;&#x52BF;&#x59FF;&#x6001;&#x6A21;&#x578B;&#x751F;&#x6210;20&#x4E2A;&#x70B9;&#xFF0C;&#x6839;&#x636E;&#x8FD9;&#x4E9B;&#x70B9;&#x53EF;&#x4EE5;&#x7ED8;&#x5236;&#x51FA;&#x4EBA;&#x4F53;&#x7684;&#x5173;&#x952E;&#x8282;&#x70B9;&#x6216;&#x8005;&#x624B;&#x7684;&#x5173;&#x952E;&#x8282;&#x70B9;&#x3002;OpenCV DNN&#x652F;&#x6301;&#x7684;&#x59FF;&#x6001;&#x8BC4;&#x4F30;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x9884;&#x8BAD;&#x7EC3;&#x7684;Caffe&#x6A21;&#x578B;&#xFF0C;&#x800C;&#x4E14;&#x6A21;&#x578B;&#x6CA1;&#x6709;&#x7ECF;&#x8FC7;&#x4E13;&#x95E8;&#x7684;&#x4F18;&#x5316;&#x5904;&#x7406;&#xFF0C;&#x901F;&#x5EA6;&#x7279;&#x522B;&#x7684;&#x6162;&#xFF0C;&#x5728;CPU&#x4E0A;&#x57FA;&#x672C;&#x662F;&#x79D2;&#x7EA7;&#x522B;&#x624D;&#x53EF;&#x4EE5;&#x51FA;&#x7ED3;&#x679C;&#xFF0C;&#x79BB;&#x5B9E;&#x65F6;&#x8FD0;&#x884C;&#x5DEE;&#x597D;&#x8FDC;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E00;&#x4E9B;&#x9759;&#x6001;&#x7684;&#x624B;&#x52BF;&#x5206;&#x6790;&#x8FD8;&#x662F;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x5E2E;&#x52A9;&#x4E0E;&#x4F5C;&#x7528;&#x3002; &#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;</p>
<p>&#x6B65;&#x9AA4; </p>
<ol>
<li><p>&#x52A0;&#x8F7D;&#x7F51;&#x7EDC; </p>
<p>.    &#x83B7;&#x53D6;heatmap&#x6570;&#x636E;&#xFF0C;&#x6839;&#x636E;heatmap&#x5BFB;&#x627E;&#x6700;&#x5927;score&#x4E0E;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F; 
.    &#x6839;&#x636E;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x7ED8;&#x5236;&#x8FDE;&#x63A5;&#x76F4;&#x7EBF;</p>
</li>
</ol>
<h3 id="130&#x3001;dnn-&#x652F;&#x6301;yolo&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x7F51;&#x7EDC;&#x8FD0;&#x884C;">130&#x3001;DNN &#x652F;&#x6301;YOLO&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x7F51;&#x7EDC;&#x8FD0;&#x884C;</h3>
<p>OpenCV DNN&#x6A21;&#x5757;&#x652F;&#x6301;YOLO&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x7F51;&#x7EDC;&#xFF0C;&#x6700;&#x65B0;&#x7684;OpenCV4.0&#x652F;&#x6301;YOLOv3&#x7248;&#x672C;&#x7684;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x7F51;&#x7EDC;&#xFF0C;YOLOv3&#x7248;&#x672C;&#x540C;&#x65F6;&#x8FD8;&#x53D1;&#x5E03;&#x4E86;&#x79FB;&#x52A8;&#x7AEF;&#x652F;&#x6301;&#x7684;&#x7F51;&#x7EDC;&#x6A21;&#x578B;YOLOv3-tiny&#x7248;&#x672C;&#xFF0C;&#x901F;&#x5EA6;&#x53EF;&#x4EE5;&#x5728;CPU&#x7AEF;&#x5B9E;&#x65F6;&#x8FD0;&#x884C;&#x7684;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x7F51;&#x7EDC;&#xFF0C;OpenCV&#x4E2D;&#x901A;&#x8FC7;&#x5BF9;DarkNet&#x6846;&#x67B6;&#x96C6;&#x6210;&#x652F;&#x6301;&#x5B9E;&#x73B0;YOLO&#x7F51;&#x7EDC;&#x52A0;&#x8F7D;&#x4E0E;&#x68C0;&#x6D4B;&#x3002;&#x56E0;&#x4E3A;YOLOv3&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x7F51;&#x7EDC;&#x662F;&#x591A;&#x4E2A;&#x5C42;&#x7684;&#x5408;&#x5E76;&#x8F93;&#x51FA;&#xFF0C;&#x6240;&#x4EE5;&#x5728;OpenCV&#x4E2D;&#x8C03;&#x7528;&#x65F6;&#x5019;&#x5FC5;&#x987B;&#x663E;&#x793A;&#x58F0;&#x660E;&#x90A3;&#x4E9B;&#x662F;&#x8F93;&#x51FA;&#x5C42;&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x4E8E;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x7F51;&#x7EDC;&#xFF0C;OpenCV&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;API&#x6765;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x8F93;&#x51FA;&#x5C42;&#x540D;&#x79F0;&#xFF0C;&#x8BE5;API&#x4E3A;&#xFF1A;</p>
<pre><code class="lang-cpp"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;String&gt; cv::dnn::Net::getUnconnectedOutLayersNames()<span class="hljs-keyword">const</span>
</code></pre>
<p>&#x8BE5;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x975E;&#x8FDE;&#x63A5;&#x7684;&#x8F93;&#x51FA;&#x5C42;&#x3002;  </p>
<p>&#x8C03;&#x7528;&#x65F6;&#x5019;&#xFF0C;&#x5FC5;&#x987B;&#x663E;&#x5F0F;&#x901A;&#x8FC7;&#x8F93;&#x5165;&#x53C2;&#x6570;&#x5B8C;&#x6210;&#x63A8;&#x65AD;&#xFF0C;&#x76F8;&#x5173;API&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">void</span> cv::dnn::Net::forward(
    OutputArrayOfArrays outputBlobs,
    <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt; String &gt; &amp; outBlobNames
)
</code></pre>
<p>outputBlobs&#x662F;&#x8C03;&#x7528;&#x4E4B;&#x540E;&#x7684;&#x8F93;&#x51FA; </p>
<p>outBlobNames&#x662F;&#x6240;&#x6709;&#x8F93;&#x51FA;&#x5C42;&#x7684;&#x540D;&#x79F0;</p>
<p>&#x8DDF;SSD/Faster-RCNN&#x8F93;&#x51FA;&#x7684;&#x7ED3;&#x679C;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;YOLO&#x7684;&#x56DB;&#x4E2A;&#x8F93;&#x51FA;&#x4E3A;$[ center_x, center_y, width, height]$</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/dnn.hpp&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::dnn;
String yolo_cfg = <span class="hljs-string">&quot;D:/projects/pose_body/hand/yolov3.cfg&quot;</span>;
String yolo_model = <span class="hljs-string">&quot;D:/projects/pose_body/hand/yolov3.weights&quot;</span>;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span>
</span>{
    Net net = readNetFromDarknet(yolo_cfg, yolo_model);
    net.setPreferableBackend(DNN_BACKEND_INFERENCE_ENGINE);
    net.setPreferableTarget(DNN_TARGET_CPU);
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;String&gt; outNames = net.getUnconnectedOutLayersNames();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; outNames.size(); i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;output layer name : %s\n&quot;</span>, outNames[i].c_str());
    }

    <span class="hljs-comment">// &#x52A0;&#x8F7D;COCO&#x6570;&#x636E;&#x96C6;&#x6807;&#x7B7E;</span>
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; classNamesVec;
    <span class="hljs-function">ifstream <span class="hljs-title">classNamesFile</span><span class="hljs-params">(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/object_detection_classes_yolov3.txt&quot;</span>)</span></span>;
    <span class="hljs-keyword">if</span> (classNamesFile.is_open())
    {
        <span class="hljs-built_in">string</span> className = <span class="hljs-string">&quot;&quot;</span>;
        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">std</span>::getline(classNamesFile, className))
            classNamesVec.push_back(className);
    }

    <span class="hljs-comment">// &#x52A0;&#x8F7D;&#x56FE;&#x50CF; </span>
    Mat frame = imread(<span class="hljs-string">&quot;D:/images/pedestrian.png&quot;</span>);
    Mat inputBlob = blobFromImage(frame, <span class="hljs-number">1</span> / <span class="hljs-number">255.F</span>, Size(<span class="hljs-number">416</span>, <span class="hljs-number">416</span>), Scalar(), <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
    net.setInput(inputBlob);

    <span class="hljs-comment">// &#x68C0;&#x6D4B;</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Mat&gt; outs;
    net.forward(outs, outNames);
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">double</span>&gt; layersTimings;
    <span class="hljs-keyword">double</span> freq = getTickFrequency() / <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">double</span> time = net.getPerfProfile(layersTimings) / freq;
    <span class="hljs-built_in">ostringstream</span> ss;
    ss &lt;&lt; <span class="hljs-string">&quot;detection time: &quot;</span> &lt;&lt; time &lt;&lt; <span class="hljs-string">&quot; ms&quot;</span>;
    putText(frame, ss.str(), Point(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>), <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>, Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>));
    <span class="hljs-built_in">vector</span>&lt;Rect&gt; boxes;
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; classIds;
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; confidences;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i&lt;outs.size(); ++i)
    {
        <span class="hljs-comment">// Network produces output blob with a shape NxC where N is a number of</span>
        <span class="hljs-comment">// detected objects and C is a number of classes + 4 where the first 4</span>
        <span class="hljs-comment">// numbers are [center_x, center_y, width, height]</span>
        <span class="hljs-keyword">float</span>* data = (<span class="hljs-keyword">float</span>*)outs[i].data;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; outs[i].rows; ++j, data += outs[i].cols)
        {
            Mat scores = outs[i].row(j).colRange(<span class="hljs-number">5</span>, outs[i].cols);
            Point classIdPoint;
            <span class="hljs-keyword">double</span> confidence;
            minMaxLoc(scores, <span class="hljs-number">0</span>, &amp;confidence, <span class="hljs-number">0</span>, &amp;classIdPoint);
            <span class="hljs-keyword">if</span> (confidence &gt; <span class="hljs-number">0.5</span>)
            {
                <span class="hljs-keyword">int</span> centerX = (<span class="hljs-keyword">int</span>)(data[<span class="hljs-number">0</span>] * frame.cols);
                <span class="hljs-keyword">int</span> centerY = (<span class="hljs-keyword">int</span>)(data[<span class="hljs-number">1</span>] * frame.rows);
                <span class="hljs-keyword">int</span> width = (<span class="hljs-keyword">int</span>)(data[<span class="hljs-number">2</span>] * frame.cols);
                <span class="hljs-keyword">int</span> height = (<span class="hljs-keyword">int</span>)(data[<span class="hljs-number">3</span>] * frame.rows);
                <span class="hljs-keyword">int</span> left = centerX - width / <span class="hljs-number">2</span>;
                <span class="hljs-keyword">int</span> top = centerY - height / <span class="hljs-number">2</span>;

                classIds.push_back(classIdPoint.x);
                confidences.push_back((<span class="hljs-keyword">float</span>)confidence);
                boxes.push_back(Rect(left, top, width, height));
            }
        }
    }

    <span class="hljs-comment">// &#x975E;&#x6700;&#x5927;&#x6291;&#x5236;&#x64CD;&#x4F5C;</span>
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; indices;
    NMSBoxes(boxes, confidences, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.2</span>, indices);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; indices.size(); ++i)
    {
        <span class="hljs-keyword">int</span> idx = indices[i];
        Rect box = boxes[idx];
        String className = classNamesVec[classIds[idx]];
        putText(frame, className.c_str(), box.tl(), FONT_HERSHEY_SIMPLEX, <span class="hljs-number">1.0</span>, Scalar(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>);
        rectangle(frame, box, Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>);
    }

    imshow(<span class="hljs-string">&quot;YOLOv3-Detections&quot;</span>, frame);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="131&#x3001;dnn-&#x652F;&#x6301;yolov3-tiny&#x7248;&#x672C;&#x5B9E;&#x65F6;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;">131&#x3001;DNN &#x652F;&#x6301;YOLOv3-tiny&#x7248;&#x672C;&#x5B9E;&#x65F6;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;</h3>
<p>YOLOv3&#x7684;&#x6A21;&#x578B;&#x5728;CPU&#x4E0A;&#x65E0;&#x6CD5;&#x505A;&#x5230;&#x5B9E;&#x65F6;&#x8FD0;&#x884C;&#xFF0C;&#x800C;YOLO&#x4F5C;&#x8005;&#x63D0;&#x4F9B;&#x4E86;&#x4E2A;YOLOv3&#x7248;&#x672C;&#x7684;&#x7CBE;&#x7B80;&#x7248;&#x5BF9;&#x8C61;&#x68C0;&#x6D4B;&#x6A21;&#x578B;&#xFF0C;&#x5927;&#x5C0F;&#x53EA;&#x6709;30MB&#x5DE6;&#x53F3;&#xFF0C;&#x4F46;&#x662F;&#x6A21;&#x578B;&#x53EF;&#x4EE5;&#x5728;CPU&#x4E0A;&#x505A;&#x5230;&#x5B9E;&#x65F6;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E2A;&#x6A21;&#x578B;&#x5C31;&#x662F;YOLOv3-tiny&#x6A21;&#x578B;&#xFF0C;&#x76F8;&#x6BD4;YOLOv3&#xFF0C;YOLOv3-tiny&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x8F93;&#x51FA;&#x5C42;&#xFF0C;&#x800C;&#x4E14;&#x6743;&#x91CD;&#x53C2;&#x6570;&#x5C42;&#x4E0E;&#x53C2;&#x6570;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x90FD;&#x5927;&#x5927;&#x7684;&#x4E0B;&#x964D;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5D4C;&#x5165;&#x5F0F;&#x8BBE;&#x5907;&#x4E0E;&#x524D;&#x7AEF;&#x5B9E;&#x65F6;&#x8FD0;&#x884C;&#x3002;</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/dnn.hpp&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::dnn;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">image_detection</span><span class="hljs-params">()</span></span>;
String yolo_tiny_model = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/yolov3-tiny-coco/yolov3-tiny.weights&quot;</span>;
String yolo_tiny_cfg = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/yolov3-tiny-coco/yolov3-tiny.cfg&quot;</span>;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span>
</span>{
    image_detection();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">image_detection</span><span class="hljs-params">()</span> </span>{
    Net net = readNetFromDarknet(yolo_tiny_cfg, yolo_tiny_model);
    net.setPreferableBackend(DNN_BACKEND_INFERENCE_ENGINE);
    net.setPreferableTarget(DNN_TARGET_CPU);
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;String&gt; outNames = net.getUnconnectedOutLayersNames();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; outNames.size(); i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;output layer name : %s\n&quot;</span>, outNames[i].c_str());
    }

    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; classNamesVec;
    <span class="hljs-function">ifstream <span class="hljs-title">classNamesFile</span><span class="hljs-params">(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/models/object_detection_classes_yolov3.txt&quot;</span>)</span></span>;
    <span class="hljs-keyword">if</span> (classNamesFile.is_open())
    {
        <span class="hljs-built_in">string</span> className = <span class="hljs-string">&quot;&quot;</span>;
        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">std</span>::getline(classNamesFile, className))
            classNamesVec.push_back(className);
    }

    <span class="hljs-comment">// &#x951F;&#x65A4;&#x62F7;&#x951F;&#x65A4;&#x62F7;&#x56FE;&#x951F;&#x65A4;&#x62F7; </span>
    Mat frame = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/pedestrian.png&quot;</span>);
    Mat inputBlob = blobFromImage(frame, <span class="hljs-number">1</span> / <span class="hljs-number">255.F</span>, Size(<span class="hljs-number">416</span>, <span class="hljs-number">416</span>), Scalar(), <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
    net.setInput(inputBlob);

    <span class="hljs-comment">// &#x951F;&#x65A4;&#x62F7;&#x951F;&#xFFFD;</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Mat&gt; outs;
    net.forward(outs, outNames);
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">double</span>&gt; layersTimings;
    <span class="hljs-keyword">double</span> freq = getTickFrequency() / <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">double</span> time = net.getPerfProfile(layersTimings) / freq;
    <span class="hljs-built_in">ostringstream</span> ss;
    ss &lt;&lt; <span class="hljs-string">&quot;detection time: &quot;</span> &lt;&lt; time &lt;&lt; <span class="hljs-string">&quot; ms&quot;</span>;
    putText(frame, ss.str(), Point(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>), <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>, Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>));
    <span class="hljs-built_in">vector</span>&lt;Rect&gt; boxes;
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; classIds;
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; confidences;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i&lt;outs.size(); ++i)
    {
        <span class="hljs-keyword">float</span>* data = (<span class="hljs-keyword">float</span>*)outs[i].data;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; outs[i].rows; ++j, data += outs[i].cols)
        {
            Mat scores = outs[i].row(j).colRange(<span class="hljs-number">5</span>, outs[i].cols);
            Point classIdPoint;
            <span class="hljs-keyword">double</span> confidence;
            minMaxLoc(scores, <span class="hljs-number">0</span>, &amp;confidence, <span class="hljs-number">0</span>, &amp;classIdPoint);
            <span class="hljs-keyword">if</span> (confidence &gt; <span class="hljs-number">0.5</span>)
            {
                <span class="hljs-keyword">int</span> centerX = (<span class="hljs-keyword">int</span>)(data[<span class="hljs-number">0</span>] * frame.cols);
                <span class="hljs-keyword">int</span> centerY = (<span class="hljs-keyword">int</span>)(data[<span class="hljs-number">1</span>] * frame.rows);
                <span class="hljs-keyword">int</span> width = (<span class="hljs-keyword">int</span>)(data[<span class="hljs-number">2</span>] * frame.cols);
                <span class="hljs-keyword">int</span> height = (<span class="hljs-keyword">int</span>)(data[<span class="hljs-number">3</span>] * frame.rows);
                <span class="hljs-keyword">int</span> left = centerX - width / <span class="hljs-number">2</span>;
                <span class="hljs-keyword">int</span> top = centerY - height / <span class="hljs-number">2</span>;

                classIds.push_back(classIdPoint.x);
                confidences.push_back((<span class="hljs-keyword">float</span>)confidence);
                boxes.push_back(Rect(left, top, width, height));
            }
        }
    }

    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; indices;
    NMSBoxes(boxes, confidences, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.2</span>, indices);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; indices.size(); ++i)
    {
        <span class="hljs-keyword">int</span> idx = indices[i];
        Rect box = boxes[idx];
        String className = classNamesVec[classIds[idx]];
        putText(frame, className.c_str(), box.tl(), FONT_HERSHEY_SIMPLEX, <span class="hljs-number">1.0</span>, Scalar(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>);
        rectangle(frame, box, Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>);
    }

    imshow(<span class="hljs-string">&quot;YOLOv3-Detections&quot;</span>, frame);
    waitKey(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span>;
}
</code></pre>
<h3 id="132&#x3001;dnn&#x5355;&#x5F20;&#x4E0E;&#x591A;&#x5F20;&#x56FE;&#x50CF;&#x7684;&#x63A8;&#x65AD;">132&#x3001;DNN&#x5355;&#x5F20;&#x4E0E;&#x591A;&#x5F20;&#x56FE;&#x50CF;&#x7684;&#x63A8;&#x65AD;</h3>
<p>OpenCV DNN&#x4E2D;&#x652F;&#x6301;&#x5355;&#x5F20;&#x56FE;&#x50CF;&#x63A8;&#x65AD;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x652F;&#x6301;&#x5206;&#x6279;&#x6B21;&#x65B9;&#x5F0F;&#x7684;&#x56FE;&#x50CF;&#x63A8;&#x65AD;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x4E24;&#x4E2A;&#x76F8;&#x5173;API&#x5206;&#x522B;&#x4E3A;blobFromImage&#x4E0E;blobFromImages&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x56DB;&#x7EF4;&#x7684;Mat&#x5BF9;&#x8C61;-&#x6309;&#x7167;&#x987A;&#x5E8F;&#x5206;&#x522B;&#x4E3A;NCHW &#x5176;&#x7EC4;&#x7EC7;&#x65B9;&#x5F0F;&#x8BE6;&#x89E3;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>N&#xFF1A;&#x8868;&#x793A;&#x591A;&#x5F20;&#x56FE;&#x50CF; </p>
<p>C&#xFF1A;&#x8868;&#x793A;&#x63A5;&#x53D7;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x901A;&#x9053;&#x6570;&#x76EE; </p>
<p>H&#xFF1A;&#x8868;&#x793A;&#x63A5;&#x53D7;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x9AD8;&#x5EA6; </p>
<p>W&#xFF1A;&#x8868;&#x793A;&#x63A5;&#x53D7;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x5BBD;&#x5EA6;</p>
<pre><code class="lang-cpp">Mat cv::dnn::blobFromImage(
    InputArray     image,
    <span class="hljs-keyword">double</span>     scalefactor = <span class="hljs-number">1.0</span>,
    <span class="hljs-keyword">const</span> Size &amp;     size = Size(),
    <span class="hljs-keyword">const</span> Scalar &amp;     mean = Scalar(),
    <span class="hljs-keyword">bool</span>     swapRB = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">bool</span>     crop = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">int</span>     ddepth = CV_32F
)

Mat cv::dnn::blobFromImages(
    InputArrayOfArrays     images,
    <span class="hljs-keyword">double</span>     scalefactor = <span class="hljs-number">1.0</span>,
    Size     size = Size(),
    <span class="hljs-keyword">const</span> Scalar &amp;     mean = Scalar(),
    <span class="hljs-keyword">bool</span>     swapRB = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">bool</span>     crop = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">int</span>     ddepth = CV_32F 
)
</code></pre>
<p>&#x53C2;&#x6570;&#x89E3;&#x91CA; </p>
<p>Images&#x8868;&#x793A;&#x591A;&#x5F20;&#x56FE;&#x50CF;,image&#x8868;&#x793A;&#x5355;&#x5F20;&#x56FE;&#x50CF; </p>
<p>Scalefactor&#x8868;&#x793A;&#x653E;&#x7F29; </p>
<p>Size&#x8868;&#x793A;&#x56FE;&#x50CF;&#x5927;&#x5C0F; </p>
<p>Mean&#x8868;&#x793A;&#x5747;&#x503C; </p>
<p>swapRB&#x662F;&#x5426;&#x4EA4;&#x6362;&#x901A;&#x9053; </p>
<p>crop&#x662F;&#x5426;&#x526A;&#x5207;</p>
<p>ddepth &#x8F93;&#x51FA;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x6D6E;&#x70B9;&#x6570;&#x683C;&#x5F0F;</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;opencv2/dnn.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span>
<span class="hljs-comment">/******************************************************
*
********************************************************/</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv::dnn;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;


String bin_model = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/googlenet/bvlc_googlenet.caffemodel&quot;</span>;
String protxt = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/googlenet/bvlc_googlenet.prototxt&quot;</span>;
String labels_txt_file = <span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/models/googlenet/classification_classes_ILSVRC2012.txt&quot;</span>;
<span class="hljs-built_in">vector</span>&lt;String&gt; readClassNames();
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    Mat image1 = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/cat.jpg&quot;</span>);
    Mat image2 = imread(<span class="hljs-string">&quot;/home/dc_ubuntu/DC_Workspace/EMA/Project/opencv4.0_project/learn_opencv/opencv_tutorial_complete/opencv_tutorial/data/images/aeroplane.jpg&quot;</span>);
    <span class="hljs-built_in">vector</span>&lt;Mat&gt; images;
    images.push_back(image1);
    images.push_back(image2);
    <span class="hljs-built_in">vector</span>&lt;String&gt; labels = readClassNames();

    <span class="hljs-keyword">int</span> w = <span class="hljs-number">224</span>;
    <span class="hljs-keyword">int</span> h = <span class="hljs-number">224</span>;

    <span class="hljs-comment">// &#x52A0;&#x8F7D;&#x7F51;&#x7EDC;</span>
    Net net = readNetFromCaffe(protxt, bin_model);
    net.setPreferableBackend(DNN_BACKEND_INFERENCE_ENGINE);
    net.setPreferableTarget(DNN_TARGET_CPU);

    <span class="hljs-keyword">if</span> (net.empty()) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;read caffe model data failure...\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    Mat inputBlob = blobFromImages(images, <span class="hljs-number">1.0</span>, Size(w, h), Scalar(<span class="hljs-number">104</span>, <span class="hljs-number">117</span>, <span class="hljs-number">123</span>), <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);

    <span class="hljs-comment">// &#x6267;&#x884C;&#x56FE;&#x50CF;&#x5206;&#x7C7B;</span>
    Mat prob;
    net.setInput(inputBlob);
    prob = net.forward();
    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">double</span>&gt; times;
    <span class="hljs-keyword">double</span> time = net.getPerfProfile(times);
    <span class="hljs-keyword">float</span> ms = (time * <span class="hljs-number">1000</span>) / getTickFrequency();
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;current inference time : %.2f ms \n&quot;</span>, ms);

    <span class="hljs-comment">// &#x5F97;&#x5230;&#x6700;&#x53EF;&#x80FD;&#x5206;&#x7C7B;&#x8F93;&#x51FA;</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> n = <span class="hljs-number">0</span>; n &lt; prob.rows; n++) {
        Point classNumber;
        <span class="hljs-keyword">double</span> classProb;
        Mat probMat = prob(Rect(<span class="hljs-number">0</span>, n, <span class="hljs-number">1000</span>, <span class="hljs-number">1</span>)).clone();
        Mat result = probMat.reshape(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
        minMaxLoc(result, <span class="hljs-literal">NULL</span>, &amp;classProb, <span class="hljs-literal">NULL</span>, &amp;classNumber);
        <span class="hljs-keyword">int</span> classidx = classNumber.x;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n current image classification : %s, possible : %.2f\n&quot;</span>, labels.at(classidx).c_str(), classProb);

        <span class="hljs-comment">// &#x663E;&#x793A;&#x6587;&#x672C;</span>
        putText(images[n], labels.at(classidx), Point(<span class="hljs-number">20</span>, <span class="hljs-number">50</span>), FONT_HERSHEY_SIMPLEX, <span class="hljs-number">1.0</span>, Scalar(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>, <span class="hljs-number">8</span>);
        imshow(<span class="hljs-string">&quot;Image Classification&quot;</span>, images[n]);
        waitKey(<span class="hljs-number">0</span>);

    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;String&gt; readClassNames()
{
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;String&gt; classNames;

    <span class="hljs-built_in">std</span>::<span class="hljs-function">ifstream <span class="hljs-title">fp</span><span class="hljs-params">(labels_txt_file)</span></span>;
    <span class="hljs-keyword">if</span> (!fp.is_open())
    {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;could not open file...\n&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);
    }
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;
    <span class="hljs-keyword">while</span> (!fp.eof())
    {
        <span class="hljs-built_in">std</span>::getline(fp, name);
        <span class="hljs-keyword">if</span> (name.length())
            classNames.push_back(name);
    }
    fp.close();
    <span class="hljs-keyword">return</span> classNames;
}
</code></pre>
<h3 id="133&#x3001;dnn-&#x56FE;&#x50CF;&#x989C;&#x8272;&#x5316;&#x6A21;&#x578B;&#x4F7F;&#x7528;">133&#x3001;DNN &#x56FE;&#x50CF;&#x989C;&#x8272;&#x5316;&#x6A21;&#x578B;&#x4F7F;&#x7528;</h3>
<p>OpenCV DNN&#x5728;4.0&#x8FD8;&#x652F;&#x6301;&#x7070;&#x5EA6;&#x56FE;&#x50CF;&#x7684;&#x5F69;&#x8272;&#x5316;&#x6A21;&#x578B;&#xFF0C;&#x662F;&#x6839;&#x636E;2016&#x5E74;ECCV&#x7684;&#x8BBA;&#x6587;&#x800C;&#x6765;&#xFF0C;&#x57FA;&#x4E8E;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#xFF0C;&#x901A;&#x8FC7;&#x5BF9;Lab&#x8272;&#x5F69;&#x7A7A;&#x95F4;&#x8FDB;&#x884C;&#x91CF;&#x5316;&#x5206;&#x5272;&#xFF0C;&#x6620;&#x5C04;&#x5230;&#x6700;&#x7EC8;&#x7684;CNN&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#xFF0C;&#x6700;&#x540E;&#x8F6C;&#x6362;&#x4E3A;RGB&#x5F69;&#x8272;&#x56FE;&#x50CF;&#x3002;</p>
<pre><code>

</code></pre><h3 id="134&#x3001;dnn-enet&#x5B9E;&#x73B0;&#x56FE;&#x50CF;&#x5206;&#x5272;">134&#x3001;DNN ENet&#x5B9E;&#x73B0;&#x56FE;&#x50CF;&#x5206;&#x5272;</h3>
<h3 id="135&#x3001;dnn-&#x5B9E;&#x65F6;&#x5FEB;&#x901F;&#x7684;&#x56FE;&#x50CF;&#x98CE;&#x683C;&#x8FC1;&#x79FB;">135&#x3001;DNN &#x5B9E;&#x65F6;&#x5FEB;&#x901F;&#x7684;&#x56FE;&#x50CF;&#x98CE;&#x683C;&#x8FC1;&#x79FB;</h3>
<h3 id="136&#x3001;dnn&#x89E3;&#x6790;&#x7F51;&#x7EDC;&#x8F93;&#x51FA;&#x7ED3;&#x679C;">136&#x3001;DNN&#x89E3;&#x6790;&#x7F51;&#x7EDC;&#x8F93;&#x51FA;&#x7ED3;&#x679C;</h3>
<p>&#x591A;&#x6570;&#x65F6;&#x5019;DNN&#x6A21;&#x5757;&#x4E2D;&#x6DF1;&#x5EA6;&#x5B66;&#x4E60;&#x7F51;&#x7EDC;&#x7684;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x4E8C;&#x7EF4;&#x3001;&#x4E09;&#x7EF4;&#x3001;&#x6216;&#x8005;&#x56DB;&#x7EF4;&#x7684;&#xFF0C;&#x5177;&#x4F53;&#x8DDF;&#x7F51;&#x7EDC;&#x7684;&#x7ED3;&#x6784;&#x6709;&#x5F88;&#x5927;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x4E00;&#x822C;&#x5E38;&#x89C1;&#x7684;&#x56FE;&#x50CF;&#x5206;&#x7C7B;&#x7F51;&#x7EDC;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;1XN&#x7EF4;&#x7684;&#x5411;&#x91CF;&#xFF0C;&#x901A;&#x8FC7;reshape&#x4E4B;&#x540E;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x89E3;&#x6790;&#xFF0C; &#x89E3;&#x6790;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>Mat flat = prob.reshape(1,1)
Point maxLoc;
minMaxLoc(flat, 0, 0, &amp;maxLoc)
int predict = maxLoc.x;
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="知识点目录1.html" class="navigation navigation-prev " aria-label="Previous page: 知识点(1-89)">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="案例实战30讲.html" class="navigation navigation-next " aria-label="Next page: 案例实战30例">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"知识点(90-150)","level":"5.1.2","depth":2,"next":{"title":"案例实战30例","level":"5.1.3","depth":2,"path":"articles/opencv4.0学习/案例实战30讲.md","ref":"./articles/opencv4.0学习/案例实战30讲.md","articles":[]},"previous":{"title":"知识点(1-89)","level":"5.1.1","depth":2,"path":"articles/opencv4.0学习/知识点目录1.md","ref":"./articles/opencv4.0学习/知识点目录1.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"articles/opencv4.0学习/知识点目录2.md","mtime":"2020-11-17T02:58:48.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-02-19T09:00:19.762Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

